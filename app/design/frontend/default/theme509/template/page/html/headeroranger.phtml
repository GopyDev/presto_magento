<?php
 $params = $this->getRequest()->getParams();
 if( ($params['page_id'] == 38 ||  $params['page_id'] == 27) && (!isset($params['category']) ) )
 {
?>
	<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>skin/frontend/default/theme509/partner/js/holder.min.js"></script>
	<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>skin/frontend/default/theme509/partner/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>skin/frontend/default/theme509/partner/js/ie10-viewport-bug-workaround.js"></script>
	<script type="text/javascript" src="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>skin/frontend/default/theme509/partner/js/ie-emulation-modes-warning.js"></script>

	<link href="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>skin/frontend/default/theme509/partner/css/custom.css" rel="stylesheet">
	<link href="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>skin/frontend/default/theme509/partner/css/bootstrap.css" rel="stylesheet">
<?php
 }

 $currentUrl = Mage::helper('core/url')->getCurrentUrl();
 $temp=explode(".com/",$currentUrl);
 $temp2=explode("/",$temp[1]);

 if($temp2[1]=='onepage' && $temp2[2]!='success' )
  {
	$greenk=0;
    if(Mage::getSingleton('customer/session')->isLoggedIn()){

			//echo "Go in login condition.";
							 $customerData = Mage::getSingleton('customer/session')->getCustomer();
							//echo "Customer Id is ".$customerData->getId();
							$customerId = $customerData->getId();
							$orders = Mage::getResourceModel("sales/order_collection")
                            ->addAttributeToSelect('customer_id')
                            ->addAttributeToSelect('customer_email')
                            ->addAttributeToSelect('increment_id');

                            ;
					$sql= "SELECT * FROM mg_aw_sarp2_profile WHERE customer_id = '".$customerData->getId()."' AND `status` LIKE 'active'";
					$connection = Mage::getSingleton('core/resource')->getConnection('core_read');
					$results = $connection->fetchAll($sql);

					if($results){
						$jsonText = $results[0]['details'];
						$decodedText = html_entity_decode($jsonText);
						$orderArray = unserialize($decodedText);
						$itemID = $orderArray['subscription']['item']['subscription_type_id'];
						if($itemID == 1){
						//if($orderArray['order_item_info']['product_id'] == 25265){
						   //Basic
							$basic = true;
						}
						if($itemID == 2){
						//if($orderArray['order_item_info']['product_id'] == 27592){
							// Premium Plus
							$premiumPlus = true;
						}
					}else{
							$noFreeShipping = true;
					}
					$subTotal = Mage::helper('checkout/cart')->getQuote()->getSubtotal();

					$greenk=0;
					$cart = Mage::getModel('checkout/cart')->getQuote();

					foreach ($cart->getAllItems() as $item) {
						$productName = $item->getProduct()->getName();
						if($productName=='PrestoPremier Membership Subscription')
						{
						   $greenk=1;
						}

						// $productPrice = $item->getProduct()->getPrice();
					}

					if($basic == true){
								$minimumAmount = 50;

						 }
						 else if($premiumPlus == true){
								$minimumAmount = 25;

						 }else{
								//$minimumAmount = 50;
						 }
						// echo "Greenk is ".$greenk;
		// if($subTotal < $minimumAmount && $greenk ){ //Hiren condition
		if($greenk == 0){
		//echo "Sub total is ".$subTotal;
		//echo "Min total is ".$minimumAmount;
			if( $subTotal < $minimumAmount){
		    $url = "https://www.prestofreshgrocery.com/checkout/cart/";
			Mage::app()->getFrontController()->getResponse()->setRedirect($url);
			}
		}
	 }else{
		// If user is not logged in
		$subTotal = Mage::helper('checkout/cart')->getQuote()->getSubtotal();
		$minimumAmount = 50;
		//echo "Sub total is ".$subTotal;
		/*$minimumAmount = Mage::app()->getLocale()->currency(Mage::app()->getStore()->getCurrentCurrencyCode())
							->toCurrency(Mage::getStoreConfig('sales/minimum_order/amount')); */
		//echo "Minimum amount is ".$minimumAmount;

		if( $subTotal < $minimumAmount){
		    $url = "https://www.prestofreshgrocery.com/checkout/cart/";
			Mage::app()->getFrontController()->getResponse()->setRedirect($url);
			}
	 }
  }
if(isset($_GET["picker2"]) && $_GET["picker2"]!="" )
{
   $_GET["picker"] = $_GET["picker2"];
}
?>
<script>
function dohiren(id,cust,ddate,infopicker,itemqty,itemid)
{
	  noteb = jQuery('#'+id.trim()).val();
	  jQuery('#div-'+id).html('<span style="font-weight:bold;color:#999;">Processing....</span>');
	   jQuery("#trid-"+id).css("background-color", "#ffd9d9");

	  jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajax.php?rand="+Math.random()+"&note="+noteb+"&cust="+cust+"&idstring="+id+"&ddate="+ddate+"&infopicker="+infopicker+"&itemqty="+itemqty+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			 jQuery('#div-'+id).html('<span style="font-weight:bold;color:red;">Status :- Not Found<br/> Note :- '+noteb+'</span>');
		 });
}

function donfnote(item_id)
{
   noteb = jQuery('#nf-'+item_id.trim()).val();

    jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxnf.php?rand="+Math.random()+"&note="+noteb+"&itemid="+item_id,
           context: document.body
			}).done(function(data) {
			 jQuery('#divnfres-'+item_id).html('<span style="font-weight:bold;color:red;">Updated successfully.</span>');
		 });

}



function dodrivenote(rid,route)
{
   note= jQuery('#textnote-'+rid.trim()).val();

   jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxdrivenote.php?rand="+Math.random()+"&note="+note+"&rid="+rid+"&route="+route,
           context: document.body
			}).done(function(data) {
			alert("driver note has been updated successfully");
		 });
}




function dobpack(oid)
{
    jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxbpack.php?rand="+Math.random()+"&oid="+oid,
           context: document.body
			}).done(function(data) {
			jQuery('#pckdiv').html("Brochure has been Packed successfully");
		 });
}

function docheck(d,cf,bag,loose,cold_bin,cold_bag,frozen_bin,frozen_bag,load)
{
  if(load=="")
  {
     alert("Order has been not loaded please check load list.")
	 return false;
  }
  else
  {
  b='Please confirm that you have pulled all of the following items/containers: \n\n Dry Bin :  \t'+d+'\n Dry Bag:  \t'+bag+'\n DryLoose:  \t'+loose+'\n Cold Bin:  \t'+cold_bin+'\n Cold Bag:  \t'+cold_bag+'\n Frozen Bin:  \t'+frozen_bin+'\n Frozen Bag:  \t'+frozen_bag
  return confirm(b);
  }

}
function dohirenupdate(id,cust,ddate,infopicker,itemqty,itemid)
{
	  noteb = jQuery('#'+id.trim()).val();
	  jQuery('#div-'+id).html('<span style="font-weight:bold;color:#999;">Processing....</span>');
	  jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxupdate.php?rand="+Math.random()+"&note="+noteb+"&cust="+cust+"&idstring="+id+"&ddate="+ddate+"&infopicker="+infopicker+"&itemqty="+itemqty+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			alert("information has been updated successfully");
			 // jQuery('#div-'+id).html('<span style="font-weight:bold;color:red;">Status :- Not Found<br/> Note :- '+noteb+'</span>');
		 });
}

function dohirenupdate(id,cust,ddate,infopicker,itemqty,itemid)
{
	  noteb = jQuery('#'+id.trim()).val();
	  jQuery('#div-'+id).html('<span style="font-weight:bold;color:#999;">Processing....</span>');
	  jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxupdate.php?rand="+Math.random()+"&note="+noteb+"&cust="+cust+"&idstring="+id+"&ddate="+ddate+"&infopicker="+infopicker+"&itemqty="+itemqty+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			// alert("information has been updated successfully");
			 jQuery('#div-'+id).html('<span style="font-weight:bold;color:red;">Status :- Not Found<br/> Note :- '+noteb+'</span>');
		 });
}

function dohirenupdate2(id,cust,ddate,infopicker,itemqty,itemid)
{
	  noteb = jQuery('#'+id.trim()).val();
	  jQuery('#div-'+id).html('<span style="font-weight:bold;color:#999;">Processing....</span>');
	  jQuery("#trid-"+id).css("background-color", "#ffd9d9");
	   jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxupdate.php?rand="+Math.random()+"&note="+noteb+"&cust="+cust+"&idstring="+id+"&ddate="+ddate+"&infopicker="+infopicker+"&itemqty="+itemqty+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			// alert("information has been updated successfully");
			 jQuery('#div-'+id).html('<span style="font-weight:bold;color:red;">Status :- Not Found<br/> Note :- '+noteb+'</span>');
		 });
}
function dohiren32(id,cust,ddate,infopicker,itemqty,itemid)
{
	  noteb = jQuery('#'+id.trim()).val();
	  jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxr.php?rand="+Math.random()+"&note="+noteb+"&cust="+cust+"&idstring="+id+"&ddate="+ddate+"&infopicker="+infopicker+"&itemqty="+itemqty+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			 jQuery('#cfe'+id).html('<span style="font-weight:bold;color:green;">Already Packed</span>');
			 jQuery('#cfegreen-'+itemid).html('<span style="font-weight:bold;color:green;">Already Packed</span>');
		 });
}

function dopacked(itemid,ddate)
{
	  jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxr.php?rand="+Math.random()+"&ddate="+ddate+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			 jQuery('#nfdiv-'+itemid).html('<span style="font-weight:bold;color:green;">Already Packed</span>');
		 });
}
function doloaded(id)
{
   jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxl.php?rand="+Math.random()+"&id="+id,
           context: document.body
			}).done(function(data) {
			 jQuery('#trloadtext-'+id).html('<span style="font-weight:bold;color:green;">Dry Items Already Loaded</span>');
			 if(data==1)
			 {
			 jQuery("#trload-"+id).css("background-color", "#daebe1");
			 }
		 });
}

function doloaded2(id)
{
   jQuery.ajax({
           url: "<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>ajaxl2.php?rand="+Math.random()+"&id="+id,
           context: document.body
			}).done(function(data) {
			 jQuery('#trloadtext2-'+id).html('<span style="font-weight:bold;color:green;">C/F Items Already Loaded</span>');
			 if(data==1)
			 {
			 jQuery("#trload-"+id).css("background-color", "#daebe1");
			 }
		 });
}

function dosname(id,tempid)
{
	  noteb = jQuery('#snote-'+id.trim()).val();
	  if(noteb=="")
	  {
	  jQuery("#tr-"+id).css("background-color", "#d5ffd5");
	  <?php
	    if(isset($_GET["it"]) && $_GET["it"]=='a')
		{
	  ?>
	  jQuery("#tr-"+id).hide();
	  <?php } ?>
	  }
	  else
	  {
	     jQuery("#tr-"+id).css("background-color", "#d9d9d9");
		  <?php
	    if(isset($_GET["it"]) && $_GET["it"]=='a')
		{
	  ?>
	  jQuery("#tr-"+id).hide();
	  <?php } ?>
	  }
	  jQuery.ajax({
            url:"http://www.prestofreshgrocery.com/ajax222.php?rand="+Math.random()+"&note="+noteb+"&idstring="+id,
           context: document.body
			}).done(function(data) {
			    // alert("Information has been updated successfully");
				jQuery("#ooop-"+id).html("");
				jQuery("#ooop-"+id).html("Item has been updated successfully");
				 jQuery("#ooop-"+id).show();
		 });

	jQuery("#nfdiv-"+tempid).show();
}
function dosname2(id)
{

      jQuery('#sso-'+id).show();
	  noteb = jQuery('#snote-'+id.trim()).val();
	  jQuery("#tr-"+id).css("background-color", "#ffd9d9");
	  jQuery.ajax({
            url:"http://www.prestofreshgrocery.com/ajax3222.php?rand="+Math.random()+"&note="+noteb+"&idstring="+id,
           context: document.body
			}).done(function(data) {
			      jQuery("#ooop-"+id).html("");
			     jQuery("#ooop-"+id).html("Item has been updated successfully");
				 jQuery("#ooop-"+id).show();
		 });
}
function dopackinfo(id,newcust)
{
	  if(newcust==1)
	  {
				  d = jQuery('#txt-d-'+id.trim()).val();
				  cf = jQuery('#txt-cf-'+id.trim()).val();
				  l = jQuery('#txt-l-'+id.trim()).val();
				  b = jQuery('#txt-b-'+id.trim()).val();
				  cold_bin = jQuery('#txt-cold_bin-'+id.trim()).val();
				  cold_bag = jQuery('#txt-cold_bag-'+id.trim()).val();
				  frozen_bag = jQuery('#txt-frozen_bag-'+id.trim()).val();
				  frozen_bin = jQuery('#txt-frozen_bin-'+id.trim()).val();


				  jQuery.ajax({
						url:"http://www.prestofreshgrocery.com/ajaxpackinfo2.php?rand="+Math.random()+"&id="+id+"&d="+d+"&cf="+cf+"&l="+l+"&b="+b+"&cold_bin="+cold_bin+"&cold_bag="+cold_bag+"&frozen_bag="+frozen_bag+"&frozen_bin="+frozen_bin,
						context: document.body
						}).done(function(data) {
							// alert("packing information has been updated");
							jQuery('#updateinfo').html('Packing information has been updated. <div><br/></div>');
					 });

	  }

	  else
	  {

		     if(newcust=="")
			 {

		          jQuery('#updateinfo').html('');
				  d = jQuery('#txt-d-'+id.trim()).val();
				  cf = jQuery('#txt-cf-'+id.trim()).val();
				  l = jQuery('#txt-l-'+id.trim()).val();
				  b = jQuery('#txt-b-'+id.trim()).val();
				  cold_bin = jQuery('#txt-cold_bin-'+id.trim()).val();
				  cold_bag = jQuery('#txt-cold_bag-'+id.trim()).val();
				  frozen_bag = jQuery('#txt-frozen_bag-'+id.trim()).val();
				  frozen_bin = jQuery('#txt-frozen_bin-'+id.trim()).val();

				  jQuery.ajax({
						url:"http://www.prestofreshgrocery.com/ajaxpackinfo2.php?rand="+Math.random()+"&id="+id+"&d="+d+"&cf="+cf+"&l="+l+"&b="+b+"&cold_bin="+cold_bin+"&cold_bag="+cold_bag+"&frozen_bag="+frozen_bag+"&frozen_bin="+frozen_bin,
						context: document.body
						}).done(function(data) {
							// alert("packing information has been updated");
							jQuery('#updateinfo').html('Packing information has been updated. <div><br/></div>');
					 });

			 }
			 else
			 {

		          jQuery('#updateinfo').html('');
				  d = jQuery('#txt-d-'+id.trim()).val();
				  cf = jQuery('#txt-cf-'+id.trim()).val();
				  l = jQuery('#txt-l-'+id.trim()).val();
				  b = jQuery('#txt-b-'+id.trim()).val();
				  cold_bin = jQuery('#txt-cold_bin-'+id.trim()).val();
				  cold_bag = jQuery('#txt-cold_bag-'+id.trim()).val();
				  frozen_bag = jQuery('#txt-frozen_bag-'+id.trim()).val();
				  frozen_bin = jQuery('#txt-frozen_bin-'+id.trim()).val();

				  jQuery.ajax({
						url:"http://www.prestofreshgrocery.com/ajaxpackinfo2.php?rand="+Math.random()+"&id="+id+"&d="+d+"&cf="+cf+"&l="+l+"&b="+b+"&cold_bin="+cold_bin+"&cold_bag="+cold_bag+"&frozen_bag="+frozen_bag+"&frozen_bin="+frozen_bin,
						context: document.body
						}).done(function(data) {
							// alert("packing information has been updated");
							jQuery('#updateinfo').html('Packing information has been updated. <div><br/></div>');
					 });

			 }


	  }
}
function dohiren2(id,cust,ddate,infopicker,itemqty,name,itemid)
{
        noteb = jQuery('#'+id.trim()).val();
	    jQuery('#div-'+id).html('<span style="font-weight:bold;color:#999;">Processing....</span>');
	    jQuery("#trid-"+id).css("background-color", "#d5ffd5");
        jQuery.ajax({
url:"http://www.prestofreshgrocery.com/ajax2.php?rand="+Math.random()+"&note="+noteb+"&cust="+cust+"&idstring="+id+"&ddate="+ddate+"&infopicker="+infopicker+"&itemqty="+itemqty+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			  jQuery('#div-'+id).html('<span style="font-weight:bold;color:green;">Status :- Found<br/> Note :- '+noteb+'</span>');
			  jQuery('#packdiv-'+id).show();
		 });

}
function dohiren2h(id,cust,ddate,infopicker,itemqty,name,itemid)
{
       jQuery('#dpackdiv-'+itemid).show();
       noteb = jQuery('#'+id.trim()).val();
	   jQuery('#div-'+id).html('<span style="font-weight:bold;color:#999;">Processing....</span>');
	    jQuery("#trid-"+id).css("background-color", "#d5ffd5");
       jQuery.ajax({
url:"http://www.prestofreshgrocery.com/ajax2.php?rand="+Math.random()+"&note="+noteb+"&cust="+cust+"&idstring="+id+"&ddate="+ddate+"&infopicker="+infopicker+"&itemqty="+itemqty+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			  jQuery('#div-'+id).html('<span style="font-weight:bold;color:green;">Status :- Found<br/> Note :- '+noteb+'</span>');
			  jQuery('#dpackdiv-'+itemid).show();
		 });
}
function dohiren2hk(id,cust,ddate,infopicker,itemqty,name,itemid)
{
       jQuery('#dpackdiv-'+itemid).show();
       noteb = jQuery('#'+id.trim()).val();
	   jQuery('#div-'+id).html('<span style="font-weight:bold;color:#999;">Processing....</span>');
	    jQuery("#trid-"+id).css("background-color", "#d5ffd5");
       jQuery.ajax({
url:"http://www.prestofreshgrocery.com/ajax2.php?rand="+Math.random()+"&note="+noteb+"&cust="+cust+"&idstring="+id+"&ddate="+ddate+"&infopicker="+infopicker+"&itemqty="+itemqty+"&itemid="+itemid,
           context: document.body
			}).done(function(data) {
			  jQuery('#div-'+id).html('<span style="font-weight:bold;color:green;">Status :- Found<br/> Note :- '+noteb+'</span>');
		 });
}
function dohiren333(id)
{
   k=confirm('Are you sure this product is found ? ');
   if(k==true)
   {
       jQuery.ajax({
            url:"http://www.prestofreshgrocery.com/ajax3uu.php?rand="+Math.random()+"&idstring="+id,
           context: document.body
			}).done(function(data) {
			    jQuery('#tr-'+id).hide();
		 });
   }
}
function ddohiren333(id)
{
   k=confirm('Are you sure this product is found ? ');
   if(k==true)
   {
       jQuery.ajax({
            url:"http://www.prestofreshgrocery.com/ajax333.php?rand="+Math.random()+"&idstring="+id,
           context: document.body
			}).done(function(data) {
			    jQuery('#tr-'+id).hide();
		 });
   }
}
</script>
<style>
.mini-search select
{
    width:158px !important;
}


</style>
<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/**
 * @var Mage_Page_Block_Html_Header $this
 */
     $connection = Mage::getSingleton('core/resource')->getConnection('core_write');
     if(isset($_POST["note"]))
	 {
	      $query = "insert into `supervision` set `idstring` = '".$_POST["idstring"]."',infopicker='".$_POST["infopicker"]."',itemqty='".$_POST["itemqty"]."',cust='".$_POST["cust"]."',note='".$_POST["note"]."',ddate='".$_POST["ddate"]."' ";
		  $connection->query($query);
	 }
if(isset($_POST["starttime"]))
{
  $update="update route_driver set starttime='".$_POST["starttime"]."',endtime='".$_POST["endtime"]."',exptype='".$_POST["exptype"]."',expr='".$_POST["expr"]."' where route='".$_POST["routename"]."' and driver='".$_POST["driverc"]."'";
    $connection->query($update);
?>
<!-- <script>
   alert("Timing & expenses infromation has been updated successfully");
</script> -->
<?php
}
$islogincheck=Mage::getSingleton('customer/session')->isLoggedIn();
if($islogincheck==1)
{
     if(Mage::registry('current_product'))
		{
		  // Product detail page
		}
     else {
     $session = Mage::getSingleton('customer/session');
     $group_id = $session->getCustomerGroupId();

	 if($group_id==22)
	 {
	   $bbr=1;
	   $group_id=24;
	 }
		 $customerData = Mage::getModel('customer/customer')->load($session->getId())->getData();
	}
}
if($group_id==22 || $group_id==23 || $group_id==24 )
{
   echo '<style>
   table
   {
       border:1px solid #000 !important;
   }
   </style>';
?>

<style>
table
{
   font-size:14px !important;
}
input,textarea,p,select,a,body
{
  font-size:14px !important;
  font-family:arial;
}
</style>

<script type="text/javascript">
    jQuery(document).ready(function() {
    jQuery('#appwork input').bind('keypress', function (event) {
    var regex = new RegExp("'");
    var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
    if (regex.test(key)) {
       event.preventDefault();
       return false;
    }
    });

	jQuery('#appwork textarea').bind('keypress', function (event) {
    var regex = new RegExp("'");
    var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
    if (regex.test(key)) {
       event.preventDefault();
       return false;
    }
    });
	jQuery('#appwork input').bind('keypress', function (event) {
    var regex = new RegExp("&");
    var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
    if (regex.test(key)) {
       event.preventDefault();
       return false;
    }
    });

	jQuery('#appwork textarea').bind('keypress', function (event) {
    var regex = new RegExp("&");
    var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
    if (regex.test(key)) {
       event.preventDefault();
       return false;
    }
    });
});


function dorefund(itemid,idstring)
	{

	   bcd=(jQuery('#chkref-'+itemid).is(':checked'));

	   if(bcd==true)
	   {
		  bcd=1;
		  k=confirm('Are you sure you want to refund this item ?');

	   }
	   else
	   {
		 bcd=0;
		 k=confirm('Are you sure you remove this item from refund list?');
	   }

	   /* if(bcd==1)
	   {
	      notey = jQuery('#snote-'+idstring).val();
		  notey = notey + " ,Price adjustment will be done";
		  jQuery('#snote-'+idstring).val(notey);
		  dosname(idstring,itemid);
	   }
	   if(bcd==0)
	   {
	      notey = jQuery('#snote-'+idstring).val();
	      var result=notey.split(',Price adjustment will be done');
		 // alert(result[0]);
		  jQuery('#snote-'+idstring).val(result[0]);
		  //jQuery('#snote-'+idstring).val(result);
		  dosname(idstring,itemid);
	   } */

	   if(k==true)
	   {

		  jQuery.ajax({
			   url: "https://www.prestofreshgrocery.com/ajaxrefund.php?rand="+Math.random()+"&itemid="+itemid+"&refund="+bcd,
			   context: document.body
				}).done(function(data) {
				 if(data==1)
				 {
					alert("item has been refunded successfully");
				 }
				 else if(data==0)
				 {
				   alert("item has been removed from refund list successfully");
				 }
			 });
	   }


	}

</script>


<?php
}
?>

<div id="appwork">
<?php
if($group_id==24)
{
    if(isset($_POST["dodate"]) && $_POST["dodate"]!="" )
	 {
	      $check="select pickerid from pickerlog where dodate='".$_POST["dodate"]."' and pickerid='".$_POST["pickerid"]."'";
	      $check_confirm=$connection->fetchOne($check);

		 if($check_confirm=="")
	    {
	      $insert="insert into pickerlog set pickerst='".$_POST["pickerst"]."',pickerst2='".$_POST["pickerst2"]."',pickerst3='".$_POST["pickerst3"]."',pickerid='".$_POST["pickerid"]."',dodate='".$_POST["dodate"]."'";
		  $connection->query($insert);
	   }
	   else
	   {
	      $update="update pickerlog set pickerst='".$_POST["pickerst"]."',pickerst2='".$_POST["pickerst2"]."',pickerst3='".$_POST["pickerst3"]."' where dodate='".$_POST["dodate"]."' and pickerid='".$_POST["pickerid"]."'";
		  $connection->query($update);
	   }
	   ?>
	   <script>
	   alert("working hours have been updated successfully");
	   </script>
	   <?php
	 }

	if(isset($_POST["dodate2"]) && $_POST["dodate2"]!="" )
	 {
	     $check="select id from expenses where dodate2='".$_POST["dodate2"]."' ";
	     $check_confirm=$connection->fetchOne($check);

		 if($check_confirm=="")
	    {
	      $insert="insert into expenses set pickerst2='".$_POST["pickerst2"]."',pickerst3='".$_POST["pickerst3"]."',pickerst4='".$_POST["pickerst4"]."',semail='".$_POST["semail"]."',dodate2='".$_POST["dodate2"]."'";
		  $connection->query($insert);
	   }
	   else
	   {
	      $update="update expenses set pickerst2='".$_POST["pickerst2"]."',pickerst3='".$_POST["pickerst3"]."',pickerst4='".$_POST["pickerst4"]."' where dodate2='".$_POST["dodate2"]."'";
		  $connection->query($update);
	   }
	 ?>
	   <script>
	   alert("Expenses have been updated successfully");
	   </script>
	 <?php
	 }
?>
      <style>
@import url(http://fonts.googleapis.com/css?family=Open+Sans:400,700);
#cssmenu,
#cssmenu ul,
#cssmenu ul li,
#cssmenu ul li a,
#cssmenu #menu-button {
  margin: 0;
  padding: 0;
  border: 0;
  list-style: none;
  line-height: 1;
  display: block;
  position: relative;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
body
{
   font-family:verdana;
}
#cssmenu:after,
#cssmenu > ul:after {
  content: ".";
  display: block;
  clear: both;
  visibility: hidden;
  line-height: 0;
  height: 0;
}
#cssmenu #menu-button {
  display: none;
}
#cssmenu {
  width: auto;
  border-radius: 5px;
  font-family: 'Open Sans', Helvetica, sans-serif;
  background:#65ae31;
}
#cssmenu.align-center > ul {
  font-size: 0;
  text-align: center;
}
#cssmenu.align-center ul ul {
  text-align: left;
}
#cssmenu.align-center > ul > li {
  display: inline-block;
  float: none;
}
#cssmenu.align-right > ul > li {
  float: right;
}
#cssmenu.align-right ul ul {
  text-align: right;
}
#cssmenu > ul > li {
  float: left;
}
#cssmenu > ul > li > a {
  padding: 10px 6px;
  font-size: 12px;
  color: #ffffff;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
  font-weight: 700;
  text-decoration: none;
  -webkit-transition: color .2s ease;
  -moz-transition: color .2s ease;
  -ms-transition: color .2s ease;
  -o-transition: color .2s ease;
  transition: color .2s ease;
}
#cssmenu > ul > li:hover > a,
#cssmenu > ul > li > a:hover,
#cssmenu > ul > li.active > a {
  color: #cae5fd;
}
#cssmenu > ul > li.has-sub > a {
  padding-right: 40px;
}
#cssmenu ul > li.has-sub > a:after {
  content: '';
  position: absolute;
  right: 5px;
  top: 17.5px;
  display: block;
  width: 18px;
  height: 18px;
  border-radius: 9px;
  background:#008000 ;
  background-size: 36px 36px;
  background-position: 0 0;
  background-repeat: no-repeat;
  -webkit-transition: all 0.1s ease-out;
  -moz-transition: all 0.1s ease-out;
  -ms-transition: all 0.1s ease-out;
  -o-transition: all 0.1s ease-out;
  transition: all 0.1s ease-out;
}
#cssmenu ul > li.has-sub:hover > a:after {
  background-position: 0 -18px;
}
#cssmenu ul > li.has-sub > a:before {
  content: '';
  position: absolute;
  right: 11px;
  top: 25.5px;
  display: block;
  width: 0;
  height: 0;
  border: 3px solid transparent;
  border-top-color: #ffffff;
  z-index: 99;
}
#cssmenu ul > li.has-sub:hover > a:before {
  border-top-color: #19799f;
}
#cssmenu ul ul {
  position: absolute;
  left: -9999px;
  opacity: 0;
  -webkit-transition: top .2s ease, opacity .2s ease;
  -moz-transition: top .2s ease, opacity .2s ease;
  -ms-transition: top .2s ease, opacity .2s ease;
  -o-transition: top .2s ease, opacity .2s ease;
  transition: top .2s ease, opacity .2s ease;
}
#cssmenu > ul > li > ul {
  top: 91px;
  padding-top: 8px;
  border-radius: 5px;
}
#cssmenu > ul > li:hover > ul {
  left: auto;
  top: 51px;
  opacity: 1;
}
#cssmenu.align-right > ul > li:hover > ul {
  right: 0;
}
#cssmenu ul ul ul {
  top: 40px;
}
#cssmenu ul ul > li:hover > ul {
  top: 0;
  left: 178px;
  padding-left: 10px;
  opacity: 1;
}
#cssmenu.align-right ul ul > li:hover > ul {
  left: auto;
  right: 178px;
  padding-left: 0;
  padding-right: 10px;
  opacity: 1;
}
#cssmenu ul ul li a {
  width: 180px;
  padding: 12px 25px;
  font-size: 13px;
  font-weight: 700;
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
  color: #ffffff;
  text-decoration: none;
  background: ;
  -webkit-transition: color .2s ease;
  -moz-transition: color .2s ease;
  -ms-transition: color .2s ease;
  -o-transition: color .2s ease;
  transition: color .2s ease;
}
#cssmenu ul ul li:hover > a,
#cssmenu ul ul li > a:hover,
#cssmenu ul ul li.active > a {
  color: #cae5fd;
}
#cssmenu ul ul li:first-child > a {
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  box-shadow: inset 0 2px 2px #88d0ed;
}
#cssmenu ul ul li:last-child > a {
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
  box-shadow: inset 0 -3px 0 #27a9de, inset 0 -3px 3px #1f9acc, 0 1px 1px rgba(0, 0, 0, 0.03), 0 2px 2px rgba(0, 0, 0, 0.05), 0 2px 3px rgba(0, 0, 0, 0.13);
}
#cssmenu ul ul > li.has-sub > a:after {
  right: 12px;
  top: 9.5px;
  background: ;
  background: -webkit-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  background: -ms-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  background: -moz-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  background: -o-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  background: linear-gradient(to bottom, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  box-shadow: inset 0 -1px 1px #209ed0, inset 0 2px 1px #7fcceb;
  background-size: 36px 36px;
  background-position: 0 0;
  background-repeat: no-repeat;
}
#cssmenu.align-right ul ul > li.has-sub > a:after {
  right: auto;
  left: 12px;
}
#cssmenu ul ul > li.has-sub:hover > a:after {
  background-position: 0 -18px;
}
#cssmenu ul ul > li.has-sub > a:before {
  top: 15.5px;
  right: 16px;
  border-top-color: transparent;
  border-left-color: #ffffff;
}
#cssmenu.align-right ul ul > li.has-sub > a:before {
  top: 15.5px;
  right: auto;
  left: 16px;
  border-top-color: transparent;
  border-right-color: #ffffff;
  border-left-color: transparent;
}
#cssmenu ul ul > li.has-sub:hover > a:before {
  border-top-color: transparent;
  border-left-color: #1c89b5;
}
#cssmenu.align-right ul ul > li.has-sub:hover > a:before {
  border-top-color: transparent;
  border-left-color: transparent;
  border-right-color: #1c89b5;
}
@media all and (max-width: 768px), only screen and (-webkit-min-device-pixel-ratio: 2) and (max-width: 1024px), only screen and (min--moz-device-pixel-ratio: 2) and (max-width: 1024px), only screen and (-o-min-device-pixel-ratio: 2/1) and (max-width: 1024px), only screen and (min-device-pixel-ratio: 2) and (max-width: 1024px), only screen and (min-resolution: 192dpi) and (max-width: 1024px), only screen and (min-resolution: 2dppx) and (max-width: 1024px) {
  #cssmenu {
width: 90%;
}
  #cssmenu ul,
  #cssmenu ul ul,
  #cssmenu ul ul ul,
  #cssmenu > ul,
  #cssmenu.align-center > ul,
  #cssmenu > ul > li > ul,
  #cssmenu > ul > li:hover > ul,
  #cssmenu ul ul li:hover > ul,
  #cssmenu ul ul ul li:hover > ul,
  #cssmenu.align-right ul ul,
  #cssmenu.align-right ul ul li:hover > ul,
  #cssmenu.align-right ul ul ul li:hover > ul {
    position: relative;
    left: 0;
    right: auto;
    top: 0;
    width: 100%;
    display: none;
    padding: 0;
    opacity: 1;
    text-align: left;
  }
  #cssmenu ul li {
    width: 100%;
    border-top: 1px solid rgba(120, 120, 120, 0.2);
  }
  #cssmenu > ul > li > a,
  #cssmenu ul ul li a,
  #cssmenu ul ul li:first-child > a,
  #cssmenu ul ul li:last-child > a {
    width: 100%;
    border-radius: 0;
    box-shadow: none;
    background: none;
  }
  #cssmenu ul li a {
    padding-left: 12.5px;
  }
  #cssmenu ul ul li a {
    padding: 14px 25px 14px 27.5px;
  }
  #cssmenu ul ul ul li a {
    padding-left: 42.5px;
  }
  #cssmenu ul ul ul ul li a {
    padding-left: 57.5px;
  }
  #cssmenu > ul > li.has-sub > a:after,
  #cssmenu > ul > li.has-sub > a:before,
  #cssmenu ul ul li.has-sub > a:after,
  #cssmenu ul ul li.has-sub > a:before {
    display: none;
  }
  #cssmenu #menu-button {
    position: relative;
    display: block;
    padding: 10px;
    padding-left: 12.5px;
    cursor: pointer;
    font-size: 13px;
    color: #ffffff;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  #cssmenu .submenu-button {
    position: absolute;
    right: 0;
    display: block;
    width: 53px;
    height: 53px;
    border-left: 1px solid rgba(120, 120, 120, 0.2);
    z-index: 10;
    cursor: pointer;
  }
  #cssmenu ul ul .submenu-button {
    height: 41px;
  }
  #cssmenu ul .submenu-button:after,
  #cssmenu #menu-button:after {
    content: '';
    position: absolute;
    right: 12.5px;
    top: 12.5px;
    display: block;
    width: 28px;
    height: 28px;
    border-radius: 15px;
    background: #008000;
    background: -webkit-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
    background: -ms-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
    background: -moz-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
    background: -o-linear-gradient(top, #58bde5 0%, #4ab7e3 25%, #2babde 50%, #58bde5 75%, #4ab7e3 100%);
    background: linear-gradient(to bottom, #58bde5 0%, #4ab7e3 25%, #2babde 50%, #58bde5 75%, #4ab7e3 100%);
    box-shadow: inset 0 -1px 1px #209ed0, inset 0 2px 1px #7fcceb;
    background-size: 56px 56px;
    background-position: 0 0;
    background-repeat: no-repeat;
    -webkit-transition: all 0.1s ease-out;
    -moz-transition: all 0.1s ease-out;
    -ms-transition: all 0.1s ease-out;
    -o-transition: all 0.1s ease-out;
    transition: all 0.1s ease-out;
  }
  #cssmenu ul .submenu-button.submenu-opened:after,
  #cssmenu #menu-button.menu-opened:after {
    background-position: 0 -28px;
  }
  #cssmenu ul ul .submenu-button:after {
    top: 6.5px;
  }
  #cssmenu #menu-button:before,
  #cssmenu .submenu-button:before {
    content: '';
    position: absolute;
    right: 22.5px;
    top: 16.5px;
    display: block;
    width: 0;
    height: 0;
    border: 4px solid transparent;
    border-top-color: #ffffff;
    z-index: 99;
  }
  #cssmenu ul ul .submenu-button:before {
    top: 19.5px;
  }
  #cssmenu #menu-button.menu-opened:before,
  #cssmenu .submenu-button.submenu-opened:before {
    border-top-color: #19799f;
  }
}

</style>
      <script>
(function($) {
  $.fn.menumaker = function(options) {

      var cssmenu = $(this), settings = $.extend({
        title: "Menu",
        format: "dropdown",
        sticky: false
      }, options);

      return this.each(function() {


        cssmenu.prepend('<div id="menu-button">' + settings.title + '</div>');
        $(this).find("#menu-button").on('click', function(){
          $(this).toggleClass('menu-opened');
          var mainmenu = $(this).next('ul');
          if (mainmenu.hasClass('open')) {
            mainmenu.hide().removeClass('open');
          }
          else {
            mainmenu.show().addClass('open');
            if (settings.format === "dropdown") {
              mainmenu.find('ul').show();
            }
          }
        });

        cssmenu.find('li ul').parent().addClass('has-sub');

        multiTg = function() {
          cssmenu.find(".has-sub").prepend('<span class="submenu-button"></span>');
          cssmenu.find('.submenu-button').on('click', function() {
            $(this).toggleClass('submenu-opened');
            if ($(this).siblings('ul').hasClass('open')) {
              $(this).siblings('ul').removeClass('open').hide();
            }
            else {
              $(this).siblings('ul').addClass('open').show();
            }
          });
        };

        if (settings.format === 'multitoggle') multiTg();
        else cssmenu.addClass('dropdown');

        if (settings.sticky === true) cssmenu.css('position', 'fixed');

        resizeFix = function() {
          if ($( window ).width() > 768) {
            cssmenu.find('ul').show();
          }

          if ($(window).width() <= 768) {
            cssmenu.find('ul').hide().removeClass('open');
          }
        };
        resizeFix();
        return $(window).on('resize', resizeFix);

      });
  };
})(jQuery);

(function($){
$(document).ready(function(){

$("#cssmenu").menumaker({
   title: "Menu",
   format: "multitoggle"
});


});
})(jQuery);
</script>
      <div style="margin-top:10px;color:green;font-weight:bold;text-align:right;margin-right:10px">
<?php echo date('m-d-Y H:i:s'); ?>
</div>
<div id='cssmenu' style="margin-top:15px;margin-bottom:10px;">
<ul>
   <li><a href="http://www.prestofreshgrocery.com/?gt=dpick" id="gtdpicklist" style=""> Dry Pick List </a></li>
   <li><a href="http://www.prestofreshgrocery.com/?gt=dpack" id="gtdpacklist" style=""> Dry Pack List </a></li>
   <li><a href="http://www.prestofreshgrocery.com/?gt=cpick" id="gtcpicklist" style=""> Cold Pick List </a></li>
   <li><a href="http://www.prestofreshgrocery.com/?gt=fpick" id="gtfpicklist" style=""> Frozen Pick List </a></li>
   <li><a href="http://www.prestofreshgrocery.com/?gt=cfpack" id="gtdpacklist" style=""> Cold / Frozen Pack List </a></li>
   <li><a href="http://www.prestofreshgrocery.com/?gt=nf" id="" style=""> Not Found  </a></li>
   <li><a href="http://www.prestofreshgrocery.com/?gt=llist" id="" style=""> Load List </a></li>
   <?php
         if(isset($_GET["std"])) { ?>
   <li><a href="http://www.prestofreshgrocery.com/?gt=dlist&tip=1" id="gtdpacklist" style=""> Driver List </a></li>
   <?php } else { ?>
   <li><a href="http://www.prestofreshgrocery.com/?gt=dlist" id="gtdpacklist" style=""> Driver List </a></li>
   <?php } ?>

	  <?php if($bbr!=1) {
	  ?>
	   <li><a href="http://www.prestofreshgrocery.com/?gt=ltime" id="" style=""> Log Time </a></li>
	   <?php } ?>

   <li><a href="http://www.prestofreshgrocery.com/?gt=pm" />PM</a></li>

   <li><?php echo "<a href=\"".Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB)."customer/account/logout/\"  />Logout</a>"; ?></li>
</ul>
</div>
<?php
echo '<style>
body>.wrapper
{
   background:#fff !important;
   font-weight:bold;
   color:#000;
   overflow:hidden;
}
.page
{
   width:90%;
}
td, th
{
   padding-top:5px !important;
   padding-left:5px !important;
   padding-bottom:5px !important;
   font-weight:bold !important;
}
th
{
    font-weight:bold;
	color:#fff;
	background-color:green;
}
input[type="button"]
{
   margin-top:5px;
    margin-left:5px;
}
body
{
  background:none !important;
}
</style>';
 if( isset($_GET["rpc"]) && $_GET["rpc"]!="" )
	{
?>
<style>
.page
{
   width:90%;
}

td, th
{
   padding:5px !important;
   font-size:12px;
   color:#000;
}

table
{
   border-color:#000;
}

th
{
   color:#fff;
   background-color:green;
}
</style>
<div style="margin-top:10px;margin-bottom:10px;color:red;font-weight:bold;"> Request a Product Change </div>
<div style="margin-top:30px;font-weight:bold;">
<?php
          $sql33="select msi.name FROM `mg_sales_flat_order_item` msi where msi.item_id='".$_GET["item_id"]."' ";
		  echo $rows274pro = $connection->fetchOne($sql33);

		  if(isset($_GET["rdata"]))
		  {
		     $sccheck="select item_id from `rchange` where item_id='".$_GET["item_id"]."'";
			 $dsccheck=$connection->fetchOne($sccheck);

			 if($dsccheck=="")
			 {
			  $query = "insert into `rchange` set `rpc` = '".$_GET["rpc"]."',item_id='".$_GET["item_id"]."',
chk1='".$_GET["chk1"]."',chk2='".$_GET["chk2"]."',chk3='".$_GET["chk3"]."',chk4='".$_GET["chk4"]."',rnote='".$_GET["rnote"]."',scemail='".$_GET["scemail"]."' ";
		      $connection->query($query);
			 }
			 else
			 {
			  $query = "update `rchange` set `rpc` = '".$_GET["rpc"]."',
chk1='".$_GET["chk1"]."',chk2='".$_GET["chk2"]."',chk3='".$_GET["chk3"]."',chk4='".$_GET["chk4"]."',rnote='".$_GET["rnote"]."',scemail='".$_GET["scemail"]."' where item_id='".$_GET["item_id"]."'";
		      $connection->query($query);
			 }
		  }
		  $sel_data="select * from rchange where item_id='".$_GET["item_id"]."'";
		  $rs_data=$connection->fetchAll($sel_data);
		  foreach ($rs_data as $value3) {
		  }

?>		   <div style="margin-top:10px;">
		   <form method="GET" action="" style="font-weight:normal;" >
		   <input type="hidden" name="rpc" value="<?php echo $_GET['rpc']; ?>" />
		   <input type="hidden" name="item_id" value="<?php echo $_GET['item_id']; ?>" />

		   Remove Product (no tag) <input type="checkbox" value="Remove Product" name="chk1" <?php if($value3["chk1"]=='Remove Product') { ?> checked <?php } ?>  >
		   <br/>
		   Change Price <input type="checkbox" value="Change Price" name="chk2" <?php if($value3["chk2"]=='Change Price') { ?> checked <?php } ?> >
		   <br/>
		   Change Name/Photo/Description <input type="checkbox" value="Change Name/Photo/Description" name="chk3" <?php if($value3["chk3"]=='Change Name/Photo/Description') { ?> checked <?php } ?> >
		    <br/>
		   Change Location <input type="checkbox" value="Change Location" name="chk4" <?php if($value3["chk4"]=='Change Location') { ?> checked <?php } ?>  >
		    <br/>
			<div style="font-weight:bold;margin-top:15px;">Note</div>
		   <textarea name="rnote" style="width:200px;border:1px solid #000;"><?php echo $value3["rnote"]; ?></textarea>
		   <br/>
		   <input type="hidden" name="scemail" id="scemail" value="<?php echo $customerData["email"]; ?>" />
		   <input type="submit" style="background-color:green;padding:5px;color:#fff;margin-top:5px;margin-bottom:5px;" name="rdata" value="Submit Note"  />
		   </form>
		   </div>
		   </div>
<?php
	}
        if(isset($_GET["oid"]) && $_GET["oid"]!="" ) {

     if(isset($_GET["dnote"]) && $_GET["dnote"]!="" )
	 {
	     $check="select status from drivlist where ordernumber='".$_GET["oid"]."'";
	     $check_confirm=$connection->fetchOne($check);

		if($check_confirm=="")
	    {
	      $insert="insert into drivlist set dnote='".$_GET["dnote"]."',ordernumber='".$_GET["oid"]."'";
		  $connection->query($insert);
	    }
	   else
	   {
	      $update="update drivlist set dnote='".$_GET["dnote"]."' where ordernumber='".$_GET["oid"]."'";
		  $connection->query($update);
	   }
	 }
     $order = Mage::getModel('sales/order')->load($_GET["oid"], 'increment_id');
	 $order->getAllVisibleItems();
	 $address = $order->getShippingAddress();
	 $address2 = $order->getBillingAddress();
	 $orderValue = $order->getSubtotal();
	 $orderValue2 = $order->getBaseGrandTotal();
?>
<style>
.page
{
   width:90%;
}

td, th
{
   padding:5px !important;
   font-size:12px;
   color:#000;
}

table
{
   border-color:#000;
}

th
{
   color:#fff;
   background-color:green;
}
</style>
<div style="border-bottom:0px solid #dfdfdf;margin-bottom:5px;" >
<h3 class="icon-head head-manage-blog" style="padding-left:0px;color:#eb5e00;">Order Details ( <?php echo $_GET["oid"]; ?> )</h3>
<?php
$currentUrl = Mage::helper('core/url')->getCurrentUrl();
$url77 = explode("?oid=",$currentUrl);
?>

</div>
	   <table width="48%;" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;">
	 <tr >
	 <td style="color:green;"> <b> Delivery Address  </b> </td>
	 </tr>
	 <tr>
	 <td>
	            <?php
				echo $custName = $address->getName()."<br/>";
				echo $custAddr = $address->getStreetFull()."<br/>";
				echo $region2 = $address->getCity()."<br/>";
				echo $region = $address->getRegion()."<br/>";
				echo $country = $address["postcode"];
				?>
	</td>
	</tr>
	</table>
	<table width="48%;"" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;margin-left:1%">
	 <tr >
	 <td style="color:green;"> <b> Billing Address  </b> </td>
	 </tr>
	 <tr>
	 <td>	    <?php
				echo $custName = $address2->getName()."<br/>";
				echo $custAddr = $address2->getStreetFull()."<br/>";
				echo $region2 = $address2->getCity()."<br/>";
				echo $region = $address2->getRegion()."<br/>";
				echo $country = $address2["postcode"];
				?>
	</td>
	</tr>
	</table>	<br/>
<?php
   $value["order_number"] = $_GET["oid"];
   if($value["order_number"]!="")
		   {
		       $sql2  = "SELECT entity_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows2 = $connection->fetchOne($sql2);
			   echo "<br/>";
				$sql3 = "SELECT msi.item_id,mei.value,msi.product_id,msi.price,msi.row_total,msi.qty_ordered,msi.name,msi.sku ,msi.refund FROM `mg_sales_flat_order_item` msi
			    left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251
			    where msi.`order_id`='".$rows2."'";
			    $rows3 = $connection->fetchAll($sql3);
			   ?>
			   <div style="clear:both;">&nbsp;</div>
			   <table border=1 cellpadding="5" cellspacing="5" border="1" style="border-collapse:collapse;margin-top:15px;" >
			   <tr>
			   <th>Product Name</th>
			   <th>Qty.</th>
			   <th>Refund</th>
			   </tr>
			   <?php
			   foreach ($rows3 as $value3) {
				$_resource = Mage::getSingleton('catalog/product')->getResource();
				$optionValue1 = $_resource->getAttributeRawValue($value3["product_id"],'protype', Mage::app()->getStore());
				$product = Mage::getModel('catalog/product')->setStoreId($store_id)->setProtype($optionValue1);
                $optionLabel1 = $product->getAttributeText('protype');
				$optionValue4 = $_resource->getAttributeRawValue($value3["product_id"],'vendor_product_id', Mage::app()->getStore());
				$sel_status="select status from `supervision` where item_id='".$value3["item_id"]."'";
				$status=$connection->fetchOne($sel_status);
				$sel_substitute="select substitute from `supervision` where item_id='".$value3["item_id"]."'";
				$substitute=$connection->fetchOne($sel_substitute);
				if($substitute!='') {
			   ?>
			    <tr style="background:red;color:#fff;">
				<td style="background:red;color:#fff;" ><?php echo $value3["name"]; ?>
				<?php if($substitute!="") { ?>
				<br/>
				<b>Substitute Item :- <?php echo $substitute; ?> </b>
				<?php } ?>
				</td>
				<td style="background:red;color:#fff;" ><?php echo round($value3["qty_ordered"],0); ?></td>
				<td style="font-weight:bold;font-size:12px;"><div style="color:#000;margin-top:15px;"> <input type="checkbox" name="chkref-<?php echo $value3['item_id']; ?>" id="chkref-<?php echo $value3['item_id']; ?>" <?php if($value3['refund']==1) { echo "checked"; } ?> value="<?php echo $value3['item_id']; ?>" onClick="dorefund(<?php echo $value3['item_id']; ?> )" /> Refund Item </div></td>
				</tr>
				<?php } else { ?>
				<tr >
				<td><?php echo $value3["name"]; ?></td>
				<td style="font-weight:bold;font-size:15px;"><?php echo round($value3["qty_ordered"],0); ?></td>
				<td style="font-weight:bold;font-size:12px;"><div style="color:#000;margin-top:15px;"> <input type="checkbox" name="chkref-<?php echo $value3['item_id']; ?>" id="chkref-<?php echo $value3['item_id']; ?>" <?php if($value3['refund']==1) { echo "checked"; } ?> value="<?php echo $value3['item_id']; ?>" onClick="dorefund(<?php echo $value3['item_id']; ?> )" /> Refund Item </div></td>
				</tr>
				<?php }
			   }
			   ?>
			    </table>
			   <?php
		        }
		       ?>
		   <form method="get" name="frmdnote">
		   <input type="hidden" name="oid" id="oid" value="<?php echo $_GET["oid"]; ?>" />
		    <br/>
		   <b>Delivery Notes</b>
		   <?php
		   $check="select dnote from drivlist where ordernumber='".$_GET["oid"]."'";
	       $check_dnote=$connection->fetchOne($check);
		   ?>
		   <br/>
		   <textarea name="dnote" style="width:280px;border:1px solid #000;"><?php echo $check_dnote; ?></textarea>
		   <br/>
		   <input type="submit" style="background-color:green;padding:5px;color:#fff;margin-top:5px;margin-bottom:5px;" name="std" value="Submit Note"  /> &nbsp; <a href="https://www.prestofreshgrocery.com?ooid=<?php echo $_GET["oid"]; ?>"> Serve Order </a>
		   </form>
		  <?php
		  exit(0);
           }
		if(isset($_GET["ooid"]) && $_GET["ooid"]!="" ) {
     if(isset($_GET["sign"]) && $_GET["sign"]!="" )
	 {
	     $check="select status from drivlist where ordernumber='".$_GET["ooid"]."'";
	     $check_confirm=$connection->fetchOne($check);

		  $sel_estt="select estt from mg_shipping_delivery_window where order_number='".$_GET["ooid"]."'";
		  $rs_estt=$connection->fetchOne($sel_estt);

		 $time = $rs_estt ;
         $estt=date("H:i", strtotime($time));
		 $estt=$estt.":00";
		 $estt=strtotime($estt);

		 $curtime = now();
		 $newb=explode(" ",$curtime);
		 $hhmm=explode(":",$newb[1]);
		 $realtime=$hhmm[0].":".$hhmm[1].":00";
		 $realtime=strtotime($realtime);
		 $diff = $estt - $realtime;
		 $minutes = $diff / 60 ;

		if($check_confirm=="")
	    {

	      $insert="insert into drivlist set sign='".$_GET["sign"]."',ordernumber='".$_GET["ooid"]."',status=1,tip='".$_GET["tip"]."',nowtime='".now()."',popup='".$minutes."'";
		  $connection->query($insert);

		  $update="update mg_shipping_delivery_window set popup='".$minutes."',nowtime='".now()."' where order_number='".$_GET["ooid"]."'";
		  $connection->query($update);

	   }
	   else
	   {
	      $update="update drivlist set sign='".$_GET["sign"]."',tip='".$_GET["tip"]."',status=1,popup='".$minutes."',nowtime='".now()."' where ordernumber='".$_GET["ooid"]."'";
		  $connection->query($update);

		  $update="update mg_shipping_delivery_window set popup='".$minutes."',nowtime='".now()."' where order_number='".$_GET["ooid"]."'";
		  $connection->query($update);

	   }
	 }
     $order = Mage::getModel('sales/order')->load($_GET["ooid"], 'increment_id');
	 $order->getAllVisibleItems();
	 $address = $order->getShippingAddress();
	 $address2 = $order->getBillingAddress();
	 $orderValue = $order->getSubtotal();
	 $orderValue2 = $order->getBaseGrandTotal();
?>
<style>
.page
{
   width:90%;
}

td, th
{
   padding:5px !important;
   font-size:12px;
   color:#000;
}

table
{
   border-color:#000;
}

th
{
   color:#fff;
   background-color:green;
}
</style>
<div style="border-bottom:0px solid #dfdfdf;margin-bottom:5px;" >
<h3 class="icon-head head-manage-blog" style="padding-left:0px;color:#eb5e00;">Order No :- <a href="https://www.prestofreshgrocery.com?oid=<?php echo $_GET["ooid"]; ?>"><?php echo $_GET["ooid"]; ?></a></h3>
<?php
$currentUrl = Mage::helper('core/url')->getCurrentUrl();
$url77 = explode("?oid=",$currentUrl);
?>
     </div>
     <table width="48%;" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;">
	 <tr >
	 <td style="color:green;"> <b> Delivery Address  </b> </td>
	 </tr>
	 <tr>
	 <td>
	            <?php
				echo $custName = $address->getName()."<br/>";
				echo $custAddr = $address->getStreetFull()."<br/>";
				echo $region2 = $address->getCity()."<br/>";
				echo $region = $address->getRegion()."<br/>";
				echo $country = $address["postcode"];
				?>
	</td>
	</tr>
	</table>
	<table width="48%;"" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;margin-left:1%">
	 <tr >
	 <td style="color:green;"> <b> Billing Address  </b> </td>
	 </tr>
	 <tr>
	 <td>
	            <?php
				echo $custName = $address2->getName()."<br/>";
				echo $custAddr = $address2->getStreetFull()."<br/>";
				echo $region2 = $address2->getCity()."<br/>";
				echo $region = $address2->getRegion()."<br/>";
				echo $country = $address2["postcode"];
				?>
	</td>
	</tr>
	</table>
             <?php
             $value["order_number"] = $_GET["ooid"]; ?>
		     <?php $sql3    = "SELECT ss.substitute ,msi.item_id,msi.product_id,msi.price,msi.row_total,msi.qty_ordered,msi.name,msi.sku FROM `mg_sales_flat_order_item` msi
			    left join supervision ss on msi.item_id = ss.item_id  where msi.`order_id`='". $order["entity_id"]."' and ss.substitute is not NULL";
			   $rows3 = $connection->fetchAll($sql3);
			   $cc=count($rows3);
			   if($cc>=1) { ?>
			   <div style="clear:both;">&nbsp;</div>
			   <div style="margin-top:10px;clear:both;">
			   <table border=1 cellpadding="5" cellspacing="5" border="1" style="border-collapse:collapse" >
			   <?php
			   foreach ($rows3 as $value3) {
			   if($value3["substitute"]!="") {
			     $bbb=1;
				 if($bbb==1 && $jkl!=22) {
			   ?>
			    <tr style="background-color:green;color:#fff;font-weight:bold;">
			    <th style="color:#fff;">Product Name</th>
			    <th style="color:#fff;">Qty.</th>
			    <th style="color:#fff;">Substitute Info</th>
			    </tr>
			   <?php $jkl=22; } ?>
			    <tr>
				<td><?php echo $value3["name"]; ?></td>
				<td style="font-weight:bold;font-size:15px;"><?php echo round($value3["qty_ordered"],0); ?></td>
				<td><?php echo $value3["substitute"]; ?></td>
				</tr>
			   <?php } } ?>
			   </table>
			   </div>
			   <?php } ?>
		   <?php if(isset($_GET["sign"]) && $_GET["sign"]!="" ) {
			 echo '<div style="font-weight:bold;color:green;margin-top:15px;">Thank You For Your Order . </div>';
		   }
		   else
		   {
		   ?>
		   <br/>
		   <form method="get" name="frmtip">
		   <input type="hidden" name="ooid" id="ooid" value="<?php echo $_GET["ooid"]; ?>" />
		    <div style="margin-top:10px;color:green;clear:both;">
		   Grand Total : $<?php echo round($orderValue2,2); ?>
		   </div>
		   <?php
		   $sql22444 = "SELECT unattended_shipping FROM `mg_shipping_delivery_window` where `order_number`='".$_GET["ooid"]."'";
		   $rows12224 = $connection->fetchOne($sql22444);
		   if($rows12224=='yes')
		   {
		   ?>

		   <div style="margin-top:10px;font-weight:bold;color:red;">This is an Unattended Delivery. Be sure you are at correct address - any delivery corrections will be deducted from driver pay. Customer is supposed to leave a cooler for perishable items and the location for leaving items should be secure. If cooler is not present or area is not secure, contact Ops Manager for direction.</div>	<?php } ?>
			<div>
		   <b>Gratuity (applied to card) &nbsp;</b>
		   <?php
		   $check="select tip from drivlist where ordernumber='".$_GET["ooid"]."'";
	       $check_tip=$connection->fetchOne($check);
		   $check="select sign from drivlist where ordernumber='".$_GET["ooid"]."'";
	       $check_sign=$connection->fetchOne($check);  ?>
		   $<input type="text" name="tip" id="tip" style="width:90px;border:1px solid #000;height:25px" value="<?php echo $check_tip; ?>" />
		   <br/>
		  </div>
		  <div style="margin-top:10px;">
		    Initial to Accept Delivery &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="sign" id="sign" style="width:90px;border:1px solid #000;height:25px" value="<?php echo $check_sign; ?>" />
			</div>
			<br/> <input type="submit" style="background-color:green;padding:5px;color:#fff;margin-top:5px;margin-bottom:5px;font-size:12px;font-weight:bold;" name="std" value="Accept Delivery"  />
			</form>
			<?php }
		  exit(0);
        }

	$_GET["ode"] = date('d_m_Y');

	include 'pm.php';

	include 'dlists.php';


	  if(isset($_GET["gt"]) & $_GET["gt"]=='llist' ) {


	// $_GET["ode"] = '17_05_2016';


	$sql32 = "SELECT m.* FROM `mg_shipping_delivery_window` m
					  where m.`window` LIKE '%".$_GET["ode"]."' and m.`rc` >= 1  and m.order_number!='' order by m.`rc` ";
					  $rows3ek = $connection->fetchAll($sql32);


	foreach ($rows3ek as $value) {

					  if($value["drivername"]=='Van 1')
					  {
					     $update = "update mg_shipping_delivery_window set driverid=1 where id='".$value["id"]."'";
						 $connection->query($update);
					  }
					  else if($value["drivername"]=='Box Truck')
					  {
					     $update = "update mg_shipping_delivery_window set driverid=2 where id='".$value["id"]."'";
						 $connection->query($update);
					  }

					  }

	                  $sql32 = "SELECT m.* FROM `mg_shipping_delivery_window` m
					  where m.`window` LIKE '%".$_GET["ode"]."' and m.`rc` >= 1  and m.order_number!='' group by driverid order by m.`rc` ";
					  $rows3ek = $connection->fetchAll($sql32);
	                  $green2 = 0;
					  ?>
					  <b>Vehicle Name :	</b>
					  <?php
					  foreach ($rows3ek as $value) {

					  if($value["drivername"]=='Van 1')
					  {
					     $update = "update mg_shipping_delivery_window set driverid=1 where id='".$value["id"]."'";
						 $connection->query($update);
					  }
					  else if($value["drivername"]=='Box Truck')
					  {
					     $update = "update mg_shipping_delivery_window set driverid=2 where id='".$value["id"]."'";
						 $connection->query($update);
					  }

					 $sel_std="select std from route_driver where rid='".$value["driverid"]."' and route='".$value["route"]."'";
					   $std=$connection->fetchOne($sel_std);

					   if($std!="")
					   {
					  ?>

					   <a href="http://www.prestofreshgrocery.com/?gt=llist&vid=<?php echo $value["driverid"]; ?>"><?php echo
					   $value["drivername"]; ?>(<?php echo
					   $std; ?>)</a>&nbsp;&nbsp;

					<?php
					  }
					  }
	                 ?>

	    <?php if(isset($_GET["vid"]) && $_GET["vid"]!="" ) { ?>
         <div id="tbldrypack" style="padding-top:10px;;margin-top:25px;">
		  <?php
		  $sel_note="select note from route_driver where rid='".$_GET["vid"]."' and route='".$value["route"]."'";
	      $note = $connection->fetchOne($sel_note);

		  $sel_driverid="select driver_id from route_driver where rid='".$_GET["vid"]."' and route='".$value["route"]."'";
	      $driverid = $connection->fetchOne($sel_driverid);

		  $sel_drivername = "select name from mg_pickers where id='".$driverid."'";
		  $drivername = $connection->fetchOne($sel_drivername);

		  ?>
		  <div style="font-weight:bold;margin-bottom:10px;margin-top:15px;color:green;"> Driver Name : <?php echo $drivername; ?> </div>

		  <div style="font-weight:bold;margin-bottom:10px;margin-top:15px;"> Driver Note :
  <br/>
  <textarea name="textnote-<?php echo $_GET["vid"]; ?>" id="textnote-<?php echo $_GET["vid"]; ?>" style="width:230px;border:1px solid #d5d5d5;"><?php echo $note; ?></textarea>
  <br/>
  <input type="button" value="Submit Driver Note" style="background-color:grey;padding:4px;color:#fff;font-weight:bold;margin-top:10px;" onClick="dodrivenote('<?php echo $_GET["vid"]; ?>','<?php echo $value["route"]; ?>');" />
  </div>
		 <table border="1" style="font-size:11px;">
		 <?php if($_GET["vid"]==1) { ?>
		 <tr><td colspan=2 style="background:green;color:#fff;font-size:12px;text-align:center;" > Vehicle Name : Van 1 </td></tr>
		 <?php } else if($_GET["vid"]==2) { ?>
		 <tr><td colspan=2 style="background:green;color:#fff;font-size:12px;" > Vehicle Name : Box Truck </td></tr>
		 <?php } ?>
		 <tr>
		 <td>Order Information</td>
		 <td>Packing Information</td>
		 </tr>
                <?php


                     $sql32 = "SELECT m.* FROM `mg_shipping_delivery_window` m  where m.`window` LIKE '%".$_GET["ode"]."' and m.driverid='".$_GET["vid"]."' and m.`rc` >=1 order by m.`rc`";
					  $rows3ek = $connection->fetchAll($sql32);
	                  $green2 = 0;
					  foreach ($rows3ek as $value) {
					  $value["increment_id"]=$value["order_number"];
	       if($value["increment_id"]!="" && $value["increment_id"]!='100003190')
		   {
		       $sql2        = "SELECT entity_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows2 = $connection->fetchOne($sql2);

			   $sql2        = "SELECT status FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rowstatus   = $connection->fetchOne($sql2);

			   $checkc = "SELECT count(msi.item_id) FROM `mg_sales_flat_order_item` msi
										left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
										left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
										left join mg_order_picker mop on mog.`increment_id` = mop.`order_number`
										left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251 and mei.store_id = 0
										left join mg_catalog_product_entity_int rr on msi.product_id = rr.entity_id and rr.attribute_id =  252 and rr.store_id = 0
										left join mg_catalog_product_entity_int qrr on msi.product_id = qrr.entity_id and qrr.attribute_id =  253 and rr.store_id = 0
										left join mg_eav_attribute_option_value rr2 on rr.value = rr2.option_id and rr2.store_id = 0
										left join mg_eav_attribute_option_value rr3 on mei.value = rr3.option_id and rr3.store_id = 0
										left join mg_eav_attribute_option_value rr4 on qrr.value = rr4.option_id and rr4.store_id = 0
										left join mg_customer_entity_varchar mcv on mog.customer_id = mcv.entity_id and mcv.attribute_id = 5
										left join mg_customer_entity_varchar mcv2 on mog.customer_id = mcv2.entity_id and mcv2.attribute_id = 7


										where ( mei.value=141 or mei.value=143 or mei.value=140 or mei.value=142 or mei.value=144 or mei.value=145 or mei.value=146 )  and msi.`order_id`  = '".$rows2."'  ";
					 $checkcde = $connection->fetchOne($checkc);


			  $checkc = "SELECT count(msi.item_id) FROM `mg_sales_flat_order_item` msi
										left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
										left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
										left join mg_order_picker mop on mog.`increment_id` = mop.`order_number`
										left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251 and mei.store_id = 0
										left join mg_catalog_product_entity_int rr on msi.product_id = rr.entity_id and rr.attribute_id =  252 and rr.store_id = 0
										left join mg_catalog_product_entity_int qrr on msi.product_id = qrr.entity_id and qrr.attribute_id =  253 and rr.store_id = 0
										left join mg_eav_attribute_option_value rr2 on rr.value = rr2.option_id and rr2.store_id = 0
										left join mg_eav_attribute_option_value rr3 on mei.value = rr3.option_id and rr3.store_id = 0
										left join mg_eav_attribute_option_value rr4 on qrr.value = rr4.option_id and rr4.store_id = 0
										left join mg_customer_entity_varchar mcv on mog.customer_id = mcv.entity_id and mcv.attribute_id = 5
										left join mg_customer_entity_varchar mcv2 on mog.customer_id = mcv2.entity_id and mcv2.attribute_id = 7

										left join supervision ss on ss.item_id = msi.item_id
										where ( mei.value=141 or mei.value=143 or mei.value=140 or mei.value=142 or mei.value=144 or mei.value=145 or mei.value=146 )  and msi.`order_id`  = '".$rows2."' and ss.log2=1 ";
					 $checkcd = $connection->fetchOne($checkc);

					 $total_check = $checkcde - $checkcd ;

			   $sql22        = "SELECT customer_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows22 = $connection->fetchOne($sql22);


			   $customer = "" ;
			   $customer = Mage::getModel('customer/customer')->load($rows22);

			   $sql222        = "SELECT entity_id FROM mg_sales_flat_order_grid where customer_id='".$rows22."' and increment_id!='".$value["order_number"]."'";
		       $rows222 = $connection->fetchOne($sql222);

			   $sql3        = "SELECT SUM(qty_ordered) FROM `mg_sales_flat_order_item` where `order_id`='".$rows2."'";
			   $rows3 = $connection->fetchOne($sql3);
			   $order = Mage::getModel("sales/order")->load($rows2); //load order by order id
			   $address = $order->getShippingAddress();
			   $shipping_info = $order->getShippingAddress()->getData();
			   $temp = explode("|",$value['window']);
			   $temp3 = explode(".",$rows3);
			   $check22 = 0;

			        $sql2g = "SELECT picker_id FROM mg_order_picker where order_number='".$value["order_number"]."'";
		            $rows2g = $connection->fetchOne($sql2g);

				    $sql2gk = "SELECT name FROM mg_pickers where id='".$rows2g."'";
		            $rows2gk = $connection->fetchOne($sql2gk);

				$bid = $value["id"];

			   if($customer->getId()!="813" && $customer->getId()!="1205" && $customer->getId()!="52"  && $rowstatus!='canceled' && $rows2g >=1 )
			   {
	 ?>		   <tr <?php if($value["loaded"]=="1") { ?> style="background:#daebe1;" <?php } ?> id="trload-<?php echo $value["id"]; ?>" >
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#1c60ff;"'; } ?> >
			   <span style="font-size:12px;font-weight:bold;">  <?php $custName = $address->getName(); ?> <?php if(trim($custName)=="") { echo $customer->getName(); } else { echo $custName; } ?> </span>
				<br/> <span style="color:green;font-weight:bold;"> <?php echo $rows2gk; ?></span>
			   </td>
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#1c60ff;"'; } ?> >
			    <?php
				$sqlstatus  = "SELECT d FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["d"] = $connection->fetchOne($sqlstatus);
				$sqlstatus  = "SELECT cf FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["cf"] = $connection->fetchOne($sqlstatus);
				$sqlstatus  = "SELECT bag FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["bag"] = $connection->fetchOne($sqlstatus);
				$sqlstatus  = "SELECT loose FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["loose"] = $connection->fetchOne($sqlstatus);


				$sqlstatus  = "SELECT cold_bin FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["cold_bin"] = $connection->fetchOne($sqlstatus);

				$sqlstatus  = "SELECT cold_bag FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["cold_bag"] = $connection->fetchOne($sqlstatus);

				$sqlstatus  = "SELECT frozen_bin FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["frozen_bin"] = $connection->fetchOne($sqlstatus);

				$sqlstatus  = "SELECT frozen_bag FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["frozen_bag"] = $connection->fetchOne($sqlstatus);

			?>

				<?php if($number["d"]!="")
				{
				?>
				Dry Bins :

				 <b> <span style="color:green;font-size:14px;" ><?php echo $number["d"]; ?></span> </b>
				 <br/>
				 <?php } ?>

				<?php if($number["bag"]!="")
				{
				?>
				<b>Dry Bags :</b>

				 <span style="color:green;font-size:14px;" ><?php  echo $number["bag"]; ?> </span>
				<br/>
				<?php } ?>
				<?php if($number["loose"]!="")
				{
				?>
				<b>Dry Loose :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["loose"]; ?> </span>
				<br/>
				<?php } ?>

				<br/>
				<?php if($value["dryload"]!="1") { ?>
				<div id="trloadtext-<?php echo $value["id"]; ?>">
				<input type="button" style="background-color:black;padding:7px;color:#fff;font-weight:bold;" name="std" value="Load Dry Items" onClick="doloaded(<?php echo $bid; ?>);" />
				</div>
				<?php } else { ?>

				<div style="color:green;"> Dry Items Are Already loaded. </div>

				<?php } ?>
				<br/>

				<?php if($number["cold_bin"]!="")
				{
				?>
				<b>Cold Bin :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["cold_bin"]; ?> </span>
				<br/>
				<?php } ?>

				<?php if($number["cold_bag"]!="")
				{
				?>
				<b>Cold Bag :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["cold_bag"]; ?> </span>
				<br/>
				<?php } ?>

				<?php if($number["frozen_bin"]!="")
				{
				?>
				<b>Frozen Bin :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["frozen_bin"]; ?> </span>
				<br/>
				<?php } ?>

				<?php if($number["frozen_bag"]!="")
				{
				?>
				<b>Frozen Bag :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["frozen_bag"]; ?> </span>
				<br/>
				<?php } ?>

				<br/>
				<?php if($value["coldload"]!="1") { ?>
				<div id="trloadtext2-<?php echo $value["id"]; ?>">
				<input type="button" style="background-color:black;padding:7px;color:#fff;font-weight:bold;" name="std" value="Load C/F Items" onClick="doloaded2(<?php echo $bid; ?>);" />
				</div>
				<?php } else { ?>
				<div style="color:green;"> C/F Items Are Already loaded. </div>
				<?php } ?>
				<br/>

				<?php if($total_check>=1) { ?>
				<br/>
				<span style="color:red;"> Note :- Following items still need to be packed : <br/> </span>
				<div style="color:black;padding:5px;">
				<?php
				$checkcb = "SELECT msi.name,rr2.value,msi.qty_ordered,msi.order_id,msi.product_id FROM `mg_sales_flat_order_item` msi
										left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
										left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
										left join mg_order_picker mop on mog.`increment_id` = mop.`order_number`
										left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251 and mei.store_id = 0
										left join mg_catalog_product_entity_int rr on msi.product_id = rr.entity_id and rr.attribute_id =  252 and rr.store_id = 0
										left join mg_catalog_product_entity_int qrr on msi.product_id = qrr.entity_id and qrr.attribute_id =  253 and rr.store_id = 0
										left join mg_eav_attribute_option_value rr2 on rr.value = rr2.option_id and rr2.store_id = 0
										left join mg_eav_attribute_option_value rr3 on mei.value = rr3.option_id and rr3.store_id = 0
										left join mg_eav_attribute_option_value rr4 on qrr.value = rr4.option_id and rr4.store_id = 0
										left join mg_customer_entity_varchar mcv on mog.customer_id = mcv.entity_id and mcv.attribute_id = 5
										left join mg_customer_entity_varchar mcv2 on mog.customer_id = mcv2.entity_id and mcv2.attribute_id = 7

										left join supervision ss on ss.item_id = msi.item_id
										where ( mei.value=141 or mei.value=143 or mei.value=140 or mei.value=142 or mei.value=144 or mei.value=145 or mei.value=146 )  and msi.`order_id`  = '".$rows2."' and ( ss.log2=0 or ss.log2 is null) ";
					 $checkcd = $connection->fetchAll($checkcb);
					 $countg = count($checkcd);
					 $cc=0;
					 if($countg>=1)
					 {
					 foreach ($checkcd as $valuemm) {
					 $cc=$cc+1;
					 ?>
					 <div style="color:black";>
					 <a href="http://www.prestofreshgrocery.com/?gt=dpack&picker2=<?php echo $rows2g; ?>&custid=<?php echo $valuemm["order_id"]; ?>&proid=<?php echo $valuemm["product_id"]; ?>" ><?php echo $cc; ?> ). <?php echo $valuemm["name"]; ?> ( Location : <?php echo $valuemm["value"]; ?> ) ( Qty Ordered : <?php echo round($valuemm["qty_ordered"],2); ?> )</a>
					 </div>
					 <?php
					 } }
					 ?>
					 </div>
					 <?php
				  }
				?>
				</td>
			 </tr>
			   <?php
			   }
		     }
	     } ?>
		 </table>
         </div>
		<?php } ?>

	   <?php
	   }


	   if(isset($_GET["increid"]) && $_GET["increid"]!="" ) {

     $_GET["oid"]=$_GET["increid"];
     $order = Mage::getModel('sales/order')->load($_GET["increid"], 'increment_id');
	 $order->getAllVisibleItems();
	 $address = $order->getShippingAddress();
	 $address2 = $order->getBillingAddress();
	 $orderValue = $order->getSubtotal();
	 $orderValue2 = $order->getBaseGrandTotal();
?>
<style>
.page
{
   width:90%;
}

td, th
{
   padding:5px !important;
   font-size:12px;
   color:#000;
}

table
{
   border-color:#000;
}

th
{
   color:#fff;
   background-color:green;
}
</style>
<div style="border-bottom:0px solid #dfdfdf;margin-bottom:5px;" >
<h3 class="icon-head head-manage-blog" style="padding-left:0px;color:#eb5e00;">Order Details ( <?php echo $_GET["oid"]; ?> )</h3>
<?php
$currentUrl = Mage::helper('core/url')->getCurrentUrl();
$url77 = explode("?oid=",$currentUrl);
?>

</div>
	   <table width="48%;" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;">
	 <tr >

	 <td style="color:green;"> <b> Delivery Address  </b> </td>
	 </tr>
	 <tr>
	 <td>
	            <?php
				echo $custName = $address->getName()."<br/>";
				echo $custAddr = $address->getStreetFull()."<br/>";
				echo $region2 = $address->getCity()."<br/>";
				echo $region = $address->getRegion()."<br/>";
				echo $country = $address["postcode"];
				?>
	</td>
	</tr>
	</table>
	<table width="48%;"" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;margin-left:1%">
	 <tr >
	 <td style="color:green;"> <b> Billing Address  </b> </td>
	 </tr>
	 <tr>
	 <td>	    <?php
				echo $custName = $address2->getName()."<br/>";
				echo $custAddr = $address2->getStreetFull()."<br/>";
				echo $region2 = $address2->getCity()."<br/>";
				echo $region = $address2->getRegion()."<br/>";
				echo $country = $address2["postcode"];
				?>
	</td>
	</tr>
	</table>	<br/>
<?php
   $value["order_number"] = $_GET["oid"];
   if($value["order_number"]!="")
		   {
		       $sql2  = "SELECT entity_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows2 = $connection->fetchOne($sql2);
			   echo "<br/>";
				$sql3 = "SELECT msi.item_id,mei.value,msi.product_id,msi.price,msi.row_total,msi.qty_ordered,msi.name,msi.sku ,msi.refund FROM `mg_sales_flat_order_item` msi
			    left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251
			    where msi.`order_id`='".$rows2."'";
			    $rows3 = $connection->fetchAll($sql3);
			   ?>
			   <div style="clear:both;">&nbsp;</div>
			   <table border=1 cellpadding="5" cellspacing="5" border="1" style="border-collapse:collapse;margin-top:15px;" >
			   <tr>
			   <th>Product Name</th>
			   <th>Qty.</th>
			   </tr>
			   <?php
			   foreach ($rows3 as $value3) {
				$_resource = Mage::getSingleton('catalog/product')->getResource();
				$optionValue1 = $_resource->getAttributeRawValue($value3["product_id"],'protype', Mage::app()->getStore());
				$product = Mage::getModel('catalog/product')->setStoreId($store_id)->setProtype($optionValue1);
                $optionLabel1 = $product->getAttributeText('protype');
				$optionValue4 = $_resource->getAttributeRawValue($value3["product_id"],'vendor_product_id', Mage::app()->getStore());
				$sel_status="select status from `supervision` where item_id='".$value3["item_id"]."'";
				$status=$connection->fetchOne($sel_status);
				$sel_substitute="select substitute from `supervision` where item_id='".$value3["item_id"]."'";
				$substitute=$connection->fetchOne($sel_substitute);
				if($substitute=='') {
			   ?>
			    <tr>
				<td><?php echo $value3["name"]; ?>
				<?php if($substitute!="") { ?>
				<br/>
				<b>Substitute Item :- <?php echo $substitute; ?> </b>
				<?php } ?>
				</td>
				<td><?php echo round($value3["qty_ordered"],0); ?></td>
				</tr>
				<?php } else { ?>
				<tr>
				<td><?php echo $value3["name"]; ?></td>
				<td style="font-weight:bold;font-size:15px;"><?php echo round($value3["qty_ordered"],0); ?></td>
				</tr>
				<?php }
			   }
			   ?>
			    </table>
			   <?php
		        }
		       ?>
		  <?php
		  exit(0);
		   }

	   // nf hear

	   include 'nf.php';

	  // include 'nf2.php';

	   include 'ltime.php';

       include 'dpick.php';

	   include 'dpick2.php';

	   include 'dpack.php';

	   include 'cpick.php';

	    include 'cpick2.php';

	   include 'fpick.php';

	    include 'fpick2.php';

	   include 'cfpack.php';

 exit(0);
 }
if($group_id==23)
{
  // echo "hi Driver";
?>
<style>
body>.wrapper
{
   background:#fff !important;
   font-weight:bold;
   color:#000;
   overflow:hidden;
}

body
{
   background:#fff !important;
}

.page
{
   width:90%;
}

td, th
{
    padding-top:5px !important;
    padding-left:5px !important;
    padding-bottom:5px !important;
    padding-right:5px !important;
	font-weight:bold;
}
th
{
    font-weight:bold;
	color:#fff;
	background-color:green;
}
input[type="button"]
{
   margin-top:5px;
    margin-left:5px;
}
</style>




<div id='cssmenu' style="margin-top:15px;margin-bottom:10px;">
<ul>
      <li><a href="http://www.prestofreshgrocery.com/" > Driver List </a></li>
	  <li><a href="http://www.prestofreshgrocery.com/?gt=llist" id="" style=""> Load List </a></li>
	   <li><a href="http://www.prestofreshgrocery.com/?gt=map" id="" style=""> Map </a></li>
   <li><?php echo "<a href=\"".Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB)."customer/account/logout/\"  />Logout</a>"; ?></li>
</ul>
</div>


<style>
@import url(http://fonts.googleapis.com/css?family=Open+Sans:400,700);
#cssmenu,
#cssmenu ul,
#cssmenu ul li,
#cssmenu ul li a,
#cssmenu #menu-button {
  margin: 0;
  padding: 0;
  border: 0;
  list-style: none;
  line-height: 1;
  display: block;
  position: relative;
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
body
{
   font-family:verdana;
}
body
{
   font-family:verdana;
}
#cssmenu:after,
#cssmenu > ul:after {
  content: ".";
  display: block;
  clear: both;
  visibility: hidden;
  line-height: 0;
  height: 0;
}
#cssmenu #menu-button {
  display: none;
}
#cssmenu {
  width: auto;
  border-radius: 5px;
  font-family: 'Open Sans', Helvetica, sans-serif;
  background:#65ae31;
}
#cssmenu.align-center > ul {
  font-size: 0;
  text-align: center;
}
#cssmenu.align-center ul ul {
  text-align: left;
}
#cssmenu.align-center > ul > li {
  display: inline-block;
  float: none;
}
#cssmenu.align-right > ul > li {
  float: right;
}
#cssmenu.align-right ul ul {
  text-align: right;
}
#cssmenu > ul > li {
  float: left;
}
#cssmenu > ul > li > a {
  padding: 10px 20px;
  font-size: 13px;
  color: #ffffff;
  text-transform: uppercase;
  letter-spacing: 1px;
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
  font-weight: 700;
  text-decoration: none;
  -webkit-transition: color .2s ease;
  -moz-transition: color .2s ease;
  -ms-transition: color .2s ease;
  -o-transition: color .2s ease;
  transition: color .2s ease;
}
#cssmenu > ul > li:hover > a,
#cssmenu > ul > li > a:hover,
#cssmenu > ul > li.active > a {
  color: #cae5fd;
}
#cssmenu > ul > li.has-sub > a {
  padding-right: 40px;
}
#cssmenu ul > li.has-sub > a:after {
  content: '';
  position: absolute;
  right: 5px;
  top: 17.5px;
  display: block;
  width: 18px;
  height: 18px;
  border-radius: 9px;
  background:#008000 ;
  background-size: 36px 36px;
  background-position: 0 0;
  background-repeat: no-repeat;
  -webkit-transition: all 0.1s ease-out;
  -moz-transition: all 0.1s ease-out;
  -ms-transition: all 0.1s ease-out;
  -o-transition: all 0.1s ease-out;
  transition: all 0.1s ease-out;
}
#cssmenu ul > li.has-sub:hover > a:after {
  background-position: 0 -18px;
}
#cssmenu ul > li.has-sub > a:before {
  content: '';
  position: absolute;
  right: 11px;
  top: 25.5px;
  display: block;
  width: 0;
  height: 0;
  border: 3px solid transparent;
  border-top-color: #ffffff;
  z-index: 99;
}
#cssmenu ul > li.has-sub:hover > a:before {
  border-top-color: #19799f;
}
#cssmenu ul ul {
  position: absolute;
  left: -9999px;
  opacity: 0;
  -webkit-transition: top .2s ease, opacity .2s ease;
  -moz-transition: top .2s ease, opacity .2s ease;
  -ms-transition: top .2s ease, opacity .2s ease;
  -o-transition: top .2s ease, opacity .2s ease;
  transition: top .2s ease, opacity .2s ease;
}
#cssmenu > ul > li > ul {
  top: 91px;
  padding-top: 8px;
  border-radius: 5px;
}
#cssmenu > ul > li:hover > ul {
  left: auto;
  top: 51px;
  opacity: 1;
}
#cssmenu.align-right > ul > li:hover > ul {
  right: 0;
}
#cssmenu ul ul ul {
  top: 40px;
}
#cssmenu ul ul > li:hover > ul {
  top: 0;
  left: 178px;
  padding-left: 10px;
  opacity: 1;
}
#cssmenu.align-right ul ul > li:hover > ul {
  left: auto;
  right: 178px;
  padding-left: 0;
  padding-right: 10px;
  opacity: 1;
}
#cssmenu ul ul li a {
  width: 180px;
  padding: 12px 25px;
  font-size: 13px;
  font-weight: 700;
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
  color: #ffffff;
  text-decoration: none;
  background: ;
  -webkit-transition: color .2s ease;
  -moz-transition: color .2s ease;
  -ms-transition: color .2s ease;
  -o-transition: color .2s ease;
  transition: color .2s ease;
}
#cssmenu ul ul li:hover > a,
#cssmenu ul ul li > a:hover,
#cssmenu ul ul li.active > a {
  color: #cae5fd;
}
#cssmenu ul ul li:first-child > a {
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  box-shadow: inset 0 2px 2px #88d0ed;
}
#cssmenu ul ul li:last-child > a {
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
  box-shadow: inset 0 -3px 0 #27a9de, inset 0 -3px 3px #1f9acc, 0 1px 1px rgba(0, 0, 0, 0.03), 0 2px 2px rgba(0, 0, 0, 0.05), 0 2px 3px rgba(0, 0, 0, 0.13);
}
#cssmenu ul ul > li.has-sub > a:after {
  right: 12px;
  top: 9.5px;
  background: ;
  background: -webkit-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  background: -ms-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  background: -moz-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  background: -o-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  background: linear-gradient(to bottom, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
  box-shadow: inset 0 -1px 1px #209ed0, inset 0 2px 1px #7fcceb;
  background-size: 36px 36px;
  background-position: 0 0;
  background-repeat: no-repeat;
}
#cssmenu.align-right ul ul > li.has-sub > a:after {
  right: auto;
  left: 12px;
}
#cssmenu ul ul > li.has-sub:hover > a:after {
  background-position: 0 -18px;
}
#cssmenu ul ul > li.has-sub > a:before {
  top: 15.5px;
  right: 16px;
  border-top-color: transparent;
  border-left-color: #ffffff;
}
#cssmenu.align-right ul ul > li.has-sub > a:before {
  top: 15.5px;
  right: auto;
  left: 16px;
  border-top-color: transparent;
  border-right-color: #ffffff;
  border-left-color: transparent;
}
#cssmenu ul ul > li.has-sub:hover > a:before {
  border-top-color: transparent;
  border-left-color: #1c89b5;
}
#cssmenu.align-right ul ul > li.has-sub:hover > a:before {
  border-top-color: transparent;
  border-left-color: transparent;
  border-right-color: #1c89b5;
}
@media all and (max-width: 768px), only screen and (-webkit-min-device-pixel-ratio: 2) and (max-width: 1024px), only screen and (min--moz-device-pixel-ratio: 2) and (max-width: 1024px), only screen and (-o-min-device-pixel-ratio: 2/1) and (max-width: 1024px), only screen and (min-device-pixel-ratio: 2) and (max-width: 1024px), only screen and (min-resolution: 192dpi) and (max-width: 1024px), only screen and (min-resolution: 2dppx) and (max-width: 1024px) {
  #cssmenu {
width: 80%;
}
  #cssmenu ul,
  #cssmenu ul ul,
  #cssmenu ul ul ul,
  #cssmenu > ul,
  #cssmenu.align-center > ul,
  #cssmenu > ul > li > ul,
  #cssmenu > ul > li:hover > ul,
  #cssmenu ul ul li:hover > ul,
  #cssmenu ul ul ul li:hover > ul,
  #cssmenu.align-right ul ul,
  #cssmenu.align-right ul ul li:hover > ul,
  #cssmenu.align-right ul ul ul li:hover > ul {
    position: relative;
    left: 0;
    right: auto;
    top: 0;
    width: 100%;
    display: none;
    padding: 0;
    opacity: 1;
    text-align: left;
  }
  #cssmenu ul li {
    width: 100%;
    border-top: 1px solid rgba(120, 120, 120, 0.2);
  }
  #cssmenu > ul > li > a,
  #cssmenu ul ul li a,
  #cssmenu ul ul li:first-child > a,
  #cssmenu ul ul li:last-child > a {
    width: 100%;
    border-radius: 0;
    box-shadow: none;
    background: none;
  }
  #cssmenu ul li a {
    padding-left: 12.5px;
  }
  #cssmenu ul ul li a {
    padding: 14px 25px 14px 27.5px;
  }
  #cssmenu ul ul ul li a {
    padding-left: 42.5px;
  }
  #cssmenu ul ul ul ul li a {
    padding-left: 57.5px;
  }
  #cssmenu > ul > li.has-sub > a:after,
  #cssmenu > ul > li.has-sub > a:before,
  #cssmenu ul ul li.has-sub > a:after,
  #cssmenu ul ul li.has-sub > a:before {
    display: none;
  }
  #cssmenu #menu-button {
    position: relative;
    display: block;
    padding: 10px;
    padding-left: 12.5px;
    cursor: pointer;
    font-size: 13px;
    color: #ffffff;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
  }
  #cssmenu .submenu-button {
    position: absolute;
    right: 0;
    display: block;
    width: 53px;
    height: 53px;
    border-left: 1px solid rgba(120, 120, 120, 0.2);
    z-index: 10;
    cursor: pointer;
  }
  #cssmenu ul ul .submenu-button {
    height: 41px;
  }
  #cssmenu ul .submenu-button:after,
  #cssmenu #menu-button:after {
    content: '';
    position: absolute;
    right: 12.5px;
    top: 12.5px;
    display: block;
    width: 28px;
    height: 28px;
    border-radius: 15px;
    background: #008000;
    background: -webkit-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
    background: -ms-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
    background: -moz-linear-gradient(top, #008000 0%, #4ab7e3 25%, #2babde 50%, #008000 75%, #4ab7e3 100%);
    background: -o-linear-gradient(top, #58bde5 0%, #4ab7e3 25%, #2babde 50%, #58bde5 75%, #4ab7e3 100%);
    background: linear-gradient(to bottom, #58bde5 0%, #4ab7e3 25%, #2babde 50%, #58bde5 75%, #4ab7e3 100%);
    box-shadow: inset 0 -1px 1px #209ed0, inset 0 2px 1px #7fcceb;
    background-size: 56px 56px;
    background-position: 0 0;
    background-repeat: no-repeat;
    -webkit-transition: all 0.1s ease-out;
    -moz-transition: all 0.1s ease-out;
    -ms-transition: all 0.1s ease-out;
    -o-transition: all 0.1s ease-out;
    transition: all 0.1s ease-out;
  }
  #cssmenu ul .submenu-button.submenu-opened:after,
  #cssmenu #menu-button.menu-opened:after {
    background-position: 0 -28px;
  }
  #cssmenu ul ul .submenu-button:after {
    top: 6.5px;
  }
  #cssmenu #menu-button:before,
  #cssmenu .submenu-button:before {
    content: '';
    position: absolute;
    right: 22.5px;
    top: 16.5px;
    display: block;
    width: 0;
    height: 0;
    border: 4px solid transparent;
    border-top-color: #ffffff;
    z-index: 99;
  }
  #cssmenu ul ul .submenu-button:before {
    top: 19.5px;
  }
  #cssmenu #menu-button.menu-opened:before,
  #cssmenu .submenu-button.submenu-opened:before {
    border-top-color: #19799f;
  }
}

</style>

<script>

(function($) {

  $.fn.menumaker = function(options) {

      var cssmenu = $(this), settings = $.extend({
        title: "Menu",
        format: "dropdown",
        sticky: false
      }, options);

      return this.each(function() {
        cssmenu.prepend('<div id="menu-button">' + settings.title + '</div>');
        $(this).find("#menu-button").on('click', function(){
          $(this).toggleClass('menu-opened');
          var mainmenu = $(this).next('ul');
          if (mainmenu.hasClass('open')) {
            mainmenu.hide().removeClass('open');
          }
          else {
            mainmenu.show().addClass('open');
            if (settings.format === "dropdown") {
              mainmenu.find('ul').show();
            }
          }
        });

        cssmenu.find('li ul').parent().addClass('has-sub');

        multiTg = function() {
          cssmenu.find(".has-sub").prepend('<span class="submenu-button"></span>');
          cssmenu.find('.submenu-button').on('click', function() {
            $(this).toggleClass('submenu-opened');
            if ($(this).siblings('ul').hasClass('open')) {
              $(this).siblings('ul').removeClass('open').hide();
            }
            else {
              $(this).siblings('ul').addClass('open').show();
            }
          });
        };

        if (settings.format === 'multitoggle') multiTg();
        else cssmenu.addClass('dropdown');

        if (settings.sticky === true) cssmenu.css('position', 'fixed');

        resizeFix = function() {
          if ($( window ).width() > 768) {
            cssmenu.find('ul').show();
          }

          if ($(window).width() <= 768) {
            cssmenu.find('ul').hide().removeClass('open');
          }
        };
        resizeFix();
        return $(window).on('resize', resizeFix);

      });
  };
})(jQuery);

(function($){
$(document).ready(function(){

$("#cssmenu").menumaker({
   title: "Menu",
   format: "multitoggle"
});


});
})(jQuery);
</script>
<?php if(isset($_GET["oid"]) && $_GET["oid"]!="" ) {

     if(isset($_GET["dnote"]) && $_GET["dnote"]!="" )
	 {
	     $check="select status from drivlist where ordernumber='".$_GET["oid"]."'";
	     $check_confirm=$connection->fetchOne($check);

		if($check_confirm=="")
	    {
	      $insert="insert into drivlist set dnote='".$_GET["dnote"]."',ordernumber='".$_GET["oid"]."'";
		  $connection->query($insert);
	    }
	   else
	   {
	      $update="update drivlist set dnote='".$_GET["dnote"]."' where ordernumber='".$_GET["oid"]."'";
		  $connection->query($update);
	   }

	 }

      $order = Mage::getModel('sales/order')->load($_GET["oid"], 'increment_id');
	  $order->getAllVisibleItems();
	  $address = $order->getShippingAddress();
	  $address2 = $order->getBillingAddress();

	 $orderValue = $order->getSubtotal();
	 $orderValue2 = $order->getBaseGrandTotal();
?>
<style>
.page
{
   width:90%;
}

td, th
{
   padding:5px !important;
   font-size:12px;
   color:#000;
}

table
{
   border-color:#000;
}

th
{
   color:#fff;
   background-color:green;
}
</style>
<div style="border-bottom:0px solid #dfdfdf;margin-bottom:5px;" >
<h3 class="icon-head head-manage-blog" style="padding-left:0px;color:#eb5e00;">Order Details ( <?php echo $_GET["oid"]; ?> )</h3>
<?php
$currentUrl = Mage::helper('core/url')->getCurrentUrl();
$url77 = explode("?oid=",$currentUrl);
?>

</div>
	   <table width="48%;" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;">
	 <tr >
	 <td style="color:green;"> <b> Delivery Address  </b> </td>
	 </tr>
	 <tr>
	 <td>
	            <?php
				echo $custName = $address->getName()."<br/>";
				echo $custAddr = $address->getStreetFull()."<br/>";
				echo $region2 = $address->getCity()."<br/>";
				echo $region = $address->getRegion()."<br/>";
				echo $country = $address["postcode"];
				?>
	</td>
	</tr>
	</table>

	<table width="48%;"" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;margin-left:1%">
	 <tr >
	 <td style="color:green;"> <b> Billing Address  </b> </td>
	 </tr>
	 <tr>
	 <td>
	            <?php
				echo $custName = $address2->getName()."<br/>";
				echo $custAddr = $address2->getStreetFull()."<br/>";
				echo $region2 = $address2->getCity()."<br/>";
				echo $region = $address2->getRegion()."<br/>";
				echo $country = $address2["postcode"];
				?>
	</td>
	</tr>
	</table>	<br/>
		<!-- <b> Customer :- </b>
		<?php echo $custName; ?>
		&nbsp; &nbsp;
	  <?php
	  		$sql55555 = "SELECT `window` FROM `mg_shipping_delivery_window` where `order_number`='".$_GET["oid"]."'";
			$rows55555 = $connection->fetchOne($sql55555);
			 $temp = explode("|",$rows55555);
		 ?>
		 <b> Delivery Date :- </b>
		<?php if($temp[1]=="") { echo $temp[0]; } else { echo $temp[1]; } ?>
		&nbsp; &nbsp;<b> Delivery Time :- </b>
			 <?php if($temp[1]=="") { echo 'Flexible Time'; } else { echo $temp[0]; } ?>
		 <br/><br/> -->
<?php

   $value["order_number"] = $_GET["oid"];
   if($value["order_number"]!="")
		   {
		       $sql2        = "SELECT entity_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows2 = $connection->fetchOne($sql2);
			   echo "<br/>";

				$sql3        = "SELECT msi.item_id,msi.refund,mei.value,msi.product_id,msi.price,msi.row_total,msi.qty_ordered,msi.name,msi.sku FROM `mg_sales_flat_order_item` msi
			    left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251
			    where msi.`order_id`='".$rows2."'";

			   $rows3 = $connection->fetchAll($sql3);

			   ?>
			   <div style="clear:both;">&nbsp;</div>
			   <table border=1 cellpadding="5" cellspacing="5" border="1" style="border-collapse:collapse;margin-top:15px;" >
			   <tr>
			   <th>Product Name</th>
			   <th>Qty.</th>
			   <th>Refund</th>
			   </tr>
			    <?php
			   foreach ($rows3 as $value3) {
				$_resource = Mage::getSingleton('catalog/product')->getResource();
				$optionValue1 = $_resource->getAttributeRawValue($value3["product_id"],'protype', Mage::app()->getStore());
				$product = Mage::getModel('catalog/product')->setStoreId($store_id)->setProtype($optionValue1);
                $optionLabel1 = $product->getAttributeText('protype');
				$optionValue4 = $_resource->getAttributeRawValue($value3["product_id"],'vendor_product_id', Mage::app()->getStore());
				$sel_status="select status from `supervision` where item_id='".$value3["item_id"]."'";
				$status=$connection->fetchOne($sel_status);
		    $sel_substitute="select substitute from `supervision` where item_id='".$value3["item_id"]."'";
				$substitute=$connection->fetchOne($sel_substitute);
				if($substitute!= '') {
			   ?>
			    <tr style="background:red;color:#fff;">
				<td style="background:red;color:#fff;" ><?php echo $value3["name"]; ?>

				<?php if($substitute!="") { ?>
				<br/>
				<b>Substitute Item :- <?php echo $substitute; ?> </b>
				<?php } ?>

				</td>
				<td style="background:red;color:#fff;" ><?php echo round($value3["qty_ordered"],0); ?></td>
				<td style="font-weight:bold;font-size:12px;"><div style="color:#000;margin-top:15px;"> <input type="checkbox" name="chkref-<?php echo $value3['item_id']; ?>" id="chkref-<?php echo $value3['item_id']; ?>" <?php if($value3['refund']==1) { echo "checked"; } ?> value="<?php echo $value3['item_id']; ?>" onClick="dorefund(<?php echo $value3['item_id']; ?> )" /> Refund Item </div></td></tr>

				<?php } else { ?>
				<tr >
				<td><?php echo $value3["name"]; ?></td>
				<td style="font-weight:bold;font-size:15px;"><?php echo round($value3["qty_ordered"],0); ?></td>
				<td style="font-weight:bold;font-size:12px;"><div style="color:#000;margin-top:15px;"> <input type="checkbox" name="chkref-<?php echo $value3['item_id']; ?>" id="chkref-<?php echo $value3['item_id']; ?>" <?php if($value3['refund']==1) { echo "checked"; } ?> value="<?php echo $value3['item_id']; ?>" onClick="dorefund(<?php echo $value3['item_id']; ?> )" /> Refund Item </div></td></tr>
				<?php }
			   }
			   ?>
			    </table>
			   <?php
		      }
		   ?>
		   <form method="get" name="frmdnote">
		   <input type="hidden" name="oid" id="oid" value="<?php echo $_GET["oid"]; ?>" />
		    <br/>
		   <b>Delivery Notes</b>
		   <?php
		   $check="select dnote from drivlist where ordernumber='".$_GET["oid"]."'";
	       $check_dnote=$connection->fetchOne($check);
		   ?>
		   <br/>
		   <textarea name="dnote" style="width:280px;border:1px solid #000;"><?php echo $check_dnote; ?></textarea>
		   <br/>
		   <input type="submit" style="background-color:green;padding:5px;color:#fff;margin-top:5px;margin-bottom:5px;" name="std" value="Submit Note"  /> &nbsp; <a href="https://www.prestofreshgrocery.com?ooid=<?php echo $_GET["oid"]; ?>"> Serve Order </a>
		   </form>
		  <?php
		  exit(0);
  } ?>

<?php
      if(isset($_GET["ooid"]) && $_GET["ooid"]!="" ) {

    if(isset($_GET["sign"]) && $_GET["sign"]!="" )
	 {
	   $check="select status from drivlist where ordernumber='".$_GET["ooid"]."'";
	     $check_confirm=$connection->fetchOne($check);


		  $sel_estt="select estt from mg_shipping_delivery_window where order_number='".$_GET["ooid"]."'";
		  $rs_estt=$connection->fetchOne($sel_estt);


		 $time = $rs_estt ;
         $estt=date("H:i", strtotime($time));
		 $estt=$estt.":00";
		 $estt=strtotime($estt);

		 $curtime = now();
		 $newb=explode(" ",$curtime);
		 $hhmm=explode(":",$newb[1]);
		 $realtime=$hhmm[0].":".$hhmm[1].":00";
		 $realtime=strtotime($realtime);

		 $diff = $estt - $realtime;

		 $minutes = $diff / 60 ;


		if($check_confirm=="")
	    {

	      $insert="insert into drivlist set sign='".$_GET["sign"]."',ordernumber='".$_GET["ooid"]."',status=1,tip='".$_GET["tip"]."',nowtime='".now()."',popup='".$minutes."'";
		  $connection->query($insert);

		  $update="update mg_shipping_delivery_window set popup='".$minutes."' where order_number='".$_GET["ooid"]."'";
		  $connection->query($update);

	   }
	   else
	   {
	      $update="update drivlist set sign='".$_GET["sign"]."',tip='".$_GET["tip"]."',status=1,popup='".$minutes."',nowtime='".now()."' where ordernumber='".$_GET["ooid"]."'";
		  $connection->query($update);

		  $update="update mg_shipping_delivery_window set popup='".$minutes."' where order_number='".$_GET["ooid"]."'";
		  $connection->query($update);

	   }



	   /************************************/
	include('connection.php');
	//echo "Call file customer survey process";
	$ooid = $_REQUEST['ooid'];
	$qry = "SELECT customer_email, customer_firstname, customer_lastname FROM mg_sales_flat_order WHERE increment_id = '".$ooid."' ";
	$rs = mysql_query($qry);
	$result = mysql_fetch_array($rs);

	$Dqry = "SELECT customer_id,driver_email FROM mg_shipping_delivery_window WHERE order_number = '".$ooid."' ";
	$Drs = mysql_query($Dqry);
	$Dresult = mysql_fetch_array($Drs);

	$Pqry = "SELECT picker_id FROM mg_order_picker WHERE order_number = '".$ooid."' ";
	$Prs = mysql_query($Pqry);
	$Presult = mysql_fetch_array($Prs);

	$sel_driver_id="SELECT id from mg_pickers where email='".$Dresult[1]."'";
	$rs_driver_id= mysql_query($sel_driver_id);
	$driver_id = mysql_fetch_array($rs_driver_id);

?>
		<form name="survey_process" id="survey_process_form" method="post" action="http://prestofreshgrocery.com/acceptOrder.php" style="display:none;" />
			<input type="text" name="customer_email" value="<?php echo $result[0];?>" placeholder="Customer Email" />
			<input type="text" name="order_id" value="<?php echo $ooid; ?>" placeholder="Order Id" />
			<input type="text" name="first_name" value="<?php echo $result[1];?>" placeholder="Customer First Name" />
			<input type="text" name="last_name" value="<?php echo $result[2];?>" placeholder="Customer Last Name" />
			<input type="text" name="customer_id" value="<?php echo $Dresult[0];?>" placeholder="Driver ID" />
			<input type="text" name="driver_id" value="<?php echo $driver_id[0];?>" placeholder="Driver ID" />
			<input type="text" name="picker_id" value="<?php echo $Presult[0];?>" placeholder="Picker ID" />
			<input type="submit" id="submit" name="submit" value="submit" />
		</form>
		<script>
		document.getElementById("submit").click();
		</script>

	<?php
	 }

     $order = Mage::getModel('sales/order')->load($_GET["ooid"], 'increment_id');
	 $order->getAllVisibleItems();
	 $address = $order->getShippingAddress();
	  $address2 = $order->getBillingAddress();

	 $orderValue = $order->getSubtotal();
	 $orderValue2 = $order->getBaseGrandTotal();
?>
<style>
.page
{
   width:90%;
}

td, th
{
   padding:5px !important;
   font-size:12px;
   color:#000;
}

table
{
   border-color:#000;
}

th
{
   color:#fff;
   background-color:green;
}
</style>
<div style="border-bottom:0px solid #dfdfdf;margin-bottom:5px;" >
<h3 class="icon-head head-manage-blog" style="padding-left:0px;color:#eb5e00;">Order No :- <a href="https://www.prestofreshgrocery.com?oid=<?php echo $_GET["ooid"]; ?>"><?php echo $_GET["ooid"]; ?></a></h3>
<?php
$currentUrl = Mage::helper('core/url')->getCurrentUrl();
$url77 = explode("?oid=",$currentUrl);
?>

</div>
     <table width="48%;" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;">
	 <tr >
	 <td style="color:green;"> <b> Delivery Address  </b> </td>
	 </tr>
	 <tr>
	 <td>

	            <?php
				echo $custName = $address->getName()."<br/>";
				echo $custAddr = $address->getStreetFull()."<br/>";
				echo $region2 = $address->getCity()."<br/>";
				echo $region = $address->getRegion()."<br/>";
				echo $country = $address["postcode"];
				?>
	</td>
	</tr>
	</table>

	<table width="48%;"" style="border:1px solid #1d3e5f;border-collapse:collapse;float:left;margin-left:1%">
	 <tr >
	 <td style="color:green;"> <b> Billing Address  </b> </td>
	 </tr>
	 <tr>
	 <td>

	            <?php
				echo $custName = $address2->getName()."<br/>";
				echo $custAddr = $address2->getStreetFull()."<br/>";
				echo $region2 = $address2->getCity()."<br/>";
				echo $region = $address2->getRegion()."<br/>";
				echo $country = $address2["postcode"];
				?>
	</td>
	</tr>
	</table>
<?php

   $value["order_number"] = $_GET["ooid"]; ?>

		     <?php $sql3    = "SELECT ss.substitute ,msi.item_id,msi.product_id,msi.price,msi.row_total,msi.qty_ordered,msi.name,msi.sku FROM `mg_sales_flat_order_item` msi
			    left join supervision ss on msi.item_id = ss.item_id  where msi.`order_id`='". $order["entity_id"]."' and ss.substitute is not NULL";

			   $rows3 = $connection->fetchAll($sql3);
			   $cc=count($rows3);
			   if($cc>=1) { ?>
			   <div style="clear:both;">&nbsp;</div>
			   <div style="margin-top:10px;clear:both;">
			   <table border=1 cellpadding="5" cellspacing="5" border="1" style="border-collapse:collapse" >

			   <?php
			   foreach ($rows3 as $value3) {
			   if($value3["substitute"]!="") {

			     $bbb=1;

				 if($bbb==1 && $jkl!=22) {

			   ?>

			    <tr style="background-color:green;color:#fff;font-weight:bold;">
			   <th style="color:#fff;">Product Name</th>
			   <th style="color:#fff;">Qty.</th>
			   <th style="color:#fff;">Substitute Info</th>
			   </tr>


			   <?php $jkl=22; } ?>

			   <tr >
				<td><?php echo $value3["name"]; ?></td>
				<td style="font-weight:bold;font-size:15px;"><?php echo round($value3["qty_ordered"],0); ?></td>
				<td><?php echo $value3["substitute"]; ?></td>
				</tr>


			   <?php } } ?>
			   </table>
			   </div>
			   <?php } ?>




		   <?php if(isset($_GET["sign2"]) && $_GET["sign2"]!="" ) {

			 echo '<div style="font-weight:bold;color:green;margin-top:15px;">Thank You For Your Order . </div>';
		   }
		   else
		   {
		   ?>
		   <br/>
		   <form method="get" name="frmtip">
		   <input type="hidden" name="ooid" id="ooid" value="<?php echo $_GET["ooid"]; ?>" />
		    <div style="margin-top:10px;color:green;clear:both;">
		   Grand Total : $<?php echo round($orderValue2,2); ?>
		   </div>
		   <?php
		   $sql22444 = "SELECT unattended_shipping FROM `mg_shipping_delivery_window` where `order_number`='".$_GET["ooid"]."'";
		   $rows12224 = $connection->fetchOne($sql22444);
		   if($rows12224=='yes')
		   {
		   ?>

		   <div style="margin-top:10px;font-weight:bold;color:red;">This is an Unattended Delivery. Be sure you are at correct address - any delivery corrections will be deducted from driver pay. Customer is supposed to leave a cooler for perishable items and the location for leaving items should be secure. If cooler is not present or area is not secure, contact Ops Manager for direction.</div>
		   <?php } ?>
			<div  style="margin-top:10px;">
		   <b>Gratuity (applied to card) &nbsp;</b>
		   <?php
		   $check="select tip from drivlist where ordernumber='".$_GET["ooid"]."'";
	       $check_tip=$connection->fetchOne($check);

		   $check="select sign from drivlist where ordernumber='".$_GET["ooid"]."'";
	       $check_sign=$connection->fetchOne($check);  ?>
		 $<input type="text" name="tip" id="tip" style="width:90px;border:1px solid #000;height:25px" value="<?php echo $check_tip; ?>" />
		   <br/>
		  </div>
		  <div style="margin-top:10px;">
		    Initial to Accept Delivery &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="sign" id="sign" style="width:90px;border:1px solid #000;height:25px" value="<?php echo $check_sign; ?>" />
			</div>

			<br/> <input type="submit" style="background-color:green;padding:5px;color:#fff;margin-top:5px;margin-bottom:5px;font-size:12px;font-weight:bold;" name="std" value="Accept Delivery"  />

			</form>
			<?php } ?>


		  <?php
		  exit(0);
  }
      if(!isset($_GET["gt"])) {
	   $j=0;
	   for($i=0;$i<=0;$i++){
     $kbt = date("d_m_Y");
	 // $kbt = '08_06_2016';
	 $seconds = time();
     $rounded_seconds = round($seconds / (15 * 60)) * (15 * 60);
     echo "Current Time : " . date('H:i', $rounded_seconds) . "\n";
	 $kpo=str_replace(":","",date('H:i', $rounded_seconds));
	 ?>
	 <?php $kbt2 = date("m-d-Y");
	 $sql = "SELECT m.* FROM `mg_shipping_delivery_window` m  where m.`window` LIKE '%".$kbt."' and driver_email='".$customerData["email"]."' order by m.`rc`";
	 $rows = $connection->fetchAll($sql);
	 $total_rows = count($rows);
		 if($total_rows>=1)
		 {
		      $sel_route="select route from mg_shipping_delivery_window where `window` LIKE '%".$kbt."' and driver_email='".$customerData["email"]."'  order by `rc`";
			  $route_name=$connection->fetchOne($sel_route);

			  $sel_route="select driverid from mg_shipping_delivery_window where `window` LIKE '%".$kbt."' and driver_email='".$customerData["email"]."'  order by `rc`";
			  $route_id=$connection->fetchOne($sel_route);

			 if($route_name!="")
			 {
			    $sel_std="select std from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$std=$connection->fetchOne($sel_std);

				$sel_rnote="select note from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$rnote=$connection->fetchOne($sel_rnote);

				$sel_std2="select std2 from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$std2=$connection->fetchOne($sel_std2);

				$sel_v="select driver from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$vehicle=$connection->fetchOne($sel_v);

				$sel_startime="select starttime from route_driver where route='".$route_name."'and rid='".$route_id."'";
				$starttime=$connection->fetchOne($sel_startime);

				$sel_endtime="select endtime from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$endtime=$connection->fetchOne($sel_endtime);

				$sel_exptype="select exptype from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$exptype=$connection->fetchOne($sel_exptype);

				$sel_expr="select expr from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$expr=$connection->fetchOne($sel_expr);
			 }
		 ?>

	 <script type="text/javascript">
	 function dostarttime(gti)
	 {
	     jQuery("#starttime").val(gti);
		 jQuery("#frmdrive").submit();

	 }
	  function doendtime(gti)
	 {
	     jQuery("#endtime").val(gti);
		 jQuery("#frmdrive").submit();

	 }
	 </script>
		    <form method="post" name="frmdrive" id="frmdrive" action="">
		    <table border=1 style="border-collapse:collapse;font-size:11px;margin-top:10px;margin-bottom:10px;border:1px solid #000;">
			<tr>
			<td><b>Scheduled Departure Time</b></td>
			<td><b><?php echo $std; ?></b></td>
			<td style="text-align:left;"><b>Scheduled Finish Time</b> </td>
			<td><b><?php echo $std2; ?></b></td>
			</tr>
			<tr>
			<td colspan="4"> <b> Vehicle Name :- <?php echo $vehicle; ?> </b> </td>
			</tr>
		    <tr <?php if($starttime!="" && $endtime!="") { ?> style="background:#d5d5d5;" <?php } ?> >
				<td colspan="4">
				<br/>
				<div style="width:100%;text-align:left;"> Shift Timings & Expenses </div>
				<br/>
				<div <?php if($starttime!="") { ?>  style="background:#dfffdf;" <?php } ?> >
				<b> Actual Start Time  </b>   &nbsp;&nbsp;&nbsp;
				 <select name="starttime" id="starttime" style="border:1px solid #000; margin-top:5px;" >
                 <option value="" > Select </option>
<option value="0900" <?php if($starttime=='0900') { ?> selected <?php } ?> >09:00</option>
<option value="0915" <?php if($starttime=='0915') { ?> selected <?php } ?> >09:15</option>
<option value="0930" <?php if($starttime=='0930') { ?> selected <?php } ?> >09:30</option>
<option value="0945" <?php if($starttime=='0945') { ?> selected <?php } ?> >09:45</option>
<option value="1000" <?php if($starttime=='1000') { ?> selected <?php } ?> >10:00</option>
<option value="1015" <?php if($starttime=='1015') { ?> selected <?php } ?> >10:15</option>
<option value="1030" <?php if($starttime=='1030') { ?> selected <?php } ?> >10:30</option>
<option value="1045" <?php if($starttime=='1045') { ?> selected <?php } ?> >10:45</option>
<option value="1100" <?php if($starttime=='1100') { ?> selected <?php } ?> >11:00</option>
<option value="1115" <?php if($starttime=='1115') { ?> selected <?php } ?> >11:15</option>
<option value="1130" <?php if($starttime=='1130') { ?> selected <?php } ?> >11:30</option>
<option value="1145" <?php if($starttime=='1145') { ?> selected <?php } ?> >11:45</option>
<option value="1200" <?php if($starttime=='1200') { ?> selected <?php } ?> >12:00</option>
<option value="1215" <?php if($starttime=='1215') { ?> selected <?php } ?> >12:15</option>
<option value="1230" <?php if($starttime=='1230') { ?> selected <?php } ?> >12:30</option>
<option value="1245" <?php if($starttime=='1245') { ?> selected <?php } ?> >12:45</option>
<option value="1300" <?php if($starttime=='1300') { ?> selected <?php } ?> >13:00</option>
<option value="1315" <?php if($starttime=='1315') { ?> selected <?php } ?> >13:15</option>
<option value="1330" <?php if($starttime=='1330') { ?> selected <?php } ?> >13:30</option>
<option value="1345" <?php if($starttime=='1345') { ?> selected <?php } ?> >13:45</option>
<option value="1400" <?php if($starttime=='1400') { ?> selected <?php } ?> >14:00</option>
<option value="1415" <?php if($starttime=='1415') { ?> selected <?php } ?> >14:15</option>
<option value="1430" <?php if($starttime=='1430') { ?> selected <?php } ?> >14:30</option>
<option value="1445" <?php if($starttime=='1445') { ?> selected <?php } ?> >14:45</option>
<option value="1500" <?php if($starttime=='1500') { ?> selected <?php } ?> >15:00</option>
<option value="1515" <?php if($starttime=='1515') { ?> selected <?php } ?> >15:15</option>
<option value="1530" <?php if($starttime=='1530') { ?> selected <?php } ?> >15:30</option>
<option value="1545" <?php if($starttime=='1545') { ?> selected <?php } ?> >15:45</option>
<option value="1600" <?php if($starttime=='1600') { ?> selected <?php } ?> >16:00</option>
<option value="1615" <?php if($starttime=='1615') { ?> selected <?php } ?> >16:15</option>
<option value="1630" <?php if($starttime=='1630') { ?> selected <?php } ?> >16:30</option>
<option value="1645" <?php if($starttime=='1645') { ?> selected <?php } ?> >16:45</option>
<option value="1700" <?php if($starttime=='1700') { ?> selected <?php } ?> >17:00</option>
<option value="1715" <?php if($starttime=='1715') { ?> selected <?php } ?> >17:15</option>
<option value="1730" <?php if($starttime=='1730') { ?> selected <?php } ?> >17:30</option>
<option value="1745" <?php if($starttime=='1745') { ?> selected <?php } ?> >17:45</option>
<option value="1800" <?php if($starttime=='1800') { ?> selected <?php } ?> >18:00</option>
<option value="1815" <?php if($starttime=='1815') { ?> selected <?php } ?> >18:15</option>
<option value="1830" <?php if($starttime=='1830') { ?> selected <?php } ?> >18:30</option>
<option value="1845" <?php if($starttime=='1845') { ?> selected <?php } ?> >18:45</option>
<option value="1900" <?php if($starttime=='1900') { ?> selected <?php } ?> >19:00</option>
<option value="1915" <?php if($starttime=='1915') { ?> selected <?php } ?> >19:15</option>
<option value="1930" <?php if($starttime=='1930') { ?> selected <?php } ?> >19:30</option>
<option value="1945" <?php if($starttime=='1945') { ?> selected <?php } ?> >19:45</option>
<option value="2000" <?php if($starttime=='2000') { ?> selected <?php } ?> >20:00</option>
<option value="2015" <?php if($starttime=='2015') { ?> selected <?php } ?> >20:15</option>
<option value="2030" <?php if($starttime=='2030') { ?> selected <?php } ?> >20:30</option>
<option value="2045" <?php if($starttime=='2045') { ?> selected <?php } ?> >20:45</option>
<option value="2100" <?php if($starttime=='2100') { ?> selected <?php } ?> >21:00</option>
<option value="2115" <?php if($starttime=='2115') { ?> selected <?php } ?> >21:15</option>
<option value="2130" <?php if($starttime=='2130') { ?> selected <?php } ?> >21:30</option>
<option value="2145" <?php if($starttime=='2145') { ?> selected <?php } ?> >21:45</option>
<option value="2200" <?php if($starttime=='2200') { ?> selected <?php } ?> >22:00</option>
<option value="2215" <?php if($starttime=='2215') { ?> selected <?php } ?> >22:15</option>
<option value="2230" <?php if($starttime=='2230') { ?> selected <?php } ?> >22:30</option>
<option value="2245" <?php if($starttime=='2245') { ?> selected <?php } ?> >22:45</option>
<option value="2300" <?php if($starttime=='2300') { ?> selected <?php } ?> >23:00</option>
<option value="2315" <?php if($starttime=='2315') { ?> selected <?php } ?> >23:15</option>
<option value="2330" <?php if($starttime=='2330') { ?> selected <?php } ?> >23:30</option>
<option value="2345" <?php if($starttime=='2345') { ?> selected <?php } ?> >23:45</option>
<option value="0100" <?php if($starttime=='0100') { ?> selected <?php } ?> >01:00</option>
<option value="0115" <?php if($starttime=='0115') { ?> selected <?php } ?> >01:15</option>
<option value="0130" <?php if($starttime=='0130') { ?> selected <?php } ?> >01:30</option>
<option value="0145" <?php if($starttime=='0145') { ?> selected <?php } ?> >01:45</option>
<option value="0200" <?php if($starttime=='0200') { ?> selected <?php } ?> >02:00</option>
<option value="0215" <?php if($starttime=='0215') { ?> selected <?php } ?> >02:15</option>
<option value="0230" <?php if($starttime=='0230') { ?> selected <?php } ?> >02:30</option>
<option value="0245" <?php if($starttime=='0245') { ?> selected <?php } ?> >02:45</option>
<option value="0300" <?php if($starttime=='0300') { ?> selected <?php } ?> >03:00</option>
<option value="0315" <?php if($starttime=='0315') { ?> selected <?php } ?> >03:15</option>
<option value="0330" <?php if($starttime=='0330') { ?> selected <?php } ?> >03:30</option>
<option value="0345" <?php if($starttime=='0345') { ?> selected <?php } ?> >03:45</option>
<option value="0400" <?php if($starttime=='0400') { ?> selected <?php } ?> >04:00</option>
<option value="0415" <?php if($starttime=='0415') { ?> selected <?php } ?> >04:15</option>
<option value="0430" <?php if($starttime=='0430') { ?> selected <?php } ?> >04:30</option>
<option value="0445" <?php if($starttime=='0445') { ?> selected <?php } ?> >04:45</option>
<option value="0500" <?php if($starttime=='0500') { ?> selected <?php } ?> >05:00</option>
<option value="0515" <?php if($starttime=='0515') { ?> selected <?php } ?> >05:15</option>
<option value="0530" <?php if($starttime=='0530') { ?> selected <?php } ?> >05:30</option>
<option value="0545" <?php if($starttime=='0545') { ?> selected <?php } ?> >05:45</option>
<option value="0600" <?php if($starttime=='0600') { ?> selected <?php } ?> >06:00</option>
<option value="0615" <?php if($starttime=='0615') { ?> selected <?php } ?> >06:15</option>
<option value="0630" <?php if($starttime=='0630') { ?> selected <?php } ?> >06:30</option>
<option value="0645" <?php if($starttime=='0645') { ?> selected <?php } ?> >06:45</option>
<option value="0700" <?php if($starttime=='0700') { ?> selected <?php } ?> >07:00</option>
<option value="0715" <?php if($starttime=='0715') { ?> selected <?php } ?> >07:15</option>
<option value="0730" <?php if($starttime=='0730') { ?> selected <?php } ?> >07:30</option>
<option value="0745" <?php if($starttime=='0745') { ?> selected <?php } ?> >07:45</option>
<option value="0800" <?php if($starttime=='0800') { ?> selected <?php } ?> >08:00</option>
<option value="0815" <?php if($starttime=='0815') { ?> selected <?php } ?> >08:15</option>
<option value="0830" <?php if($starttime=='0830') { ?> selected <?php } ?> >08:30</option>
<option value="0845" <?php if($starttime=='0845') { ?> selected <?php } ?> >08:45</option>
</select>  &nbsp; &nbsp; <?php if($starttime=="") { ?>
	 <input type="button" style="background-color:green;padding:5px;color:#fff;" name="std" value="Clock In" onClick="dostarttime('<?php echo $kpo ?>');">
	    <?php } ?>
		 </div>
		 <div <?php if($endtime!="") { ?>  style="background:#dfffdf;" <?php } ?> >
			      <b> Actual Finish Time  </b>  &nbsp;&nbsp;
			       <select name="endtime" id="endtime" style="border:1px solid #000; margin-top:5px;" >
			<option value="" > Select </option>
			<option value="0900" <?php if($endtime=='0900') { ?> selected <?php } ?> >09:00</option>
<option value="0915" <?php if($endtime=='0915') { ?> selected <?php } ?> >09:15</option>
<option value="0930" <?php if($endtime=='0930') { ?> selected <?php } ?> >09:30</option>
<option value="0945" <?php if($endtime=='0945') { ?> selected <?php } ?> >09:45</option>

<option value="1000" <?php if($endtime=='1000') { ?> selected <?php } ?> >10:00</option>
<option value="1015" <?php if($endtime=='1015') { ?> selected <?php } ?> >10:15</option>
<option value="1030" <?php if($endtime=='1030') { ?> selected <?php } ?> >10:30</option>
<option value="1045" <?php if($endtime=='1045') { ?> selected <?php } ?> >10:45</option>


<option value="1100" <?php if($endtime=='1100') { ?> selected <?php } ?> >11:00</option>
<option value="1115" <?php if($endtime=='1115') { ?> selected <?php } ?> >11:15</option>
<option value="1130" <?php if($endtime=='1130') { ?> selected <?php } ?> >11:30</option>
<option value="1145" <?php if($endtime=='1145') { ?> selected <?php } ?> >11:45</option>


<option value="1200" <?php if($endtime=='1200') { ?> selected <?php } ?> >12:00</option>
<option value="1215" <?php if($endtime=='1215') { ?> selected <?php } ?> >12:15</option>
<option value="1230" <?php if($endtime=='1230') { ?> selected <?php } ?> >12:30</option>
<option value="1245" <?php if($endtime=='1245') { ?> selected <?php } ?> >12:45</option>


<option value="1300" <?php if($endtime=='1300') { ?> selected <?php } ?> >13:00</option>
<option value="1315" <?php if($endtime=='1315') { ?> selected <?php } ?> >13:15</option>
<option value="1330" <?php if($endtime=='1330') { ?> selected <?php } ?> >13:30</option>
<option value="1345" <?php if($endtime=='1345') { ?> selected <?php } ?> >13:45</option>

<option value="1400" <?php if($endtime=='1400') { ?> selected <?php } ?> >14:00</option>
<option value="1415" <?php if($endtime=='1415') { ?> selected <?php } ?> >14:15</option>
<option value="1430" <?php if($endtime=='1430') { ?> selected <?php } ?> >14:30</option>
<option value="1445" <?php if($endtime=='1445') { ?> selected <?php } ?> >14:45</option>

<option value="1500" <?php if($endtime=='1500') { ?> selected <?php } ?> >15:00</option>
<option value="1515" <?php if($endtime=='1515') { ?> selected <?php } ?> >15:15</option>
<option value="1530" <?php if($endtime=='1530') { ?> selected <?php } ?> >15:30</option>
<option value="1545" <?php if($endtime=='1545') { ?> selected <?php } ?> >15:45</option>


<option value="1600" <?php if($endtime=='1600') { ?> selected <?php } ?> >16:00</option>
<option value="1615" <?php if($endtime=='1615') { ?> selected <?php } ?> >16:15</option>
<option value="1630" <?php if($endtime=='1630') { ?> selected <?php } ?> >16:30</option>
<option value="1645" <?php if($endtime=='1645') { ?> selected <?php } ?> >16:45</option>


<option value="1700" <?php if($endtime=='1700') { ?> selected <?php } ?> >17:00</option>
<option value="1715" <?php if($endtime=='1715') { ?> selected <?php } ?> >17:15</option>
<option value="1730" <?php if($endtime=='1730') { ?> selected <?php } ?> >17:30</option>
<option value="1745" <?php if($endtime=='1745') { ?> selected <?php } ?> >17:45</option>


<option value="1800" <?php if($endtime=='1800') { ?> selected <?php } ?> >18:00</option>
<option value="1815" <?php if($endtime=='1815') { ?> selected <?php } ?> >18:15</option>
<option value="1830" <?php if($endtime=='1830') { ?> selected <?php } ?> >18:30</option>
<option value="1845" <?php if($endtime=='1845') { ?> selected <?php } ?> >18:45</option>


<option value="1900" <?php if($endtime=='1900') { ?> selected <?php } ?> >19:00</option>
<option value="1915" <?php if($endtime=='1915') { ?> selected <?php } ?> >19:15</option>
<option value="1930" <?php if($endtime=='1930') { ?> selected <?php } ?> >19:30</option>
<option value="1945" <?php if($endtime=='1945') { ?> selected <?php } ?> >19:45</option>


<option value="2000" <?php if($endtime=='2000') { ?> selected <?php } ?> >20:00</option>
<option value="2015" <?php if($endtime=='2015') { ?> selected <?php } ?> >20:15</option>
<option value="2030" <?php if($endtime=='2030') { ?> selected <?php } ?> >20:30</option>
<option value="2045" <?php if($endtime=='2045') { ?> selected <?php } ?> >20:45</option>


<option value="2100" <?php if($endtime=='2100') { ?> selected <?php } ?> >21:00</option>
<option value="2115" <?php if($endtime=='2115') { ?> selected <?php } ?> >21:15</option>
<option value="2130" <?php if($endtime=='2130') { ?> selected <?php } ?> >21:30</option>
<option value="2145" <?php if($endtime=='2145') { ?> selected <?php } ?> >21:45</option>


<option value="2200" <?php if($endtime=='2200') { ?> selected <?php } ?> >22:00</option>
<option value="2215" <?php if($endtime=='2215') { ?> selected <?php } ?> >22:15</option>
<option value="2230" <?php if($endtime=='2230') { ?> selected <?php } ?> >22:30</option>
<option value="2245" <?php if($endtime=='2245') { ?> selected <?php } ?> >22:45</option>


<option value="2300" <?php if($endtime=='2300') { ?> selected <?php } ?> >23:00</option>
<option value="2315" <?php if($endtime=='2315') { ?> selected <?php } ?> >23:15</option>
<option value="2330" <?php if($endtime=='2330') { ?> selected <?php } ?> >23:30</option>
<option value="2345" <?php if($endtime=='2345') { ?> selected <?php } ?> >23:45</option>


<option value="0100" <?php if($endtime=='0100') { ?> selected <?php } ?> >01:00</option>
<option value="0115" <?php if($endtime=='0115') { ?> selected <?php } ?> >01:15</option>
<option value="0130" <?php if($endtime=='0130') { ?> selected <?php } ?> >01:30</option>
<option value="0145" <?php if($endtime=='0145') { ?> selected <?php } ?> >01:45</option>


<option value="0200" <?php if($endtime=='0200') { ?> selected <?php } ?> >02:00</option>
<option value="0215" <?php if($endtime=='0215') { ?> selected <?php } ?> >02:15</option>
<option value="0230" <?php if($endtime=='0230') { ?> selected <?php } ?> >02:30</option>
<option value="0245" <?php if($endtime=='0245') { ?> selected <?php } ?> >02:45</option>

<option value="0300" <?php if($endtime=='0300') { ?> selected <?php } ?> >03:00</option>
<option value="0315" <?php if($endtime=='0315') { ?> selected <?php } ?> >03:15</option>
<option value="0330" <?php if($endtime=='0330') { ?> selected <?php } ?> >03:30</option>
<option value="0345" <?php if($endtime=='0345') { ?> selected <?php } ?> >03:45</option>
<option value="0400" <?php if($endtime=='0400') { ?> selected <?php } ?> >04:00</option>
<option value="0415" <?php if($endtime=='0415') { ?> selected <?php } ?> >04:15</option>
<option value="0430" <?php if($endtime=='0430') { ?> selected <?php } ?> >04:30</option>
<option value="0445" <?php if($endtime=='0445') { ?> selected <?php } ?> >04:45</option>
<option value="0500" <?php if($endtime=='0500') { ?> selected <?php } ?> >05:00</option>
<option value="0515" <?php if($endtime=='0515') { ?> selected <?php } ?> >05:15</option>
<option value="0530" <?php if($endtime=='0530') { ?> selected <?php } ?> >05:30</option>
<option value="0545" <?php if($endtime=='0545') { ?> selected <?php } ?> >05:45</option>
<option value="0600" <?php if($endtime=='0600') { ?> selected <?php } ?> >06:00</option>
<option value="0615" <?php if($endtime=='0615') { ?> selected <?php } ?> >06:15</option>
<option value="0630" <?php if($endtime=='0630') { ?> selected <?php } ?> >06:30</option>
<option value="0645" <?php if($endtime=='0645') { ?> selected <?php } ?> >06:45</option>
<option value="0700" <?php if($endtime=='0700') { ?> selected <?php } ?> >07:00</option>
<option value="0715" <?php if($endtime=='0715') { ?> selected <?php } ?> >07:15</option>
<option value="0730" <?php if($endtime=='0730') { ?> selected <?php } ?> >07:30</option>
<option value="0745" <?php if($endtime=='0745') { ?> selected <?php } ?> >07:45</option>
<option value="0800" <?php if($endtime=='0800') { ?> selected <?php } ?> >08:00</option>
<option value="0815" <?php if($endtime=='0815') { ?> selected <?php } ?> >08:15</option>
<option value="0830" <?php if($endtime=='0830') { ?> selected <?php } ?> >08:30</option>
<option value="0845" <?php if($endtime=='0845') { ?> selected <?php } ?> >08:45</option>
</select> &nbsp;&nbsp; <?php if($starttime!="" && $endtime=="" ) { ?>
	 <input type="button" style="background-color:red;padding:5px;color:#fff;" name="std" value="Clock Out" onClick="doendtime('<?php echo $kpo ?>');" >


	 <?php } ?>
     <input type="hidden" name="routename" value="<?php echo $route_name; ?>" />
				<br/>
				 <b> <span style="color:red;font-size:11px;font-weight:normal" > Note :- please add time in military time format like 13:00 for 1pm </span>  </b><br/>
				</div>

			<p>
			<div style="margin-bottom:10px;margin-top:8px;">
			Expense Type &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :   <input type="text" name="exptype" value="<?php echo $exptype; ?>" style="border:1px soild #000;width:90px;" />
			<br/>
			</div>
			<div style="" >
			Expense Amount : $ <input type="text" name="expr" value="<?php echo $expr; ?>" style="border:1px soild #000;width:30px;" />
			</div>
			<input type="hidden" name="driverc" value="<?php echo $vehicle; ?>" /> <br/> <input type="submit" style="background-color:green;padding:5px;color:#fff;" name="std" value="Submit Expenses"  />
			</p>

		   <br/>
			</td>
			</tr>
			</table>
			</from>
				<div style="width:99%; background:grey; padding:5px; margin-bottom:7px;">
			<a href="http://www.shell.us/motorist/shell-station-locator-and-route-planner.html#iframe-Lz9jb3VudHJ5PVVTJmxhbmd1YWdlPWVuX1VTLz9jb3VudHJ5PVVTJmxhbmd1YWdlPWVuX1VTJnNpdGU9cnRsJm1vZGVzZWxlY3RlZD10cnVl" target="_blank" style="color:#fff;text-decoration:underline;">Fuel Station Finder</a>
			</div>

			<?php
    $sel_last="select popup from mg_shipping_delivery_window where `window` LIKE '%".$kbt."' and driver_email='".$customerData["email"]."' and popup is not null order by `nowtime` desc limit 0,1";
			  $last=$connection->fetchOne($sel_last);
			  if($last!="") {
	?>

			 <button class="my_popup_open" style="background-color:green;padding:5px;color:#fff;margin-top:10px;margin-bottom:10px;">Track Time </button>

  <!-- Add content to the popup -->

    <?php if($last>0 && $last>=15 )
	{
	?>
	 <div id="my_popup" style="width:200px;height:auto;background:#d5ffd5;color:#000;padding:30px;">
	<div> Note : You were <?php echo $last; ?> minutes earlier to deliver last order. It appears that you are slightly off of your route plan timing. Please be sure to call any of your future customers if it appears that you will be early or late to deliver. </div>
    <?php }  else if($last<0 && $last<=-15 ) { ?>
	 <div id="my_popup" style="width:200px;height:auto;background:#ffd9d9;color:#000;padding:30px;">
	<div> Note : You were <?php echo abs($last); ?> minutes late to deliver last order. It appears that you are slightly off of your route plan timing. Please be sure to call any of your future customers if it appears that you will be early or late to deliver. </div>
	<?php } ?>

    <!-- Add an optional button to close the popup -->
    <button class="my_popup_close" style="background-color:red;padding:5px;color:#fff;margin-top:10px;margin-bottom:10px;">Close</button>

  </div>


  <!-- Include jQuery Popup Overlay -->


  <style>
  #fade,
#fade_wrapper,

#fade_background {
  -webkit-tranzition: all 0.3s;
     -moz-tranzition: all 0.3s;
          transition: all 0.3s;
}
  </style>
  <script>

  /*!
 * jQuery Popup Overlay
 *
 * @version 1.6.0
 * @requires jQuery v1.7.1+
 * @link http://vast-eng.github.com/jquery-popup-overlay/
 */
(function ($) {

    var $window = $(window);
    var options = {};
    var zindexvalues = [];
    var lastclicked = [];
    var onevisible = false;
    var oneormorevisible = false;
    var scrollbarwidth;
    var focushandler = null;
    var blurhandler = null;
    var escapehandler = null;
    var bodymarginright = null;
    var opensuffix = '_open';
    var closesuffix = '_close';
    var focusedelementbeforepopup = null;

    var methods = {

        _init: function (el) {
            var $el = $(el);
            var options = $el.data('popupoptions');
            lastclicked[el.id] = false;
            zindexvalues[el.id] = 0;

            if (!$el.data('popup-initialized')) {
                $el.attr('data-popup-initialized', 'true');
                methods._initonce(el);
            }

            if (options.autoopen) {
                setTimeout(function() {
                    methods.show(el, 0);
                }, 0);
            }
        },

        _initonce: function (el) {
            var $body = $('body');
            var $wrapper;
            var options = $el.data('popupoptions');
            bodymarginright = parseInt($body.css('margin-right'), 10);

            if (options.type == 'tooltip') {
                options.background = false;
                options.scrolllock = false;
            }

            if (options.scrolllock) {
                // Calculate the browser's scrollbar width dynamically
                var parent;
                var child;
                if (typeof scrollbarwidth === 'undefined') {
                    parent = $('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo('body');
                    child = parent.children();
                    scrollbarwidth = child.innerWidth() - child.height(99).innerWidth();
                    parent.remove();
                }
            }

            if (!$el.attr('id')) {
                $el.attr('id', 'j-popup-' + parseInt(Math.random() * 100000000));
            }

            $el.addClass('popup_content');

            $body.prepend(el);

            $el.wrap('<div id="' + el.id + '_wrapper" class="popup_wrapper" />');

            $wrapper = $('#' + el.id + '_wrapper');

            $wrapper.css({
                opacity: 0,
                visibility: 'hidden',
                position: 'absolute',
                overflow: 'auto'
            });

            $el.css({
                opacity: 0,
                visibility: 'hidden',
                display: 'inline-block'
            });

            if (options.setzindex && !options.autozindex) {
                $wrapper.css('z-index', '2001');
            }

            if (!options.outline) {
                $el.css('outline', 'none');
            }

            if (options.transition) {
                $el.css('transition', options.transition);
                $wrapper.css('transition', options.transition);
            }

            // Hide popup content from screen readers initially
            $(el).attr('aria-hidden', true);

            if ((options.background) && (!$('#' + el.id + '_background').length)) {

                var popupbackground = '<div id="' + el.id + '_background" class="popup_background"></div>';

                $body.prepend(popupbackground);

                var $background = $('#' + el.id + '_background');

                $background.css({
                    opacity: 0,
                    visibility: 'hidden',
                    backgroundColor: options.color,
                    position: 'fixed',
                    top: 0,
                    right: 0,
                    bottom: 0,
                    left: 0
                });

                if (options.setzindex && !options.autozindex) {
                    $background.css('z-index', '2000');
                }

                if (options.transition) {
                    $background.css('transition', options.transition);
                }
            }

            if (options.type == 'overlay') {
                $el.css({
                    textAlign: 'left',
                    position: 'relative',
                    verticalAlign: 'middle'
                });

                $wrapper.css({
                    position: 'fixed',
                    top: 0,
                    right: 0,
                    left: 0,
                    bottom: 0,
                    textAlign: 'center'
                });

                // CSS vertical align helper
                $wrapper.append('<div class="popup_align" />');

                $('.popup_align').css({
                    display: 'inline-block',
                    verticalAlign: 'middle',
                    height: '100%'
                });
            }

            // Add WAI ARIA role to announce dialog to screen readers
            $el.attr('role', 'dialog');

            var openelement =  (options.openelement) ? options.openelement : ('.' + el.id + opensuffix);

            $(openelement).each(function (i, item) {
                $(item).attr('data-popup-ordinal', i);

                if (!$(item).attr('id')) {
                    $(item).attr('id', 'open_' + parseInt((Math.random() * 100000000), 10));
                }
            });

            // Set aria-labelledby (if aria-label or aria-labelledby is not set in html)
            if (!($el.attr('aria-labelledby') || $el.attr('aria-label'))) {
                $el.attr('aria-labelledby', $(openelement).attr('id'));
            }

            $(document).on('click', openelement, function (e) {
                if (!($el.data('popup-visible'))) {
                    var ord = $(this).data('popup-ordinal');

                    // Show element when clicked on `open` link.
                    // setTimeout is to allow `close` method to finish (for issues with multiple tooltips)
                    setTimeout(function() {
                        methods.show(el, ord);
                    }, 0);

                    e.preventDefault();
                }
            });

            // Handler: `close` element
            var closeelement = (options.closeelement) ? options.closeelement : ('.' + el.id + closesuffix);
            $(document).on('click', closeelement, function (e) {
                methods.hide(el);
                e.preventDefault();
            });

            if (options.detach) {
                $el.hide().detach();
            } else {
                $wrapper.hide();
            }
        },

        /**
         * Show method
         *
         * @param {object} el - popup instance DOM node
         * @param {number} ordinal - order number of an `open` element
         */
        show: function (el, ordinal) {
            var $el = $(el);

            if ($el.data('popup-visible')) return;

            // Initialize if not initialized. Required for: $('#popup').popup('show')
            if (!$el.data('popup-initialized')) {
                methods._init(el);
            }
            $el.attr('data-popup-initialized', 'true');

            var $body = $('body');
            var options = $el.data('popupoptions');
            var $wrapper = $('#' + el.id + '_wrapper');
            var $background = $('#' + el.id + '_background');

            // `beforeopen` callback event
            callback(el, ordinal, options.beforeopen);

            // Remember last clicked place
            lastclicked[el.id] = ordinal;

            if (options.detach) {
                $wrapper.prepend(el);
                $el.show();
            } else {
                $wrapper.show();
            }

            setTimeout(function() {

                $wrapper.css({
                    visibility: 'visible',
                    opacity: 1
                });

                $('html').addClass('popup_visible').addClass('popup_visible_' + el.id);
                $el.addClass('popup_content_visible');
            }, 20);


            $el.css({
                'visibility': 'visible',
                'opacity': 1
            });

            // Disable background layer scrolling when popup is opened
            if (options.scrolllock) {
                $body.css('overflow', 'hidden');
                if ($body.height() > $window.height()) {
                    $body.css('margin-right', bodymarginright + scrollbarwidth);
                }
            }

            setTimeout(function () {
                // Set event handlers
                if(!onevisible) {
                    if (options.keepfocus) {
                        $(document).on('focusin', focushandler)
                    };

                    if (options.blur) {
                        $(document).on('click', blurhandler);
                    }

                    if (options.escape) {
                        $(document).on('keydown', escapehandler);
                    }
                }

                // Set plugin state
                if (!onevisible) {
                    onevisible = true;
                } else {
                    oneormorevisible = true;
                }
            }, 0);

            $el.data('popup-visible', true);

            // Position popup
            methods.reposition(el, ordinal);

            // Show background
            if (options.background) {
                $background.css({
                    'visibility': 'visible',
                    'opacity': options.opacity
                });

                // Fix IE8 issue with background not appearing
                setTimeout(function() {
                    $background.css({
                        'opacity': options.opacity
                    });
                }, 0);
            }

            // Remember which element had focus before opening a popup
            focusedelementbeforepopup = document.activeElement;

            // Handler: Keep focus inside dialog box
            if (options.keepfocus) {

                // Make holder div focusable
                $el.attr('tabindex', -1);

                // Focus popup or user specified element.
                // Initial timeout of 50ms is set to give some time to popup to show after clicking on
                // `open` element, and after animation is complete to prevent background scrolling.
                setTimeout(function() {
                    if (options.focuselement) {
                        $(options.focuselement).focus();
                    } else {
                        $el.focus();
                    }
                }, options.focusdelay);

                // Handler for keyboard focus
                focushandler = function(event) {
                    var dialog = document.getElementById(el.id);
                    if (!dialog.contains(event.target)) {
                        event.stopPropagation();
                        dialog.focus();
                    }
                };
            }

            // Calculating maximum z-index
            if (options.autozindex) {

                var elements = document.getElementsByTagName('*');
                var len = elements.length;
                var maxzindex = 0;

                for(var i=0; i<len; i++){

                    var elementzindex = $(elements[i]).css('z-index');

                    if(elementzindex !== 'auto'){

                      elementzindex = parseInt(elementzindex);

                      if(maxzindex < elementzindex){
                        maxzindex = elementzindex;
                      }
                    }
                }

                zindexvalues[el.id] = maxzindex;

                // Add z-index to the wrapper
                if (zindexvalues[el.id] > 0) {
                    $wrapper.css({
                        zIndex: (zindexvalues[el.id] + 2)
                    });
                }

                // Add z-index to the background
                if (options.background) {
                    if (zindexvalues[el.id] > 0) {
                        $('#' + el.id + '_background').css({
                            zIndex: (zindexvalues[el.id] + 1)
                        });
                    }
                }
            }

            // Handler: Hide popup if clicked outside of it
            if (options.blur) {
                blurhandler = function (e) {
                    if (!$(e.target).parents().andSelf().is('#' + el.id)) {
                        methods.hide(el);
                    }
                };
            }

            // Handler: Close popup on ESC key
            if (options.escape) {
                escapehandler = function (e) {
                    if (e.keyCode == 27 && $el.data('popup-visible')) {
                        methods.hide(el);
                    }
                };
            }

            // Hide main content from screen readers
            $(options.pagecontainer).attr('aria-hidden', true);

            // Reveal popup content to screen readers
            $el.attr('aria-hidden', false);

            $wrapper.one('transitionend', function() {
                callback(el, ordinal, options.opentransitionend);
            });

            callback(el, ordinal, options.onopen);
        },

        /**
         * Hide method
         *
         * @param {object} el - popup instance DOM node
         */
        hide: function (el) {

            var $body = $('body');
            var $el = $(el);
            var options = $el.data('popupoptions');
            var $wrapper = $('#' + el.id + '_wrapper');
            var $background = $('#' + el.id + '_background');

            $el.data('popup-visible', false);

            if (oneormorevisible) {
                $('html').removeClass('popup_visible_' + el.id);
                oneormorevisible = false;
            } else {
                $('html').removeClass('popup_visible').removeClass('popup_visible_' + el.id);
                onevisible = false;
            }

            $el.removeClass('popup_content_visible');

            // Re-enable scrolling of background layer
            if (options.scrolllock) {
                setTimeout(function() {
                    $body.css({
                        overflow: 'visible',
                        'margin-right': bodymarginright
                    });
                }, 10); // 10ms added for CSS transition in Firefox which doesn't like overflow:auto
            }

            // Unbind blur handler
            if (options.blur) {
                $(document).off('click', blurhandler);
            }

            if (options.keepfocus) {

                // Unbind focus handler
                $(document).off('focusin', focushandler);

                // Focus back on saved element
                setTimeout(function() {
                    if ($(focusedelementbeforepopup).is(':visible')) {
                        focusedelementbeforepopup.focus();
                    }
                }, 0);
            }

            // Unbind ESC key handler
            if (options.escape) {
                $(document).off('keydown', escapehandler);
            }

            // Hide popup
            $wrapper.css({
                'visibility': 'hidden',
                'opacity': 0
            });
            $el.css({
                'visibility': 'hidden',
                'opacity': 0
            });

            // Hide background
            if (options.background) {
                $background.css({
                    'visibility': 'hidden',
                    'opacity': 0
                });
            }

            // After closing CSS transition is over... (if transition is set and supported)
            $el.one('transitionend', function(e) {

                if (!($el.data('popup-visible'))) {
                    if (options.detach) {
                        $el.hide().detach();
                    } else {
                        $wrapper.hide();
                    }
                }

                if (!options.notransitiondetach) {
                    callback(el, lastclicked[el.id], options.closetransitionend);
                }
            });

            if (options.notransitiondetach) {
                if (options.detach) {
                    $el.hide().detach();
                } else {
                    $wrapper.hide();
                }
            }

            // Reveal main content to screen readers
            $(options.pagecontainer).attr('aria-hidden', false);

            // Hide popup content from screen readers
            $el.attr('aria-hidden', true);

            // `onclose` callback event
            callback(el, lastclicked[el.id], options.onclose);
        },

        /**
         * Toggle method
         *
         * @param {object} el - popup instance DOM node
         * @param {number} ordinal - order number of an `open` element
         */
        toggle: function (el, ordinal) {
            if ($el.data('popup-visible')) {
                methods.hide(el);
            } else {
                setTimeout(function() {
                    methods.show(el, ordinal);
                }, 0);
            }
        },

        /**
         * Reposition method
         *
         * @param {object} el - popup instance DOM node
         * @param {number} ordinal - order number of an `open` element
         */
        reposition: function (el, ordinal) {
            var $el = $(el);
            var options = $el.data('popupoptions');
            var $wrapper = $('#' + el.id + '_wrapper');
            var $background = $('#' + el.id + '_background');

            ordinal = ordinal || 0;

            // Tooltip type
            if (options.type == 'tooltip') {
                $wrapper.css({
                    'position': 'absolute'
                });
                var openelement =  (options.openelement) ? options.openelement : ('.' + el.id + opensuffix);
                var $elementclicked = $(openelement + '[data-popup-ordinal="' + ordinal + '"]');
                var linkOffset = $elementclicked.offset();

                // Horizontal position for tooltip
                if (options.horizontal == 'right') {
                    $wrapper.css('left', linkOffset.left + $elementclicked.outerWidth() + options.offsetleft);
                } else if (options.horizontal == 'leftedge') {
                    $wrapper.css('left', linkOffset.left + $elementclicked.outerWidth() - $elementclicked.outerWidth() +  options.offsetleft);
                } else if (options.horizontal == 'left') {
                    $wrapper.css('right', $(window).width() - linkOffset.left  - options.offsetleft);
                } else if (options.horizontal == 'rightedge') {
                    $wrapper.css('right', $(window).width()  - linkOffset.left - $elementclicked.outerWidth() - options.offsetleft);
                } else {
                    $wrapper.css('left', linkOffset.left + ($elementclicked.outerWidth() / 2) - ($el.outerWidth() / 2) - parseFloat($el.css('marginLeft')) + options.offsetleft);
                }

                // Vertical position for tooltip
                if (options.vertical == 'bottom') {
                    $wrapper.css('top', linkOffset.top + $elementclicked.outerHeight() + options.offsettop);
                } else if (options.vertical == 'bottomedge') {
                    $wrapper.css('top', linkOffset.top + $elementclicked.outerHeight() - $el.outerHeight() + options.offsettop);
                } else if (options.vertical == 'top') {
                    $wrapper.css('bottom', $(window).height() - linkOffset.top - options.offsettop);
                } else if (options.vertical == 'topedge') {
                    $wrapper.css('bottom', $(window).height() - linkOffset.top - $el.outerHeight() - options.offsettop);
                } else {
                    $wrapper.css('top', linkOffset.top + ($elementclicked.outerHeight() / 2) - ($el.outerHeight() / 2) - parseFloat($el.css('marginTop')) + options.offsettop);
                }

            // Overlay type
            } else if (options.type == 'overlay') {

                // Horizontal position for overlay
                if (options.horizontal) {
                    $wrapper.css('text-align', options.horizontal);
                } else {
                    $wrapper.css('text-align', 'center');
                }

                // Vertical position for overlay
                if (options.vertical) {
                    $el.css('vertical-align', options.vertical);
                } else {
                    $el.css('vertical-align', 'middle');
                }
            }
        }

    };

    /**
     * Callback event calls
     *
     * @param {object} el - popup instance DOM node
     * @param {number} ordinal - order number of an `open` element
     * @param {function} func - callback function
     */
    var callback = function (el, ordinal, func) {
        var openelement =  (options.openelement) ? options.openelement : ('.' + el.id + opensuffix);
        var elementclicked = $(openelement + '[data-popup-ordinal="' + ordinal + '"]');
        if (typeof func == 'function') {
            func(elementclicked);
        }
    };

    /**
     * Plugin API
     */
    $.fn.popup = function (customoptions) {
        return this.each(function () {

            $el = $(this);

            if (typeof customoptions === 'object') {  // e.g. $('#popup').popup({'color':'blue'})
                var opt = $.extend({}, $.fn.popup.defaults, customoptions);
                $el.data('popupoptions', opt);
                options = $el.data('popupoptions');

                methods._init(this);

            } else if (typeof customoptions === 'string') { // e.g. $('#popup').popup('hide')
                if (!($el.data('popupoptions'))) {
                    $el.data('popupoptions', $.fn.popup.defaults);
                    options = $el.data('popupoptions');
                }

                methods[customoptions].call(this, this);

            } else { // e.g. $('#popup').popup()
                if (!($el.data('popupoptions'))) {
                    $el.data('popupoptions', $.fn.popup.defaults);
                    options = $el.data('popupoptions');
                }

                methods._init(this);

            }

        });
    };

    $.fn.popup.defaults = {
        type: 'overlay',
        autoopen: false,
        background: true,
        color: 'black',
        opacity: '0.5',
        horizontal: 'center',
        vertical: 'middle',
        offsettop: 0,
        offsetleft: 0,
        escape: true,
        blur: true,
        setzindex: true,
        autozindex: false,
        scrolllock: false,
        keepfocus: true,
        focuselement: null,
        focusdelay: 50,
        outline: false,
        pagecontainer: null,
        detach: false,
        openelement: null,
        closeelement: null,
        transition: null,
        notransitiondetach: false,
        beforeopen: function(){},
        onclose: function(){},
        onopen: function(){},
        opentransitionend: function(){},
        closetransitionend: function(){}
    };

})(jQuery);

  </script>
  <script>
    jQuery(document).ready(function() {

      // Initialize the plugin
     jQuery('#my_popup').popup({

	 <?php if(isset($_GET["tip"])) { ?>
            opacity: 0.3,
            transition: 'all 0.3s',
			autoopen: true
	 <?php } else { ?>
	        opacity: 0.3,
            transition: 'all 0.3s'
	 <?php } ?>

         });

    });
  </script>

  <?php } ?>

			<table border=1 style="border-collapse:collapse;font-size:11px;margin-bottom:120px;">
			<?php

			$sel_rnote="select note from route_driver where route='".$route_name."' and rid='".$route_id."'";
		    $rnote=$connection->fetchOne($sel_rnote);

			 if($rnote!="") { ?>

			<tr style="background-color:red;color:#fff;">
			<th style="text-align:left;font-size:12px;background-color:red;text-align:center;" colspan="2"><b>Note</b></th>
			</tr>

			<tr >
			<th style="text-align:left;font-size:12px;background-color:white;font-weight:normal;padding:8px;color:#000;" colspan="2"><?php echo $rnote; ?></th>
			</tr>


			<?php } ?>

			<tr style="background-color:green;color:#fff;">
			<th style="text-align:left;font-size:12px;"><b>Customer Information</b></th>
			</tr>

		 <?php
		 }

		  $check=explode("-",$kbt2);
		  $check2[$i] =  $check[1];

		  foreach ($rows as $value) {
			   if($value["order_number"]!="" && $value["order_number"]!='100003190')
			   {
				   $sql2 = "SELECT entity_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
				   $rows2 = $connection->fetchOne($sql2);

				   $sql22 = "SELECT customer_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
				   $rows22 = $connection->fetchOne($sql22);

				   $customer = "" ;
				   $customer = Mage::getModel('customer/customer')->load($rows22);

				   $sql222 = "SELECT entity_id FROM mg_sales_flat_order_grid where customer_id='".$rows22."' and increment_id!='".$value["order_number"]."'";
				   $rows222 = $connection->fetchOne($sql222);


				   $sql22444 = "SELECT unattended_shipping FROM `mg_shipping_delivery_window` where `order_number`='".$value['order_number']."'";
				  $rows12224 = $connection->fetchOne($sql22444);


				   $efefe = "SELECT ideltime FROM `mg_shipping_delivery_window` where `order_number`='".$value['order_number']."'";
				   $ideltime = $connection->fetchOne($efefe);


				   $sel_sql="select status from drivlist where ordernumber='".$value["order_number"]."'";
				   $color=$connection->fetchOne($sel_sql);

				   $sqlstatus = "SELECT status FROM mg_sales_flat_order_grid  where increment_id='".$value["order_number"]."'";
				   $rowstatus = $connection->fetchOne($sqlstatus);

				   $sql3  = "SELECT SUM(qty_ordered) FROM `mg_sales_flat_order_item` where `order_id`='".$rows2."'";
				   $rows3 = $connection->fetchOne($sql3);
				   $order = Mage::getModel("sales/order")->load($rows2); //load order by order id
				   $address = $order->getShippingAddress();
				   $shipping_info = $order->getShippingAddress()->getData();
				   $temp = explode("|",$value['window']);
				   $temp3 = explode(".",$rows3);
				   $check22 = 0;

				if($customer->getId()!="813" && $customer->getId()!="1205"  && $customer->getId()!="52"  && $rowstatus!='canceled')
				   {

					$sqlstatus  = "SELECT d FROM packinginfo  where order_number='".$value["order_number"]."'";
					$number["d"] = $connection->fetchOne($sqlstatus);
					$sqlstatus  = "SELECT cf FROM packinginfo  where order_number='".$value["order_number"]."'";
					$number["cf"] = $connection->fetchOne($sqlstatus);
					$sqlstatus  = "SELECT bag FROM packinginfo  where order_number='".$value["order_number"]."'";
					$number["bag"] = $connection->fetchOne($sqlstatus);
					$sqlstatus  = "SELECT loose FROM packinginfo  where order_number='".$value["order_number"]."'";
					$number["loose"] = $connection->fetchOne($sqlstatus);


					$sqlstatus  = "SELECT cold_bin FROM packinginfo  where order_number='".$value["order_number"]."'";
					$number["cold_bin"] = $connection->fetchOne($sqlstatus);

					$sqlstatus  = "SELECT cold_bag FROM packinginfo  where order_number='".$value["order_number"]."'";
					$number["cold_bag"] = $connection->fetchOne($sqlstatus);

					$sqlstatus  = "SELECT frozen_bin FROM packinginfo  where order_number='".$value["order_number"]."'";
					$number["frozen_bin"] = $connection->fetchOne($sqlstatus);

					$sqlstatus  = "SELECT frozen_bag FROM packinginfo  where order_number='".$value["order_number"]."'";
					$number["frozen_bag"] = $connection->fetchOne($sqlstatus);

					if($ideltime>=60)
					{
					    echo '<tr style="height:40px;background:red;padding:5px;color:#fff;text-align:center;">
						<td colspan="2" style="text-align:center;"> Idle Time : '.round($ideltime/60,0).' Minutes </td><tr/>';
					}

		 ?>		   <tr <?php if($color==1) { ?> style="background:#daebe1;" <?php } ?> >
				   <td <?php if($rows222 == "" ) {  echo 'style="color:#1c60ff;"'; } ?> >

				   <?php if($rows12224=='yes')
					{
					echo "<span style='color:red;font-size:15px;font-weight:bold;' >Unattended Order</span><br/> ";
					}
				  ?>

				   <span style="font-size:12px;font-weight:bold;"> <a href="https://www.prestofreshgrocery.com?ooid=<?php echo $value["order_number"]; ?>" <?php if($rows222 == "" ) {  echo 'style="color:#1c60ff;font-weight:bold;font-size:12px;text-decoration:underline;"'; } else { echo 'style="color:#000;font-weight:bold;font-size:12px;text-decoration:underline;"'; } ?> onClick="return docheck('<?php echo $number["d"]; ?>','<?php echo $number["cf"]; ?>','<?php echo $number["bag"]; ?>','<?php echo $number["loose"]; ?>','<?php echo $number["cold_bin"]; ?>','<?php echo $number["cold_bag"]; ?>','<?php echo $number["frozen_bin"]; ?>','<?php echo $number["frozen_bag"]; ?>','<?php echo $value["loaded"]; ?>');" > <?php $custName = $address->getName(); ?> <?php if(trim($custName)=="") { echo $customer->getName(); } else { echo $custName; } ?> </a> # <?php echo $value["rc"]; ?> </span>
					<br/>
					 <?php echo $value["rt"]; ?> <span style=""> ( ETA : <?php echo $value["estt"]; ?>) </span>  <br/>
					<?php
					 $custAddr = $address->getStreetFull();
					 $region2 = $address->getCity();
					 $region = $address->getRegion();
					 $country = $address["postcode"];
	                ?>
	<a href="http://maps.google.com/?q=<?php echo $custAddr." ".$region2." ".$region." ".$country ; ?> " target= _blank  style="text-decoration:underline;">View Map</a> <br/>
					<?php
					echo $custAddr = $address->getStreetFull()."<br/>";
					echo $region2 = $address->getCity()."&nbsp;&nbsp;";
					echo $region = $address->getRegion()."&nbsp;&nbsp;";
					echo $country = $address["postcode"];
					?>	<br/>
						<span style="color:#000;font-family:verdana;font-weight:bold;"> <?php echo $shipping_info["telephone"]; ?></span>					<?php $groupId = $customer->getGroupId();
				         $sel_group_name="select customer_group_code from mg_customer_group where customer_group_id='".$groupId."'";
				         $group_name=$connection->fetchOne($sel_group_name);
						?>
						 <br/>
						<span style="color:black;font-family:verdana;font-weight:bold;"> Group :- <?php echo $group_name; ?></span>
					<?php
						if($shipping_info["information"]!="")
						{
					?>
						<br/>
					<span style="color:red;font-family:verdana;font-weight:normal;"> Delivery Instruction :- <?php echo $shipping_info["information"]; ?></span>
					<?php } ?>
						<br/>
						<div style="background-color:#ffd7c4;">
					 <?php if($number["d"]!="")
					{
					?>
					Dry Bins :

					 <b> <span style="color:green;font-size:14px;" ><?php echo $number["d"]; ?></span> </b>
					 <br/>
					 <?php } ?>

					<?php if($number["bag"]!="")
					{
					?>
					<b>Dry Bags :</b>

					 <span style="color:green;font-size:14px;" ><?php  echo $number["bag"]; ?> </span>
					<br/>
					<?php } ?>
					<?php if($number["loose"]!="")
					{
					?>
					<b>Dry Loose :</b>
					 <span style="color:green;font-size:14px;" ><?php  echo $number["loose"]; ?> </span>
					<br/>
					<?php } ?>


					<?php if($number["cold_bin"]!="")
					{
					?>
					<b>Cold Bin :</b>
					 <span style="color:green;font-size:14px;" ><?php  echo $number["cold_bin"]; ?> </span>
					<br/>
					<?php } ?>

					<?php if($number["cold_bag"]!="")
					{
					?>
					<b>Cold Bag :</b>
					 <span style="color:green;font-size:14px;" ><?php  echo $number["cold_bag"]; ?> </span>
					<br/>
					<?php } ?>

					<?php if($number["frozen_bin"]!="")
					{
					?>
					<b>Frozen Bin :</b>
					 <span style="color:green;font-size:14px;" ><?php  echo $number["frozen_bin"]; ?> </span>
					<br/>
					<?php } ?>

					<?php if($number["frozen_bag"]!="")
					{
					?>
					<b>Frozen Bag :</b>
					 <span style="color:green;font-size:14px;" ><?php  echo $number["frozen_bag"]; ?> </span>
					<br/>
					<?php } ?>
					</div>
					</td>
				   </tr>
				   <?php
				   }
			     }
			  }
		  ?>
		</table>
		<?php
		  }
	  }
?>

<?php include 'gmap.php'; ?>

<?php if(isset($_GET["gt"]) && $_GET["gt"]=="llist" ) {

  $kbt = date("d_m_Y");

 $sel_route="select route from mg_shipping_delivery_window where `window` LIKE '%".$kbt."' and driver_email='".$customerData["email"]."'  order by `rc`";
			  $route_name=$connection->fetchOne($sel_route);

			  $sel_route="select driverid from mg_shipping_delivery_window where `window` LIKE '%".$kbt."' and driver_email='".$customerData["email"]."'  order by `rc`";
			  $route_id=$connection->fetchOne($sel_route);


			 if($route_name!="")
			 {
			    $sel_std="select std from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$std=$connection->fetchOne($sel_std);

				$sel_std2="select std2 from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$std2=$connection->fetchOne($sel_std2);

				$sel_v="select driver from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$vehicle=$connection->fetchOne($sel_v);

				$sel_startime="select starttime from route_driver where route='".$route_name."'and rid='".$route_id."'";
				$starttime=$connection->fetchOne($sel_startime);

				$sel_endtime="select endtime from route_driver where route='".$route_name."' and rid='".$route_id."'";
				$endtime=$connection->fetchOne($sel_endtime);

			 }

 ?>
         <div id="tbldrypack" style="padding-top:10px;;margin-top:25px;">
		 <table border="1">
		 <?php if($route_id==1) { ?>
		 <tr><td colspan=2 style="background:green;color:#fff;font-size:12px;text-align:center;" > Vehicle Name : Van 1 </td></tr>
		 <?php } else if($route_id==2) { ?>
		 <tr><td colspan=2 style="background:green;color:#fff;font-size:12px;" > Vehicle Name : Box Truck </td></tr>
		 <?php } ?>
		 <tr>
		 <td>Order Information</td>
		 <td>Packing Information</td>
		 </tr>
                <?php
                     $sql32 = "SELECT m.* FROM `mg_shipping_delivery_window` m  where m.`window` LIKE '%".$kbt."' and m.driverid='".$route_id."' order by m.`rc`";
					  $rows3ek = $connection->fetchAll($sql32);
	                  $green2 = 0;
					  foreach ($rows3ek as $value) {
					  $value["increment_id"]=$value["order_number"];
	       if($value["increment_id"]!="" && $value["increment_id"]!='100003190')
		   {
		       $sql2        = "SELECT entity_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows2 = $connection->fetchOne($sql2);

			   $sql2        = "SELECT status FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rowstatus   = $connection->fetchOne($sql2);


			   $checkc = "SELECT count(msi.item_id) FROM `mg_sales_flat_order_item` msi
										left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
										left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
										left join mg_order_picker mop on mog.`increment_id` = mop.`order_number`
										left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251 and mei.store_id = 0
										left join mg_catalog_product_entity_int rr on msi.product_id = rr.entity_id and rr.attribute_id =  252 and rr.store_id = 0
										left join mg_catalog_product_entity_int qrr on msi.product_id = qrr.entity_id and qrr.attribute_id =  253 and rr.store_id = 0
										left join mg_eav_attribute_option_value rr2 on rr.value = rr2.option_id and rr2.store_id = 0
										left join mg_eav_attribute_option_value rr3 on mei.value = rr3.option_id and rr3.store_id = 0
										left join mg_eav_attribute_option_value rr4 on qrr.value = rr4.option_id and rr4.store_id = 0
										left join mg_customer_entity_varchar mcv on mog.customer_id = mcv.entity_id and mcv.attribute_id = 5
										left join mg_customer_entity_varchar mcv2 on mog.customer_id = mcv2.entity_id and mcv2.attribute_id = 7
										where ( mei.value=141 or mei.value=143 or mei.value=140 or mei.value=142 or mei.value=144 or mei.value=145 or mei.value=146 )  and msi.`order_id`  = '".$rows2."'  ";
					 $checkcde = $connection->fetchOne($checkc);

			  $checkc = "SELECT count(msi.item_id) FROM `mg_sales_flat_order_item` msi
										left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
										left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
										left join mg_order_picker mop on mog.`increment_id` = mop.`order_number`
										left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251 and mei.store_id = 0
										left join mg_catalog_product_entity_int rr on msi.product_id = rr.entity_id and rr.attribute_id =  252 and rr.store_id = 0
										left join mg_catalog_product_entity_int qrr on msi.product_id = qrr.entity_id and qrr.attribute_id =  253 and rr.store_id = 0
										left join mg_eav_attribute_option_value rr2 on rr.value = rr2.option_id and rr2.store_id = 0
										left join mg_eav_attribute_option_value rr3 on mei.value = rr3.option_id and rr3.store_id = 0
										left join mg_eav_attribute_option_value rr4 on qrr.value = rr4.option_id and rr4.store_id = 0
										left join mg_customer_entity_varchar mcv on mog.customer_id = mcv.entity_id and mcv.attribute_id = 5
										left join mg_customer_entity_varchar mcv2 on mog.customer_id = mcv2.entity_id and mcv2.attribute_id = 7
										left join supervision ss on ss.item_id = msi.item_id
										where ( mei.value=141 or mei.value=143 or mei.value=140 or mei.value=142 or mei.value=144 or mei.value=145 or mei.value=146 )  and msi.`order_id`  = '".$rows2."' and ss.log2=1 ";
					 $checkcd = $connection->fetchOne($checkc);
					 $total_check = $checkcde - $checkcd ;
			   $sql22        = "SELECT customer_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows22 = $connection->fetchOne($sql22);
			   $customer = "" ;
			   $customer = Mage::getModel('customer/customer')->load($rows22);
			   $sql222        = "SELECT entity_id FROM mg_sales_flat_order_grid where customer_id='".$rows22."' and increment_id!='".$value["order_number"]."'";
		       $rows222 = $connection->fetchOne($sql222);
			   $sql3        = "SELECT SUM(qty_ordered) FROM `mg_sales_flat_order_item` where `order_id`='".$rows2."'";
			   $rows3 = $connection->fetchOne($sql3);
			   $order = Mage::getModel("sales/order")->load($rows2); //load order by order id
			   $address = $order->getShippingAddress();
			   $shipping_info = $order->getShippingAddress()->getData();
			   $temp = explode("|",$value['window']);
			   $temp3 = explode(".",$rows3);
			   $check22 = 0;
			        $sql2g = "SELECT picker_id FROM mg_order_picker where order_number='".$value["order_number"]."'";
		            $rows2g = $connection->fetchOne($sql2g);
				    $sql2gk = "SELECT name FROM mg_pickers where id='".$rows2g."'";
		            $rows2gk = $connection->fetchOne($sql2gk);
			   $bid = $value["id"];
			   if($customer->getId()!="813" && $customer->getId()!="1205" && $customer->getId()!="52"  && $rowstatus!='canceled' && $rows2g >=1 )
			   {
	 ?>		   <tr <?php if($value["loaded"]=="1") { ?> style="background:#daebe1;" <?php } ?> id="trload-<?php echo $value["id"]; ?>" >
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#1c60ff;"'; } ?> >
			   <span style="font-size:12px;font-weight:bold;">  <?php $custName = $address->getName(); ?> <?php if(trim($custName)=="") { echo $customer->getName(); } else { echo $custName; } ?> </span>
				<br/> <span style="color:green;font-weight:bold;"> <?php echo $rows2gk; ?></span>
			   </td>
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#1c60ff;"'; } ?> >
			    <?php
				$sqlstatus  = "SELECT d FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["d"] = $connection->fetchOne($sqlstatus);
				$sqlstatus  = "SELECT cf FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["cf"] = $connection->fetchOne($sqlstatus);
				$sqlstatus  = "SELECT bag FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["bag"] = $connection->fetchOne($sqlstatus);
				$sqlstatus  = "SELECT loose FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["loose"] = $connection->fetchOne($sqlstatus);

				$sqlstatus  = "SELECT cold_bin FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["cold_bin"] = $connection->fetchOne($sqlstatus);

				$sqlstatus  = "SELECT cold_bag FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["cold_bag"] = $connection->fetchOne($sqlstatus);

				$sqlstatus  = "SELECT frozen_bin FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["frozen_bin"] = $connection->fetchOne($sqlstatus);

				$sqlstatus  = "SELECT frozen_bag FROM packinginfo  where order_number='".$value["order_number"]."'";
		        $number["frozen_bag"] = $connection->fetchOne($sqlstatus);

			?>

				<?php if($number["d"]!="")
				{
				?>
				Dry Bins :

				 <b> <span style="color:green;font-size:14px;" ><?php echo $number["d"]; ?></span> </b>
				 <br/>
				 <?php } ?>

				<?php if($number["bag"]!="")
				{
				?>
				<b>Dry Bags :</b>

				 <span style="color:green;font-size:14px;" ><?php  echo $number["bag"]; ?> </span>
				<br/>
				<?php } ?>
				<?php if($number["loose"]!="")
				{
				?>
				<b>Dry Loose :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["loose"]; ?> </span>
				<br/>
				<?php } ?>


				<?php if($value["dryload"]!="1") { ?>
				<div id="trloadtext-<?php echo $value["id"]; ?>">
				<input type="button" style="background-color:black;padding:7px;color:#fff;font-weight:bold;" name="std" value="Load Dry Items" onClick="doloaded(<?php echo $bid; ?>);" />
				</div>
				<?php } else { ?>

				<div style="color:green;"> Dry Items Are Already loaded. </div>

				<?php } ?>
				<br/>

				<?php if($number["cold_bin"]!="")
				{
				?>
				<b>Cold Bin :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["cold_bin"]; ?> </span>
				<br/>
				<?php } ?>

				<?php if($number["cold_bag"]!="")
				{
				?>
				<b>Cold Bag :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["cold_bag"]; ?> </span>
				<br/>
				<?php } ?>

				<?php if($number["frozen_bin"]!="")
				{
				?>
				<b>Frozen Bin :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["frozen_bin"]; ?> </span>
				<br/>
				<?php } ?>

				<?php if($number["frozen_bag"]!="")
				{
				?>
				<b>Frozen Bag :</b>
				 <span style="color:green;font-size:14px;" ><?php  echo $number["frozen_bag"]; ?> </span>
				<br/>
				<?php } ?>

				<?php if($value["coldload"]!="1") { ?>
				<div id="trloadtext2-<?php echo $value["id"]; ?>">
				<input type="button" style="background-color:black;padding:7px;color:#fff;font-weight:bold;" name="std" value="Load C/F Items" onClick="doloaded2(<?php echo $bid; ?>);" />
				</div>
				<?php } else { ?>
				<div style="color:green;"> C/F Items Are Already loaded. </div>
				<?php } ?>

				<?php if($total_check>=1) { ?>
				<br/>
				<span style="color:red;"> Note :- Following items still need to be packed : <br/> </span>
				<div style="color:black;padding:5px;">
				<?php
				$checkcb = "SELECT msi.name,rr2.value,msi.qty_ordered FROM `mg_sales_flat_order_item` msi
										left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
										left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
										left join mg_order_picker mop on mog.`increment_id` = mop.`order_number`
										left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251 and mei.store_id = 0
										left join mg_catalog_product_entity_int rr on msi.product_id = rr.entity_id and rr.attribute_id =  252 and rr.store_id = 0
										left join mg_catalog_product_entity_int qrr on msi.product_id = qrr.entity_id and qrr.attribute_id =  253 and rr.store_id = 0
										left join mg_eav_attribute_option_value rr2 on rr.value = rr2.option_id and rr2.store_id = 0
										left join mg_eav_attribute_option_value rr3 on mei.value = rr3.option_id and rr3.store_id = 0
										left join mg_eav_attribute_option_value rr4 on qrr.value = rr4.option_id and rr4.store_id = 0
										left join mg_customer_entity_varchar mcv on mog.customer_id = mcv.entity_id and mcv.attribute_id = 5
										left join mg_customer_entity_varchar mcv2 on mog.customer_id = mcv2.entity_id and mcv2.attribute_id = 7

										left join supervision ss on ss.item_id = msi.item_id
										where ( mei.value=141 or mei.value=143 or mei.value=140 or mei.value=142 or mei.value=144 or mei.value=145 or mei.value=146 )  and msi.`order_id`  = '".$rows2."' and ( ss.log2=0 or ss.log2 is null) ";
					 $checkcd = $connection->fetchAll($checkcb);
					 $countg = count($checkcd);
					 $cc=0;
					 if($countg>=1)
					 {
					 foreach ($checkcd as $value) {

					 $cc=$cc+1;
					 ?>
					 <div style="color:black"> <?php echo $cc; ?> ). <?php echo $value["name"]; ?> ( Location : <?php echo $value["value"]; ?>)  ( Qty Ordered : <?php echo round($value["qty_ordered"],2); ?>) </div>
					 <?php
					 } }
					 ?>
					 </div>
					 <?php
				  }
				?>
				</td>

			 </tr>
			   <?php
			   }
		     }
	     } ?>
		 </table>
         </div>
		<?php }  ?>
<br/><br/>
</table>
<?php
exit(0);
}
if($_GET["hiren"]==1)
{

echo '<style>
body>.wrapper
{
   background:none;
   font-weight:bold;
   color:#fff;
   overflow:hidden;
}

.page
{
   width:90%;
}

td, th
{
   padding-top:5px !important;
   padding-left:5px !important;
   padding-bottom:5px !important;
}

</style>';

	 if (version_compare(PHP_VERSION, '5.3.0', '<')){
  die("This example requires PHP 5.3.0 or above to work. <br>You have PHP ".PHP_VERSION." in this system");
}

$jsonPath = dirname( __FILE__ )."/../json";


if (!is_dir($jsonPath)) {
  die("Cannot find folder with JSON data at ".$jsonPath);
}

$baseApiURL = "http://vrp.viamente.com/api/vrp/v2";
$key = '3320e017-0d1b-4c67-a8e6-40d0767cc55e';

if ($key == 'YOUR_API_KEY_HERE') {
  die("Please edit example.php at line \"\$key = 'YOUR_API_KEY_HERE';\" and replace YOUR_API_KEY_HERE with your API key");
}


function assoc_array_from_json_file($fileName) {
  global $jsonPath;
  $str = '{
  "name": "Example deliveries",
  "label": "Your label text here",
  "workingDayStartMin": 0,
  "horizonDays": 2,
  "driversSpeedPercent": 100,
  "trafficProfile": {
    "name": "Lancaster",
    "description": "",
    "trafficRegions": [{
      "trafficLevelPercent": 50,
      "region": [{
        "lat": 34.707610,
        "lng": -118.175640
      }, {
        "lat": 34.708033,
        "lng": -118.231430
      }, {
        "lat": 34.661028,
        "lng": -118.243618
      }, {
        "lat": 34.626004,
        "lng": -118.216323
      }, {
        "lat": 34.631512,
        "lng": -118.157100
      }, {
        "lat": 34.693356,
        "lng": -118.151950
      }, {
        "lat": 34.700130,
        "lng": -118.161220
      }]
    }]
  },
  "loadUnitType": "Goods",
  "loadUnit2Type": "Pounds",
  "subfleetID": "flt-11111111-2222-3333-4444-555555555555",
  "orders": [{
    "name": "Nelson Torgersen",
    "loadUnits": 1,
    "loadUnits2": 10,
    "serviceTimeMin": 2,
    "location": {
      "address": "43534 Kirkland Ave, Lancaster, CA 93535, USA"
    },
    "eligibleDays": [1],
    "timeWindows": [{
      "startMin": 510,
      "stopMin": 540
    }],
    "importance": "higher",
    "skillsInclude": ["plumbing", "powertools"],
    "skillsExclude": ["landscaping"],
    "customFields": {
      "orderID": "XY-1234",
      "customerID": "AAA-9999",
      "phoneNumber": "(987) 654-3210"
    }
  }, {
    "name": "Jamie Rozman",
    "loadUnits": 2,
    "loadUnits2": 15,
    "serviceTimeMin": 2,
    "location": {
      "address": "1027 W Newgrove St, Lancaster, CA 93534, USA"
    },
    "eligibleDays": [2],
    "timeWindows": [{
      "startMin": 375,
      "stopMin": 450
    }]
  }, {
    "name": "Jessie Blewett",
    "loadUnits": 2,
    "loadUnits2": 18,
    "serviceTimeMin": 2,
    "location": {
      "address": "1235 W Kettering St, Lancaster, CA 93534, USA"
    },
    "eligibleDays": [1, 2],
    "timeWindows": [{
      "startMin": 510,
      "stopMin": 570
    }]
  }, {
    "name": "Marcie Ocon",
    "importance": "highest",
    "loadUnits": 1,
    "loadUnits2": 7,
    "serviceTimeMin": 2,
    "location": {
      "address": "45419 10th St W, Lancaster, CA 93534, USA"
    },
    "timeWindows": [{
      "startMin": 390,
      "stopMin": 390
    }]
  }, {
    "name": "Earlene Saur",
    "loadUnits": 2,
    "loadUnits2": 22,
    "serviceTimeMin": 0,
    "location": {
      "address": "44924 5th St E, Lancaster, CA 93535, USA"
    },
    "timeWindows": [{
      "startMin": 510,
      "stopMin": 600
    }]
  }, {
    "name": "Clayton Hervey",
    "loadUnits": 1,
    "loadUnits2": 4,
    "serviceTimeMin": 2,
    "location": {
      "address": "425 E Ave H 11, Lancaster, CA 93535, USA"
    },
    "timeWindows": [{
      "startMin": 540,
      "stopMin": 600
    }]
  }, {
    "name": "Earnestine Harnett",
    "loadUnits": 1,
    "loadUnits2": 7,
    "serviceTimeMin": 0,
    "location": {
      "address": "Earnestine Harnetts front door",
      "lat": 34.66239,
      "lng": -118.18351
    },
    "timeWindows": [{
      "startMin": 510,
      "stopMin": 660
    }]
  }, {
    "name": "Nelson Lufkin",
    "loadUnits": 3,
    "loadUnits2": 38,
    "serviceTimeMin": 0,
    "location": {
      "address": "43420 22nd St W, Lancaster, CA 93536, USA"
    },
    "timeWindows": [{
      "startMin": 480,
      "stopMin": 540
    }]
  }, {
    "name": "Jerri Ertl",
    "loadUnits": 3,
    "loadUnits2": 32,
    "serviceTimeMin": 2,
    "location": {
      "address": "44044 36th St W, Lancaster, CA 93536, USA"
    },
    "timeWindows": [{
      "startMin": 450,
      "stopMin": 510
    }]
  }]
}';
  return json_decode($str, true); // true = decode as associative array
}

function json_encode_ex($data) {
  return json_encode($data, JSON_HEX_TAG|JSON_HEX_APOS|JSON_HEX_QUOT|JSON_HEX_AMP);
}

function json_indent($json) {
  $result      = '';
  $pos         = 0;
  $strLen      = strlen($json);
  $indentStr   = '  ';
  $newLine     = "\n";
  $prevChar    = '';
  $outOfQuotes = true;

  for ($i=0; $i<=$strLen; $i++) {
    // Grab the next character in the string.
    $char = substr($json, $i, 1);

    // Are we inside a quoted string?
    if ($char == '"' && $prevChar != '\\') {
      $outOfQuotes = !$outOfQuotes;

    // If this character is the end of an element,
    // output a new line and indent the next line.
    } else if(($char == '}' || $char == ']') && $outOfQuotes) {
      $result .= $newLine;
      $pos --;
      for ($j=0; $j<$pos; $j++) {
        $result .= $indentStr;
      }
    }

    // Add the character to the result string.
    $result .= $char;

    // If the last character was the beginning of an element,
    // output a new line and indent the next line.
    if (($char == ',' || $char == '{' || $char == '[') && $outOfQuotes) {
      $result .= $newLine;
      if ($char == '{' || $char == '[') {
        $pos ++;
      }

      for ($j = 0; $j < $pos; $j++) {
        $result .= $indentStr;
      }
    }

    $prevChar = $char;
  }
  return $result;
}


function executeRest($url, $method, $key, $data = "") {
  $headers = array(
    'Accept: application/json',
    'Content-Type: application/json'
  );

  $url .= '?key='.$key;

  $handle = curl_init();
  curl_setopt($handle, CURLOPT_URL, $url);
  curl_setopt($handle, CURLOPT_HTTPHEADER, $headers);
  curl_setopt($handle, CURLOPT_RETURNTRANSFER, true);
  curl_setopt($handle, CURLOPT_SSL_VERIFYHOST, false);
  curl_setopt($handle, CURLOPT_SSL_VERIFYPEER, false);
  curl_setopt($handle, CURLOPT_CONNECTTIMEOUT, 10);
  curl_setopt($handle, CURLOPT_TIMEOUT, 360);

  switch($method)
  {
    case 'GET':
    break;

    case 'POST':
    curl_setopt($handle, CURLOPT_POST, true);
    curl_setopt($handle, CURLOPT_POSTFIELDS, $data);
    break;

    case 'PUT':
    curl_setopt($handle, CURLOPT_CUSTOMREQUEST, 'PUT');
    curl_setopt($handle, CURLOPT_POSTFIELDS, $data);
    break;

    case 'DELETE':
    curl_setopt($handle, CURLOPT_CUSTOMREQUEST, 'DELETE');
    break;
  }

  $response = curl_exec($handle);
  $status = curl_getinfo($handle, CURLINFO_HTTP_CODE);
 /* echo "<br>Response status: ".$status."\n";
  echo "<br>Response body: \n";
  echo "<br><pre>".json_indent($response)."</pre>\n";
  echo "<br><br>\n"; */

  if(php_sapi_name() != "cli") {
    flush();
    ob_flush();
  }

  return json_indent($response);
}



$create_new_routeplan_request = assoc_array_from_json_file("create_new_routeplan_request.json");

echo $create_new_routeplan_request."hiii";

echo "<html><body>\n";
// echo "<h1>List available subfleets</h1>\n";
// $subfleetsRes = executeRest($baseApiURL."/subfleets", 'GET', $key);

   echo "<h1>List saved routeplans</h1>\n";
   executeRest($baseApiURL."/routeplans", 'GET', $key);

// For example purposes: get the ID of the first returned subfleet and use that when creating the new routeplan
// NOTE: here we assume that the "List available subfleets" invocation was successul and that there is at least one saved subfleet.
$subfleets = json_decode($subfleetsRes, true);
$subfleetID = $subfleets['subfleets'][0]['id'];
$create_new_routeplan_request['subfleetID'] = $subfleetID;

echo "<h1>Create new routeplan</h1>\n";
// $dfdf = json_encode_ex($create_new_routeplan_request);
print_r($dfdf );

$bbr = '{"name":"Example deliveries 2","horizonDays":1,"driversSpeedPercent":100,"orders":[{"name":"100003644", "location":{"address":"19450 lorain road apt 302w   fairview park    Ohio   44126},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003639", "location":{"address":"1782 victoria rd   cleveland    Ohio   44112},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003641", "location":{"address":"428 Juneway Dr   Bay Village    Ohio   44140},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003642", "location":{"address":"4497 west 135th st   cleveland    Ohio   44135},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003643", "location":{"address":"1100 Superior Avenue East 9th Floor   Cleveland    Ohio   44114},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003647", "location":{"address":"2714 Euclid Heights Blvd Apt 206   Cleveland Heights    Ohio   44106},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003646", "location":{"address":"9821 Sunrise Boulevard #5   North Royalton    Ohio   44133},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003649", "location":{"address":"1171 Andrews Ave.   Lakewood    Ohio   44107},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003645", "location":{"address":"13800 Fairhill Rd, #317   Shaker Heights    Ohio   44120},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003635", "location":{"address":"1833 W54th up   Cleveland    Ohio   44102},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003650", "location":{"address":"2015 West 20th Street   Cleveland    Ohio   44113},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003638", "location":{"address":"710 Jefferson Avenue   Cleveland    Ohio   44113},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003648", "location":{"address":"28205 W Oviatt Rd   Bay Village    Ohio   44140},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003640", "location":{"address":"27 Somerset   Rocky River    Ohio   44116},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]},"name":"100003632", "location":{"address":"3501 Rocky River Drive   Cleveland    Ohio   44111},"eligibleDays":[1],"timeWindows":[{"startMin":510,"stopMin":540}]}]}';

$routeplanRes = executeRest($baseApiURL."/routeplans", 'POST', $key, $bbr);

$routeplanResArr = json_decode($routeplanRes, true);

$routeplanResArr['id'] = 'rpl-2bb3d1d5-686b-42f4-a1eb-8d6129ed4526';

 echo "<h1>Get details about newly created routeplan</h1>\n";
 $b = executeRest($baseApiURL."/routeplans/".$routeplanResArr['id'], 'GET', $key);

 $barr =  json_decode($b, true);

 function array2table($array, $recursive = false, $null = '&nbsp;')
{
    // Sanity check
    if (empty($array) || !is_array($array)) {
        return false;
    }

    if (!isset($array[0]) || !is_array($array[0])) {
        $array = array($array);
    }

    // Start the table
    $table = "<table>\n";

    // The header
    $table .= "\t<tr>";
    // Take the keys from the first row as the headings
    foreach (array_keys($array[0]) as $heading) {
        $table .= '<th>' . $heading . '</th>';
    }
    $table .= "</tr>\n";

    // The body
    foreach ($array as $row) {
        $table .= "\t<tr>" ;
        foreach ($row as $cell) {
            $table .= '<td>';

            // Cast objects
            if (is_object($cell)) { $cell = (array) $cell; }

            if ($recursive === true && is_array($cell) && !empty($cell)) {
                // Recursive mode
                $table .= "\n" . array2table($cell, true, true) . "\n";
            } else {
                $table .= (strlen($cell) > 0) ?
                    htmlspecialchars((string) $cell) :
                    $null;
            }

            $table .= '</td>';
        }

        $table .= "</tr>\n";
    }

    $table .= '</table>';
    return $table;
}

//echo array2table($barr["orders"]["location"]);


// print_r($barr["drivers"]);


 foreach ($barr["drivers"] as $row) {


      // echo $row["name"]."<br/>";

	  /* foreach ($row["destination"] as $row32) {

	       echo $row32["address"]."-".$row["name"]."<br/>";

	   } */



 }


 // print_r($barr["routes"]);


 $address = array();
 $jk = 0;
 foreach ($barr["orders"] as $row) {

     $address[$jk] = $row["location"]["address"];

	// echo $row["timeWindows"]["startMin"] ;

	// echo  $row["timeWindows"]["stopMin"] ;

	foreach ($row["timeWindows"] as $window) {

	      $starttime[$jk] = $window["startMin"] / 60 ;
		  $endtime[$jk] = $window["stopMin"] / 60 ;

	}

	// print_r($row["timeWindows"]);

	 $jk = $jk + 1;

 }

 echo '<table border="1" >
 <tr>
 <td>Address</td>
 <td>Driver</td>
 <td>Start Time</td>
 <td>End Time</td>
 </tr>';

 foreach ($barr["routes"] as $driver) {

	   foreach ($driver["stops"] as $driver2) {

	       if($address[$driver2["orderIdx"]]!="")
		   {
			   echo '<tr>';

			   echo '<td>';
			   echo $address[$driver2["orderIdx"]]."</td>";

			   echo '<td>';
			   echo $driver["driverID"]."</td>";



			   echo '<td>';
			   echo $starttime[$driver2["orderIdx"]].".00 </td>";

			    echo '<td>';
			   echo $endtime[$driver2["orderIdx"]].".00 </td>";

			   echo '</tr>';
		   }
	   }

 }

 echo "</table>";



 ?>



<?php
// echo "<h1>List saved routeplans</h1>\n";
// executeRest($baseApiURL."/routeplans", 'GET', $key);

echo "</body></html>\n";
// Done

// JSON helpers




// Rest helper

  exit(0);


}


if($_GET["hiren"]==4)
{
      $connection = Mage::getSingleton('core/resource')->getConnection('core_write');

?>


<style>



body>.wrapper
{
   background:none;
   font-weight:bold;
   color:#fff;
   overflow:hidden;
}

.page
{
   width:90%;
}

td, th
{
   padding:5px !important;
   font-size:12px;
   color:#000;
}

table
{
   border-color:#000;
}

th
{
   color:#fff;
}

</style>


<table border=1>

<th><b>Delivery Date</b></th>
<th><b>Delivery Time</b></th>
<th><b>Order Number</b></th>
<th><b>Total Item Qty. Ordered</b></th>
<th><b>Customer Name</b></th>
<th><b>Delivery Address</b></th>

<?php

	   $j=0;
	   for($i=0;$i<=15;$i++){



     $kbt = (date("d_m_Y",strtotime("+$i days")));
	 $kbt2 = (date("m-d-Y",strtotime("+$i days")));


	 // $pDate = strtotime($kbt2.'- 1 week');
     // $pDate2 = date('Y-m-d',$pDate);

	 $sql        = "SELECT m.* FROM `mg_shipping_delivery_window` m  where m.`window` LIKE '%".$kbt."' order by m.`window`";
	 $rows = $connection->fetchAll($sql);
	 $total_rows = count($rows);


	 if($total_rows>0)
	 {
	    $j=$j+1;
     }

	 if($j%2==0)
	 {
	    $color='#fff';
	 }
	 else
	 {
	    $color='#cecece';
	 }

	  $check=explode("-",$kbt2);

	$check2[$i] =  $check[1];


	  foreach ($rows as $value) {
	       if($value["order_number"]!="")
		   {
		       $sql2        = "SELECT entity_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows2 = $connection->fetchOne($sql2);
			   $sql22        = "SELECT customer_id FROM mg_sales_flat_order_grid where increment_id='".$value["order_number"]."'";
		       $rows22 = $connection->fetchOne($sql22);
			   $sql222        = "SELECT entity_id FROM mg_sales_flat_order_grid where customer_id='".$rows22."' and increment_id!='".$value["order_number"]."'";
		       $rows222 = $connection->fetchOne($sql222);
			   $customer = Mage::getModel('customer/customer')->load($rows22);
			   $sql3        = "SELECT SUM(qty_ordered) FROM `mg_sales_flat_order_item` where `order_id`='".$rows2."'";
			   $rows3 = $connection->fetchOne($sql3);
			   $order = Mage::getModel("sales/order")->load($rows2); //load order by order id
			   $address = $order->getShippingAddress();
			   $temp = explode("|",$value['window']);
			   $temp3 = explode(".",$rows3);
			   $check22 = 0;
			   ?>

			   <tr style="background-color:<?php echo $color; ?>;">
			   <td  <?php if($rows222 == "" ) {  echo 'style="color:#00254a;font-weight:bold;font-size:12px;"'; } ?> ><?php echo $kbt2; ?></td>
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#00254a;font-weight:bold;font-size:12px;"'; } ?> ><?php if($temp[1]=="") { echo 'Flexible Time'; } else { echo $temp[0]; } ?></td>
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#00254a;font-weight:bold;font-size:12px;"'; } ?>><?php echo $value['order_number']; ?> </td>
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#00254a;font-weight:bold;font-size:12px;"'; } ?> ><?php echo $temp3[0]; ?> </td>
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#00254a;font-weight:bold;font-size:12px;"'; } ?> ><?php echo $customer->getName(); ?> </td>
			   <td <?php if($rows222 == "" ) {  echo 'style="color:#00254a;font-weight:bold;font-size:12px;"'; } ?> >
			    <?php echo $custName = $address->getName()."&nbsp;&nbsp;";
				echo $custAddr = $address->getStreetFull()."<br/>";

				echo $region2 = $address->getCity()."&nbsp;&nbsp;";
				echo $region = $address->getRegion()."&nbsp;&nbsp;";
				echo $country = $address["postcode"]; ?>
				</td>
			   </tr>




			   <?php
		   }
	  }


	  }


?>
</table>
<?php
	 exit(0);
}


if($_GET["hiren"]==3)
{

?>

<style>
body>.wrapper
{
   background:none;
   font-weight:bold;
   color:#fff;
   overflow:hidden;
}

.page
{
   width:90%;
}

td, th
{
   padding-top:5px !important;
   padding-left:5px !important;
   padding-bottom:5px !important;
}

</style>
<?php
	  $connection = Mage::getSingleton('core/resource')->getConnection('core_write');

	 $rdate = explode("_",$_GET["d"]);

	 $opdate = $rdate[1]."-".$rdate[0]."-".$rdate[2];


	  $bpil = 0;
	  ?>


	  Date :- <?php  echo $opdate; ?> &nbsp;&nbsp;&nbsp;&nbsp; Product Type :- CUT MEAT
	  <table border=1 cellpadding="5" cellspacing="5" >

			   <tr>
			   <th >Sr.</th>
			   <th >Product Name</th>
			   <th>Qty. Order</th>

			   </tr>

	  <?php

			    $sql3 = "SELECT mei.value,msi.product_id,SUM(msi.qty_ordered) as qotd,msi.name,msi.sku FROM `mg_sales_flat_order_item` msi
			    left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251
				left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
				left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
				where msw.`window` LIKE '%".$_GET["d"]."' AND mei.value=146 group by msi.sku";
			    $rows3 = $connection->fetchAll($sql3);




			   foreach ($rows3 as $value3) {


				$bpil = $bpil + $value3["qotd"];

				 $green = $green + 1;

				 $qrt = explode(".",$value3["qotd"]);

			   ?>

			    <tr>
				<td><?php echo $green; ?></td>
				<td><?php echo $value3["name"]; ?></td>
				<td><?php echo $qrt[0]; ?></td>
				</tr>

			   <?php
			   }
			   ?>

			   <tr>

				<td colspan=3 align="right" style="text-align:right; padding-right:54px;"> Total : <?php echo $bpil; ?></td>
				</tr>


	  </table>

	  <br/>


	   Date :- <?php  echo $opdate; ?> &nbsp;&nbsp;&nbsp;&nbsp; Product Type :- BAKERY
	  <table border=1 cellpadding="5" cellspacing="5" >

			   <tr>
			   <th >Sr.</th>
			   <th >Product Name</th>
			   <th>Qty. Order</th>

			   </tr>

	  <?php

			    $sql3 = "SELECT mei.value,msi.product_id,SUM(msi.qty_ordered) as qotd,msi.name,msi.sku FROM `mg_sales_flat_order_item` msi
			    left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251
				left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
				left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
				where msw.`window` LIKE '%".$_GET["d"]."' AND mei.value=141 group by msi.sku";
			    $rows3 = $connection->fetchAll($sql3);


			    $bpil = 0;

			   foreach ($rows3 as $value3) {


				$bpil = $bpil + $value3["qotd"];

				 $green = $green + 1;

				 $qrt = explode(".",$value3["qotd"]);

			   ?>

			    <tr>
				<td><?php echo $green; ?></td>
				<td><?php echo $value3["name"]; ?></td>
				<td><?php echo $qrt[0]; ?></td>
				</tr>

			   <?php
			   }
			   ?>

			   <tr>

				<td colspan=3 align="right" style="text-align:right; padding-right:54px;"> Total : <?php echo $bpil; ?></td>
				</tr>



	  </table>

	  <br/>


	  Date :- <?php  echo $opdate; ?> &nbsp;&nbsp;&nbsp;&nbsp; Product Type :- Sea Food
	  <table border=1 cellpadding="5" cellspacing="5" >

			   <tr>
			   <th >Sr.</th>
			   <th >Product Name</th>
			   <th>Qty. Order</th>

			   </tr>

	  <?php

			    $sql3 = "SELECT mei.value,msi.product_id,SUM(msi.qty_ordered) as qotd,msi.name,msi.sku FROM `mg_sales_flat_order_item` msi
			    left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251
				left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
				left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
				where msw.`window` LIKE '%".$_GET["d"]."' AND mei.value=145 group by msi.sku";
			    $rows3 = $connection->fetchAll($sql3);

			   $bpil = 0;


			   foreach ($rows3 as $value3) {


				$bpil = $bpil + $value3["qotd"];

				 $green = $green + 1;

				 $qrt = explode(".",$value3["qotd"]);

			   ?>

			    <tr>
				<td><?php echo $green; ?></td>
				<td><?php echo $value3["name"]; ?></td>
				<td><?php echo $qrt[0]; ?></td>
				</tr>

			   <?php
			   }
			   ?>

			   <tr>

				<td colspan=3 align="right" style="text-align:right; padding-right:54px;"> Total : <?php echo $bpil; ?></td>
				</tr>


	  </table>



	  <br/>


	  Date :- <?php  echo $opdate; ?> &nbsp;&nbsp;&nbsp;&nbsp; Product Type :- Deli
	  <table border=1 cellpadding="5" cellspacing="5" >

			   <tr>
			   <th >Sr.</th>
			   <th >Product Name</th>
			   <th>Qty. Order</th>

			   </tr>

	  <?php

			    $sql3 = "SELECT mei.value,msi.product_id,SUM(msi.qty_ordered) as qotd,msi.name,msi.sku FROM `mg_sales_flat_order_item` msi
			    left join mg_catalog_product_entity_int mei on msi.product_id = mei.entity_id and mei.attribute_id =  251
				left join mg_sales_flat_order_grid mog on msi.`order_id` = mog.`entity_id`
				left join mg_shipping_delivery_window msw on mog.`increment_id` = msw.`order_number`
				where msw.`window` LIKE '%".$_GET["d"]."' AND mei.value=144 group by msi.sku";
			    $rows3 = $connection->fetchAll($sql3);

			   $bpil = 0;


			   foreach ($rows3 as $value3) {


				$bpil = $bpil + $value3["qotd"];

				 $green = $green + 1;

				 $qrt = explode(".",$value3["qotd"]);

			   ?>

			    <tr>
				<td><?php echo $green; ?></td>
				<td><?php echo $value3["name"]; ?></td>
				<td><?php echo $qrt[0]; ?></td>
				</tr>

			   <?php
			   }
			   ?>

			   <tr>

				<td colspan=3 align="right" style="text-align:right; padding-right:54px;"> Total : <?php echo $bpil; ?></td>
				</tr>


	  </table>





<?php
	  exit(0);
}



if($_GET["hiren"]==2)
{
$connection = Mage::getSingleton('core/resource')->getConnection('core_write');
 /*  $sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` WHERE `value` = 'DS: Deli/Meals & Sides Etc' or `value` = 'DA: Bakery/Pitas & Tortillas & Wraps' or `value` = 'DA: Bakery/Pitas & Tortillas & Wraps' or `value` = 'DA: Dairy/Cottage Cheese' or `value` = 'DA: Dairy/Cream Cheese'  or `value` = 'DA: Dairy/Eggs and Egg Substitutes' or `value` = 'DA: Dairy/Milk and Cream' or `value` = 'DA: Dairy/Packaged Cheese' or `value` = 'DA: Dairy/Refrigerated Doughs' or `value` = 'DA: Dairy/Sour Cream' or `value` = 'DA: Dairy/Yogurt' or `value` = 'DA: Grocery/Beverages/Juice' or `value` = 'DA: Grocery/Snacks/Dips & Spreads & Salsa' or `value` = 'Dairy' or `value` = 'Dairy/Cheese' or `value` = 'DS: Dairy/Packaged Cheese' or `value` = 'DS: Deli/Meals & Sides Etc' or `value` = 'PM: Deli/Lunch Packs' or `value` = 'PM: Deli/Pre-packaged Meat' or `value` = 'PM: Meat & Seafood/Bacon' or `value` = 'PM: Meat & Seafood/Hot Dogs & Sausages' or `value` = 'PM: Meat & Seafood/Turkey' or `value` = 'PC: Canned Goods & Soups/Canned Fruit' or `value` = 'PC: Grocery/Beverages/Juice' or `value` = 'PC: Produce/Fresh Herbs' or `value` = 'PC: Produce/Fruit' or `value` = 'PC: Produce/Vegetables' or `value` = 'PC: Produce/Vegetarian' or `value` = 'Dairy/Milk and Cream' or `value` = 'DA: Grocery/Beverages/Teas' or `value` = 'DA: Bakery/English Muffins' or `value` = 'PC: Grocery/Snacks/Dips & Spreads & Salsa' or `value` = 'PC: Grocery/Condiments/Salad Dressing & Tossing' or `value` = 'DA: Dairy/Whipped Toppings' or `value` = 'PC: Grocery/Canned Goods & Soups/Canned Vegetables' or `value` = 'PM: Deli/Meals & Sides Etc' or `value` = 'PC: Dairy/Eggs and Egg Substitutes' or `value` = 'DS: Grocery/Snacks/Dips & Spreads & Salsa' or `value` = 'PM: Meat & Seafood/Chicken' or `value` = 'DC: Deli/Cheese' or `value` = 'PC: Grocery/Condiments/Condiments & Sandwich Spreads'  or `value` = 'PM: Meat & Seafood/Pork' or `value` = 'PM: Frozen/Breakfast Foods' or `value` = 'DA: Grocery/Snacks/Ready to Eat Pudding & Gelatin'  or `value` = 'PM: Meat&Seafood/Hot Dogs & Sausages'  or `value` = 'PC: Produce/Fresh Vegetables' or `value` = 'PC: Grocery/Cooking Needs/Pie Crusts & Pastry Dough' or `value` = 'PC: Produce/Fresh Vegetables' or `value` = 'PM: Meat & Seafood/Jerky & Meat Snacks' or `value` = 'DA: Deli/Meals & Sides Etc' or `value` = 'PC: Meat & Seafood/Meat Alternatives' or `value` = 'PM: Meat&Seafood/Jerky & Meat Snacks' or `value` = 'PM: Meat&Seafood/Chicken' or `value` = 'DA: Meat & Seafood/Beef' or `value` = 'PC: Grocery/Cooking Needs/Extracts & Flavorings' or `value` = 'PC: Grocery/Beverages/Meal Replacement & Nutrition/Sports Drinks' or `value` = 'DS: Grocery/Beverages/Teas' or `value` = 'DS: Meat & Seafood/Jerky & Meat Snacks' or `value` = 'PM: Meat & Seafood/Meat Alternatives'  or `value` = 'DS: Dairy/Butter and Margarine'   ORDER BY `mg_catalog_product_entity_varchar`.`entity_id` ASC";





 $sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` WHERE `value` = 'CM: Meat & Seafood/Beef' or `value` = 'CM: Meat & Seafood/Chicken' or `value` = 'CM: Meat & Seafood/Lamb' or `value` = 'CM: Meat & Seafood/Pork' or `value` = 'CM: Meat & Seafood/Turkey' or `value` = 'CM: Meat & Seafood/Veal' or `value` = 'CM: Meat & Seafood' or `value` = 'Cut Meat' or `value` = 'CUT MEAT' or `value` = 'CM: Meat&Seafood'";


 $sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` WHERE `value` = 'DC: Deli/Deli Salads' or `value` = 'DC: Deli/Sandwiches' or `value` = 'DC: Deli/Sliced Meat' or `value` = 'Deli' or `value` = 'Deli Grab N Go' or `value` = 'DC: Deli/Meals & Sides Etc' "; */


/* $sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` WHERE `value` = '1: Dairy/Milk and Cream' or `value` = '1: Grocery/Beverages/Juice' or `value` = '1: Grocery/Beverages/Cocoa & Milk Mixers' or `value` = '1: Grocery/Beverages/Coffee' or `value` = '1: Grocery/Beverages/Drink Mixes' or `value` = '1: Grocery/Beverages/Drink Mixes' or `value` = '2: Grocery/Condiments/Pickles & Peppers & Relish' or `value` = '1: Grocery/Beverages/Teas' or `value` = '2: Grocery/Condiments/Sauces & Marinades' or `value` = '2: Grocery/Condiments/Syrup' or `value` = '1: Grocery/Breakfast & Cereal/Cereal' or `value` = '1: Grocery/Breakfast & Cereal/Pancake & Waffle Mixes' or `value` = '1: Grocery/Breakfast & Cereal/Toaster Pastries' or `value` = '1: Grocery/Snacks/Fruit Snacks & Dried Fruit' or `value` = '1: Grocery/Snacks/Snack Bars' or `value` = '2: Grocery/Snacks/Ready to Eat Pudding & Gelatin' or `value` = '3: Bakery/Pitas & Tortillas & Wraps' or `value` = '3: Canned Goods & Soups/Canned & Dried Tomatoes' or `value` = '2: Grocery/Condiments/Condiments & Sandwich Spreads' or `value` = '3: Canned Goods & Soups/Canned Fruit' or `value` = '2: Grocery/Condiments/Olives/Capers' or `value` = '3: Canned Goods & Soups/Canned Vegetables' or `value` = '3: Canned Goods & Soups/Ready to Eat Meals' or `value` = '2: Grocery/Condiments/Salad Dressing & Tossing' or `value` = '2: Grocery/Cooking Needs/Baking Mixes' or `value` = '2: Grocery/Cooking Needs/Baking Morsels & Bars & Cocoa' or `value` = '2: Grocery/Cooking Needs/Baking Soda & Powder & Starch' or `value` = '2: Grocery/Cooking Needs/Cooking Oils & Sprays' or `value` = '2: Grocery/Cooking Needs/Flour & Meal' or `value` = '2: Grocery/Cooking Needs/Herbs' or `value` = ' Spices' or `value` = ' Seasonings' or `value` = '2: Grocery/Cooking Needs/Sugar & Sweeteners' or `value` = '3: Canned Goods & Soups/Canned Beans' or `value` = '3: Canned Goods & Soups/Canned Meat & Poultry' or `value` = '4: Health & Wellness/Health & Beauty/Hair' or `value` = '4: Health & Wellness/Health & Beauty/Medicine' or `value` = '4: Health & Wellness/Health & Beauty/Oral Care' or `value` = '3: Canned Goods & Soups/Canned Seafood' or `value` = '3: Canned Goods & Soups/Soup' or `value` = '3: Grocery/Canned Goods & Soups/Canned & Dried Tomatoes' or `value` = '3: Grocery/Condiments/Jams & Jellies & Spreads' or `value` = '3: Grocery/Condiments/Pasta Sauce' or `value` = '3: Grocery/Grains Pasta Beans/Boxed Dinners & Sides' or `value` = '3: Grocery/Grains Pasta Beans/Boxed Dinners & Sides' or `value` = '3: Grocery/Grains Pasta Beans/Boxed Dinners & Sides' or `value` = '3: Grocery/Grains Pasta Beans/Mac & Cheese' or `value` = '3: Grocery/Grains Pasta Beans/Pasta & Noodles' or `value` = '3: Grocery/Grains Pasta Beans/Rice & Rice Mixes' or `value` = '3: Grocery/Snacks/Nuts Seeds Granola & Trail Mixes' or `value` = '3: Pasta' or `value` = '4: Grocery/Beverages/Meal Replacement & Nutrition/Sports Drinks' or `value` = '4: Grocery/Snacks/Snack Bars' or `value` = '4: Health & Wellness/Baby & Childcare/Diapers & Wipes' or `value` = '4: Health & Wellness/Baby & Childcare/Formula' or `value` = '4: Health & Wellness/Health & Beauty/Bath Soap' or `value` = '4: Health & Wellness/Health & Beauty/Deodorant' or `value` = '4: Health & Wellness/Laundry &Cleaning/Food Storage & Wraps' or `value` = '4: Health & Wellness/Laundry &Cleaning/Paper Products' or `value` = '5: Health & Wellness/Laundry &Cleaning/Tableware' or `value` = '4: Health & Wellness/Laundry &Cleaning/Trash Bags' or `value` = '4: Office & Home/Electrical Hardware Adhesives' or `value` = '4: Office & Home/Electrical Hardware Adhesives' or `value` = '4: Office & Home/Electrical Hardware Adhesives' or `value` = '4: Office & Home/Office School Art Supplies' or `value` = '5: Health & Wellness/Laundry &Cleaning/Air Fresheners' or `value` = '5: Health & Wellness/Laundry &Cleaning/Dishwashing' or `value` = '5: Health & Wellness/Laundry &Cleaning/Household Cleaners' or `value` = '5: Health & Wellness/Laundry &Cleaning/Laundry' or `value` = '5: Pet' or `value` = '6: Grocery/Beverages/Cocoa & Milk Mixers' or `value` = '6: Grocery/Beverages/Drink Mixes' or `value` = '6: Grocery/Beverages/Meal Replacement & Nutrition/Sports Drinks' or `value` = '6: Grocery/Beverages/Soda & Tonic' or `value` = '6: Grocery/Beverages/Teas' or `value` = '6: Grocery/Beverages/Water' or `value` = '6: Grocery/Snacks/Candy & Gum' or `value` = '6: Grocery/Snacks/Chips' or `value` = '6: Grocery/Snacks/Nuts Seeds Granola & Trail Mixes' or `value` = '6: Grocery/Snacks/Popcorn' or `value` = '6: Grocery/Snacks/Pretzels' or `value` = '6: Soda' or `value` = '7: Bakery/Bagels' or `value` = '7: Bakery/Bread (Bakery or Packaged)' or `value` = '7: Bakery/English Muffins' or `value` = '7: Bakery/Rolls and Buns' or `value` = '7: Grocery/Condiments/Jams & Jellies & Spreads' or `value` = '7: Grocery/Condiments/Nut & Seed Butters' or `value` = '7: Grocery/Condiments/Peanut Butter' or `value` = '7: Grocery/Cooking Needs/Herbs' or `value` = ' Spices' or `value` = ' Seasonings' or `value` = '7: Grocery/Snacks/Cookies' or `value` = '7: Grocery/Snacks/Crackers' or `value` = '7: Grocery/Snacks/Nuts Seeds Granola & Trail Mixes' or `value` = '7: Grocery/Snacks/Snack Cakes & Desserts' or `value` = 'BA: Bakery/Pitas & Tortillas & Wraps' or `value` = 'DA: Bakery/Desserts' or `value` = 'PD: Bulk Nuts' or `value` = 'PD: Canned Goods & Soups/Canned Fruit' or `value` = 'PD: Dried Fruit' or `value` = 'PD: Grocery/Condiments/Peanut Butter' or `value` = 'PD: Produce/Fruit' or `value` = 'PD: Produce/Vegetables' or `value` = '7: Bakery/Desserts' or `value` = '7: Bakery/Desserts' or `value` = '7: Bakery/Desserts' or `value` = 'PD: Produce/Fresh Vegetables' or `value` = '7: Grocery/Snacks/Pretzels' or `value` = '7: Bakery/Pitas & Tortillas & Wraps' or `value` = '2: Herbs' or `value` = ' Spices & Seasonings' or `value` = '2: Grocery/Cooking Needs/Yeast' or `value` = '2: Grocery/Cooking Needs/Pie & Pastry Filling' or `value` = '3: Grocery/Grains Pasta Beans/Dried Beans' or `value` = '2: Grocery/Cooking Needs/Pie & Pastry Filling' or `value` = 'PD: Grocery/Cooking Needs/Pie & Pastry Filling' or `value` = '3: Grocery/Grains Pasta Beans/Potato Mixes' or `value` = '6: Grocery/Beverages/Coffee' or `value` = 'PD: Grocery/Snacks/Candy & Gum' or `value` = '4: Health & Wellness/Health & Beauty/Vitamins & Supplements' or `value` = 'PD: Grocery/Snacks/Fruit Snacks & Dried Fruit' or `value` = '5: Grocery/Pet' or `value` = 'PD: Grocery/Snacks/Crackers' or `value` = '6: Grocery/Beverages/Juice' or `value` = 'PD: Grocery/Snacks/Nuts Seeds Granola & Trail Mixes' or `value` = '3: Grocery/Canned Goods & Soups/Canned Fruit' or `value` = '2: Grocery/Condiments/Honey' or `value` = '4: Health & Wellness/Baby & Childcare/Baby Food' or `value` = '4: Health & Wellness/Health & Beauty/Feminine' or `value` = '5: Health & Wellness/Laundry &Cleaning/Paper Products' or `value` = '1: Grocery/Snacks/Nuts Seeds Granola & Trail Mixes' or `value` = 'PD: Grocery/Condiments/Salad Dressing & Tossing' or `value` = '3: Grocery/Grains Pasta Beans/Pasta Mixes & Sides' or `value` = '2: Grocery/Condiments/Gravy' or `value` = '3: Canned' or `value` = '5: Health & Wellness/Laundry &Cleaning/Paper Products' or `value` = '4: Health & Wellness/Health & Beauty/Shaving' or `value` = '4: Health & Wellness/Health & Beauty/Skin Care' or `value` = '3: Grocery/Snacks/Dips & Spreads & Salsa' or `value` = 'PD: Grocery/Snacks/Chips' or `value` = '2: Grocery/Cooking Needs/Marshmallows' or `value` = '4: Health & Wellness/Laundry &Cleaning/Tableware' or `value` = '4: Health & Wellness/Laundry &Cleaning/Tableware' or `value` = '7: Grocery/Cooking Needs/Sugar & Sweeteners' or `value` = '3: Grocery/Condiments/Sauces & Marinades' or `value` = '5: Office & Home/Fire Logs' or `value` = '2: Flour & Meal' or `value` = '3: Grocery/Snacks/Fruit Snacks & Dried Fruit' or `value` = '2: Grocery/Cooking Needs/Canned & Powdered Milk' or `value` = '9: Bakery/Bread (Bakery or Packaged)' or `value` = '7: Grocery/Snacks/Ice Cream Cones & Toppings' or `value` = '6: Grocery/Snacks/Snack Cakes & Desserts' or `value` = '7: Bakery/Pizza Crust' or `value` = '5: Bakery/Rolls and Buns' or `value` = '1: Grocery/Grains Pasta Beans/Grains' or `value` = 'PD: Grocery/Cooking Needs/Baking Mixes' or `value` = '4: Health & Wellness/Health & Beauty/First Aid' or `value` = '5: Health & Wellness/Laundry &Cleaning/Cleaning Equipment' or `value` = '5: Health & Wellness/Laundry &Cleaning' or `value` = '3: Grocery/Canned Goods & Soups/Canned Beans' or `value` = '2: Grocery/Grains Pasta Beans/Potato Mixes' or `value` = '7: Grocery/Condiments/Honey' or `value` = 'PD: Grocery/Beverages/Drink Mixes' or `value` = '2: Grocery/Cooking Needs/Cooking Wine & Vinegar' or `value` = 'PD: Grocery/Snacks/Popcorn' or `value` = '2: Dressings' or `value` = '2: Grocery/Cooking Needs/Frosting & Decorations' or `value` = 'Crackers' or `value` = '1: Health & Wellness/Laundry &Cleaning/Paper Products' or `value` = '2: Grocery/Canned Goods & Soups/Canned Vegetables' or `value` = '2: Grocery/Cooking Needs/Extracts & Flavorings' or `value` = '7: Grocery/Snacks/Candy & Gum' or `value` = '2: Grocery/Cooking Needs/Pie Crusts & Pastry Dough' or `value` = '6: Grocery/Breakfast & Cereal/Cereal' or `value` = '4: Office & Home/Kitchen Accessories' or `value` = '3:Rice & Rice Mixes' or `value` = '7: Grocery/Snacks/Chips' or `value` = '2: Canned Goods & Soups/Canned Vegetables' or `value` = '2: Canned Goods & Soups/Canned Fruit' or `value` = '2: Grocery/Breakfast & Cereal/Pancake & Waffle Mix' or `value` = 'PD: Grocery/Grains Pasta Beans/Pasta Mixes & Sides' or `value` = '3: Grocery/Condiments/Condiments & Sandwich Spreads' or `value` = '5: Office & Home/Pest Control' or `value` = '2: Grocery/Cooking Needs/Pudding & Gelatin Mix' or `value` = '2: Grocery/Snacks/Nuts Seeds Granola & Trail Mixes' or `value` = '3: Grocery/Condiments/Pickles & Peppers & Relish' or `value` = '6: Bakery/Rolls and Buns' or `value` = '4 Grocery/Snacks/Snack Bars' or `value` = '5: Office & Home/Electrical Hardware Adhesives' or `value` = '6: Grocery/Snacks/Dips & Spreads & Salsa' or `value` = 'BA:' or `value` = '1: Canned Goods & Soups/Canned Fruit' or `value` = 'DS: Grocery/Beverages/Meal Replacement & Nutrition/Sports Drinks' or `value` = '2: Grocery/Breakfast & Cereal/Pancake & Waffle Mixes' or `value` = '0: Grocery/Snacks/Chips' or `value` = '6: Grocery/Snacks/Crackers' or `value` = '7: Grocery/' or `value` = '1:Cereal' or `value` = '7: Grocery/Grains Pasta Beans/Boxed Dinners & Sides' or `value` = '1:00' or `value` = '3: Frozen/Frozen Vegetables' or `value` = 'PD: Produce/Fresh Fruit' or `value` = '4: Grocery/Beverages/Meal Replacement & Nutrition' or `value` = '2: Grocery/Beverages/Cocoa & Milk Mixers' or `value` = '5: Grocery/Snacks' or `value` = '0: Grocery/Beverages/Coffee' group by entity_id";


$sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` WHERE `value` = '8: Bakery/Bagels' or `value` = '8: Bakery/Bread (Bakery or Packaged)' or `value` = '8: Frozen/Appetizers & Snacks' or `value` = '8: Frozen/Breakfast Foods' or `value` = '8: Frozen/Desserts & Bakery' or `value` = '8: Frozen/Frozen Fruit' or `value` = '8: Frozen/Ice Cream & Novelties' or `value` = '8: Frozen/Pizza' or `value` = '8: Meat & Seafood/Hot Dogs & Sausages' or `value` = '9: Frozen/Frozen Vegetables' or `value` = '9: Frozen/Meals & Entrees' or `value` = 'PM: Meat & Seafood/Beef' or `value` = 'SC: Meat & Seafood/Seafood' or `value` = '9: Meat and Seafood/Seafood' or `value` = 'PM: Frozen/Frozen Vegetables' or `value` = '8: Frozen/Frozen Beverages' or `value` = '8: Bakery/Rolls and Buns' or `value` = '8: Frozen/Frozen Vegetables' or `value` = '9: Meat & Seafood/Beef' or `value` = 'FM: Frozen/Breakfast Foods' or `value` = 'FM: Meat&Seafood/Chicken' or `value` = '8: Grocery/Grains Pasta Beans/Pasta & Noodles' or `value` = 'FM: Meat & Seafood/Chicken' or `value` = '9: Meat & Seafood/Meat Alternatives' or `value` = '9: Meat & Seafood/Meat Alternatives' or `value` = '9: Grocery/Grains Pasta Beans/Pasta & Noodles' or `value` = '9: Meat & Seafood/Chicken' or `value` = '9: Meat & Seafood/Seafood' or `value` = '9: Bakery/Pitas & Tortillas & Wraps' or `value` = 'FM: Meat & Seafood/Turkey' or `value` = '9: Meat & Seafood/Hot Dogs & Sausages' or `value` = '9: Meat & Seafood/Bacon' or `value` = '9: Meat & Seafood/Lamb' or `value` = '9: Frozen/Appetizers & Snacks' or `value` = '8: Frozen/Meals & Entrees' or `value` = '9: Meat & Seafood/Turkey' "; */


 // $sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` WHERE `value` = 'SF' or `value` = 'SF: Meat & Seafood/Seafood' ";


 // $sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` where `attribute_id` = 203  ";


 $sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` WHERE `value` = '3: Bakery/Pitas & Tortillas & Wraps' or `value` = '3: Canned Goods & Soups/Canned & Dried Tomatoes' or `value` = '3: Canned Goods & Soups/Canned Fruit' or `value` = '3: Canned Goods & Soups/Canned Vegetables' or `value` = '3: Canned Goods & Soups/Ready to Eat Meals' or `value` = '3: Canned Goods & Soups/Canned Beans' or `value` = '3: Canned Goods & Soups/Canned Meat & Poultry' or `value` = '3: Canned Goods & Soups/Canned Seafood' or `value` = '3: Canned Goods & Soups/Soup' or `value` = '3: Grocery/Canned Goods & Soups/Canned & Dried Tomatoes' or `value` = '3: Grocery/Condiments/Jams & Jellies & Spreads' or `value` = '3: Grocery/Condiments/Pasta Sauce' or `value` = '3: Grocery/Grains Pasta Beans/Boxed Dinners & Sides' or `value` = '3: Grocery/Grains Pasta Beans/Boxed Dinners & Sides' or `value` = '3: Grocery/Grains Pasta Beans/Mac & Cheese' or `value` = '3: Grocery/Grains Pasta Beans/Pasta & Noodles' or `value` = '3: Grocery/Grains Pasta Beans/Rice & Rice Mixes' or `value` = '3: Grocery/Snacks/Nuts Seeds Granola & Trail Mixes' or `value` = '3: Pasta' or `value` = '3: Grocery/Grains Pasta Beans/Dried Beans' or `value` = '3: Grocery/Grains Pasta Beans/Potato Mixes' or `value` = '3: Grocery/Canned Goods & Soups/Canned Fruit' or `value` = '3: Grocery/Grains Pasta Beans/Pasta Mixes & Sides' or `value` = '3: Canned' or `value` = '3: Grocery/Snacks/Dips & Spreads & Salsa'   or `value` = '3: Grocery/Condiments/Sauces & Marinades' or `value` = '3: Grocery/Snacks/Fruit Snacks & Dried Fruit' or `value` = '7: Bakery/Pizza Crust' or `value` = '3: Grocery/Cooking Needs/Herbs, Spices, Seasonings' or `value` = '3: Grocery/Canned Goods & Soups/Canned Beans' or `value` = '3: Rice & Rice Mixes' or `value` = '3: Grocery/Condiments/Condiments & Sandwich Spreads' or `value` = '3: Frozen/Frozen Vegetables'";


//


//$sql        = "SELECT entity_id FROM `mg_catalog_product_entity_varchar` WHERE `value` = 'SF' or `value` = 'SF: Meat & Seafood/Seafood';


$sql   = "SELECT entity_id,value FROM `mg_catalog_product_entity_varchar` where `attribute_id` = 203  ";



$rows = $connection->fetchAll($sql); //fetchRow($sql), fetchOne($sql),...
//print_r($rows);
    $count = 0;
	foreach ($rows as $value) {

		/* // $check = 0;
		// $rows2 = 0;
		// $sql2        = "SELECT newru FROM `mg_mapping` WHERE `v_proid` = '".$value["value"]."'";
		// $rows2 = $connection->fetchOne($sql2);


		// echo $rows2;

		 // $query = "update `mg_catalog_product_entity_int` set `value` = '".$rows2."' where `entity_id` = ".$value["entity_id"]." and `attribute_id` = 253";
		 // $connection->query($query);
		  // echo $value["entity_id"]."<br/>"; */


		   $sql2        = "SELECT value_id FROM `mg_catalog_product_entity_int` WHERE `attribute_id` = 251 and `entity_id` = ".$value["entity_id"]." and value is NULL  ";
		   $rows2 = $connection->fetchOne($sql2);

		   if($rows2 > 0 )
		   {

			   //$count = $count + 1;
			   echo $value["entity_id"]."  -  ".$value["value"];
			   echo "<br/>";
		   }

	}


	echo $count;
	exit(0);

}



  $currentUrl = Mage::helper('core/url')->getCurrentUrl();
  if($currentUrl=='http://www.prestofreshgrocery.com/work' || $currentUrl=='http://www.prestofreshgrocery.com/savetime/' ||  $currentUrl=='http://www.prestofreshgrocery.com/saveefforts/' || $currentUrl=='http://www.prestofreshgrocery.com/qualityproduct/' )
  {
?>

    <style type="text/css">

	.calendar { z-index:9999}
	.right-columns
	{
	   display:none;
	}

	</style>

<?php

  }


       $resource = Mage::getSingleton('core/resource');
	   $writeConnection = $resource->getConnection('core_write');
	   $table = $resource->getTableName('sales_flat_quote');
	   //$table2 = $resource->getTableName('sales_flat_quote_address');
	   //$table3 = $resource->getTableName('sales_flat_quote_item');

	     $query = "delete from {$table} WHERE items_count = 0";
		 $writeConnection->query($query);


		$query = "delete from {$table} WHERE is_active = 0";
		$writeConnection->query($query);


		 $query = "update {$table} set trigger_recollect=0,created_at=updated_at";
		$writeConnection->query($query);

?>
<script type="text/javascript" src="https://www.prestofreshgrocery.com/newstaging/skin/frontend/default/theme509/js/webandpeople/custommenu/webtoolkit.base64.js"></script>
<script type="text/javascript" src="https://www.prestofreshgrocery.com/newstaging/skin/frontend/default/theme509/js/webandpeople/custommenu/custommenu.js"></script>

<link rel="stylesheet" type="text/css" href="https://www.prestofreshgrocery.com/skin/frontend/default/theme509/css/webandpeople/custommenu/custommenu.css?v=1409721410" media="all" >
<style type="text/css">
.catalog-product-view .block-banner{ display:none}
.rewardpoints-index-transactions .page-title {padding-top: 20px;}
.prestopremier{ width:70%}
</style>

<?php if($this->helper('customer')->isLoggedIn() ) {

 $action = Mage::app()->getFrontController()->getRequest()->getActionName();
if($action =='success' || $action =='index' || $action =='view'){
?>

<style>
.nav-container
{
  margin-top:-36px;
}

@media only screen and (max-width: 767px) {
        .nav-container
		{
		  margin-top:-22px !important;
		}
		.blockhiren
		{
		   margin-top:4px !important;
		}
}
</style>

<?php } else{ ?>
	<style>
.nav-container
{
  margin-top:-26px;
}

@media only screen and (max-width: 767px) {
        .nav-container
		{
		  margin-top:-22px !important;
		}
		.blockhiren
		{
		   margin-top:4px !important;
		}
}
</style>

<?php
} } else { ?>

<style>
.nav-container
{
  margin-top:-26px;
}
</style>

 <?php } ?>
 </div>
  <style>
  @media only screen and (min-width: 1320px) and (max-width: 2200px) {
	.blockhiren { display:none; }
}
  </style>
<div class="header-container-top"  id="header-top">
    <div class="container">
        <div class="row">
            <div class="span12">
                <div class="header" id="header">
                    <div class="quick-access">
                            <div class="header-links">

                                <?php echo $this->getChildHtml('topLinks') ?>
                                <ul class="links" style="float: right;">
                                	<li><a  href="<?php echo $this->getUrl('checkout/cart')?>" title="Add to Cart" >My Cart</a></li>
									<?php if($this->helper('customer')->isLoggedIn()){ }else{?>
                                    	<li><a href="<?php echo $this->getUrl('customer/account/create/')?>" title="Register">Register (Free)</a></li>
                                    <?php } ?>
                                </ul>

                                 <?php echo $this->getChildHtml('topLinksLeft') ?>

                            </div>
                        </div>
	<!--Welcome Msg on headder Loggedin - without loggedin----->
					<div id="welcome_header" >
					 <?php if(!$this->helper('customer')->isLoggedIn()){?>
	                     <p class="welcome-msg"  ><?php echo   "Welcome to Northeast Ohio's Own PrestoFresh Grocery! Serving the Greater Cleveland metro area!" ?> <?php echo $this->getAdditionalHtml() ?></p>
                     <?php }
					 else{  ?>
					<?php
                    $customer_id=  Mage::helper('customer')->getCustomer()->getData('entity_id');
                    $customer = Mage::getModel('customer/customer')->load($customer_id);
                    $customer_code = $customer['group_id'];//$customer->getCustomerGroupId();
                    $group_data = Mage::getModel('customer/group')->load($customer_code);?>
                    <p class="welcome-msg" id="<?php echo $group_data['customer_group_image'] ?>" ><?php echo  $this->getWelcome() ?>
                    <?php if($group_data['customer_group_image'] != '0' && $group_data['customer_group_image'] != '') {?> <img style="margin-top: -8px;" width="40" height="40" src="<?php echo $this->getBaseUrl() . 'media/'.$group_data['customer_group_image'];?> " /><?php } ?>
                    <?php echo $this->getAdditionalHtml() ?>
					&nbsp;<img src="<?php echo $this->getSkinUrl('images/point.png'); ?>"><?php   echo  Mage::helper('rewardpoints/customer')->getBalanceFormated();?></p>
                     <?php
					$customerid = Mage::helper('customer')->getCustomer()->getData('entity_id');
					$order = $this->getOrders();
					$_customer = Mage::getModel('customer/customer');
					$orders = Mage::getModel("sales/order")->getCollection()
                            ->addAttributeToSelect('*')
                            ->addFieldToFilter(customer_id, $customerid)
							->addAttributeToSort('created_at');

						foreach($orders as $order){
							$order->load(Mage::getSingleton('sales/order')->getLastOrderId());
							$last_orderid = $order->getEntityId();
								$list = explode(',',$last_orderid);
								$lastorderid = implode(',',$list);
								//$last = max($last_orderid);
						}
                        if($lastorderid != ''){
						?>

                     <div class="reorderlink">
                     <b><i>Quickly reorder previously ordered items from your My Account page!</i></b>
                     <p class="blick">Simply click 'reorder' next to a prior order, and all of those items will be added to your cart</p>
                     </div>
					 </div>
                     <?php } ?>
                     <?php } ?>

  <!--Welcome msg -End----->
                    <div class="header-buttons">
                    	<div class="header-logo">
                        	 <h1  id="fixedlogo"><strong><?php //echo $this->getLogoAlt() ?></strong><a href="<?php echo $this->getUrl('') ?>" title="<?php echo $this->getLogoAlt() ?>">
							 <img id="logo_img" src="<?php echo $this->getSkinUrl()//echo $this->getLogoSrc() ?>images/fixed-logo.png" alt="<?php echo $this->getLogoAlt() ?>" /></a></h1>
                        </div>

                        <div class="header-button top-login">
                            <?php echo $this->getChildHtml('topLinksLeft') ?>
                        </div>
						<div class="header-checkout" style="display:none;">
						<ul style="display:block !important">
							<?php
								if(!Mage::getSingleton('customer/session')->isLoggedIn())
								{
									?>
									<li><a class="ajaxlogin-login" title="Log In" href="<?php echo Mage::getUrl('customer/account/login'); ?>">Log In</a></li>
									<?php
								}
								else
								{
									?>
									<li><a class="Logout_link" title="Log In" href="<?php echo Mage::getUrl('customer/account/logout') ?>">Log Out</a></li>
									<?php
								}
							?>
    						<li style="display:inline;"><a href="<?php echo Mage::getUrl('customer/account'); ?>">My Account</a></li>
							<li style="display:inline;"><a href="<?php echo Mage::helper('checkout/url')->getCheckoutUrl(); ?>"> Checkout </a></li>
						</ul>
						</div>
                        <div class="header-button menu-list">
                            <a href="#"></a>
                            <?php echo $this->getChildHtml('topLinks') ?>
                        </div>
                        <?php echo $this->getChildHtml('currency') ?>
                        <?php //echo $this->getChildHtml('store_language') ?>
                    </div>
                </div>
            </div>
        </div>
        <div class="clear"></div>
    </div>
</div>

<div class="blockhiren"><a href="<?php echo $this->getUrl('') ?>" title="<?php echo $this->getLogoAlt() ?>" ><img id="logo_img" src="http://www.prestofreshgrocery.com/skin/frontend/default/theme509/images/mobilelogo.png" alt="<?php echo $this->getLogoAlt() ?>" height=55 /><sup style="color: #000;font-size:8px;vertical-align: bottom;font-weight:bold;">SM</sup></a></div>

<?php echo $this->getChildHtml('topMenu') ?>
<div class="header-container"  id="header-middle" >
	<div class="container">
		<div class="row">
			<div class="span12">
                <div class="header" id="header">
                    <div class="clear"></div>
                    <?php if ($this->getIsHomePage()):?>
                    <p class="logo" style="text-align:left;"><strong><?php echo $this->getLogoAlt() ?></strong><a href="<?php echo $this->getUrl('') ?>" title="<?php echo $this->getLogoAlt() ?>" class="logo"><img id="logo_img" height=73 src="<?php echo $this->getSkinUrl()//echo $this->getLogoSrc() ?>images/logo.png" alt="<?php echo $this->getLogoAlt() ?>" /><sup style="color: #fff;font-size: 12px;vertical-align: bottom;">SM</sup></a></p>
                    <?php else:?>
                    <p class="logo" style="text-align:left;"><strong><?php echo $this->getLogoAlt() ?></strong><a href="<?php echo $this->getUrl('') ?>" title="<?php echo $this->getLogoAlt() ?>" class="logo"><img src="<?php echo $this->getSkinUrl()//echo $this->getLogoSrc() ?>images/logo.png" height=73 alt="<?php echo $this->getLogoAlt() ?>" /><sup style="color: #fff;font-size: 12px;vertical-align: bottom;">SM</sup></a></p>
                    <?php endif?>
                   <!-- Free delivery Subscription -->
<?php Mage::getSingleton("core/session", array("name" => "frontend"));
// get the current Magento cart
$cart = Mage::getSingleton('checkout/cart');
$quote = Mage::getSingleton('checkout/session')->getQuote();
$items = $quote->getAllVisibleItems();
if(isset($_POST['Not Found'])){
	 if(!$this->helper('customer')->isLoggedIn()){
		header("Location: https://www.prestofreshgrocery.com/customer/account/login/");
	}else{
		foreach($items as $cartItem) {
		$typeid = $cartItem->getProductType();
		if($typeid == 'customproduct'){
		$qty = $cartItem->getQty();
		}
		if($typeid == 'simple'){
		$prodid = $cartItem->getId();
		try{
		Mage::dispatchEvent('catalog_controller_product_delete', array('product' => $cartItem));
		$cartItem->delete();
		$session = Mage::getSingleton('checkout/session');
		$session->addError("You can't  add Subscription product with other product.");
		}catch(Exception $e){
		//echo $e;
		}
		}
		}
		$product = Mage::getModel('catalog/product')
		->setStoreId(Mage::app()->getStore()->getId())
		// load the product object
		->load($_POST['product']);

		// start adding the product

		if($qty < 1 ){

		$cart->addProduct($product, array(
		'qty' => 1,
		'options' => array( key($_POST['super_attribute']) => $_POST['super_attribute'][3] ,  key($_POST['options']) => $_POST['options'][2] ,  key($_POST['option']) => $_POST['option'][1])
		)
		);
		$cart->save();
		// very straightforward, set the cart as updated
		Mage::getSingleton('checkout/session')->setCartWasUpdated(true);
		header("Location: https://www.prestofreshgrocery.com/checkout/cart/");
		}else{
		header("Location: https://www.prestofreshgrocery.com/checkout/cart/");
		$session = Mage::getSingleton('checkout/session');
		$session->addError("Only One Qty Allowed For This Product.");
		}

	}

	// echo "hello";
	// header("https://www.prestofreshgrocery.com/customer/accountpage/");

}else{?>
	<?php
        $connection = Mage::getSingleton('core/resource')->getConnection('core_read');
        $customer_id = Mage::getSingleton('customer/session')->getCustomer()->getId();
        $productTable = 'mg_customer_subsciption';
        $query = "SELECT * FROM " . $productTable . " WHERE customer_id = '".$customer_id."'";
        $result = $connection->query($query);
        $row = $result->fetch();
		//ARB
		  $query2 = "SELECT * FROM mg_aw_sarp2_profile  WHERE `customer_id` LIKE '$customer_id' AND `status` LIKE 'active'";
		  $result2 = $connection->query($query2);
		  $row2 = $result2->fetch();
		//

        if($row['active'] == 'Yes' || $row2['status'] == 'active'){?>
        <p class="mlogo" style="color: #fff;float: left;text-align: center;width:20%;margin-top: 13px;">
		<img src="http://www.prestofreshgrocery.com/skin/frontend/default/theme509/images/new_PrestoPremier_with_arrow_2.png" /></p>
<?php  }else{
	$currentdate =  date('m/d/y');
	$nextyear    = strtotime("+1 year", strtotime($currentdate));
	$expirydate  = date("m/d/y", $nextyear);?>

	<p class="mlogo" style="color:#fff;float:left;text-align:center;width:20%;margin-top:13px;">
	 <a href="<?PHP echo 'https://www.prestofreshgrocery.com/free-shipping-subscription-product.html';?>">
	<!--<a href="<?PHP echo 'http://www.prestofreshgrocery.com/presto-premium-members.html';?>"> -->
	<img src="http://www.prestofreshgrocery.com/skin/frontend/default/theme509/images/PrestoPremier_with_arrow.png" /></a>
	</p>

<?php }
}?>
<div id="popupmsg"  class="popupmsg" style="display:none;border:1px solid #000;padding: 10px; width: 211px;z-index: 9999;position: absolute; background: #fff;left: 400px;
    top: 50px;">Note: You can't add Subscription product with other product. So if you have items in the cart they will be removed.</div>
                   <!-- End-->

                    <div class="quick-access-second">
                            <div class="header-links">

                                <?php echo $this->getChildHtml('topLinks') ?>
                                <ul class="links" style="float: right;"><li><a href="<?php echo $this->getUrl('checkout/cart')?>" title="Add to Cart" target="_blank">My Cart</a></li>
                                 </ul>
                                 <?php echo $this->getChildHtml('topLinksLeft') ?>
                             </div>
                   </div>
                   <div class="right-columns" >
                    <?php echo $this->getChildHtml('topSearch') ?>
                    <?php echo $this->getChildHtml('cart_header'); ?>
                   </div>
                    <div class="clear"></div>
                    <?php echo $this->getChildHtml('topContainer'); ?>
                </div>
            </div>
		</div>
		<div class="clear"></div>
	</div>
</div>
<?php //echo $this->getChildHtml('topMenu') ?>

<?php //echo $this->getLayout()->createBlock('cms/block')->setBlockId('header_banner_block')->toHtml() ?>
<?php $body_classes = str_replace (' ','',$this->getLayout()->createBlock("page/html")->getBodyClass());  $body_classes_active = "cms-index-index"; ?>
<?php if($body_classes == $body_classes_active): ?>
<div class="promotional-block">
<a href="<?php echo $this->getBaseUrl()?>promotional"><?php  echo $this->getLayout()->createBlock('cms/block')->setBlockId('promotional_content')->toHtml();?></a>
</div>
    <?php // echo $this->getLayout()->createBlock('cms/block')->setBlockId('home_content')->toHtml() ?>
<?php endif;?>

<!--- Menu Toggle      --->
<script type="text/javascript">
jQuery(document).ready(function(){
	 jQuery(".works-cont ul.main-menu-works li.first").click(function(){
		jQuery('#first-inner-menu-works').toggle();

	  });
	   jQuery(".works-cont ul.main-menu-works li.sec").click(function(){
		jQuery('#sec-inner-menu-works').toggle();
	  });
	   jQuery(".works-cont ul.main-menu-works li.last").click(function(){
		jQuery('#last-inner-menu-works').toggle();
	  });


});

</script>

<!---------------------------------------------->


<script type="text/javascript">
/*jQuery(document).ready(function(){
  jQuery("#cart_sidebar").click(function(){
    jQuery(".cart-content").toggle('show');
  });
*/
 /*  jQuery("#search").keyup(function(){
   jQuery("#search_autocomplete").css({ display: "block" });

  });
   jQuery("#search").change(function(){
   jQuery("#search_autocomplete").css({ display: "block" });

  });
   jQuery("#search").keydown(function(){
   jQuery("#search_autocomplete").css({ display: "none" });

  });*/

//});

/* Header cart hover*/
/*jQuery(function(){
    jQuery("#cart_sidebar").hover(function(){
      jQuery(this).find(".cart-content").fadeIn();
    }
                    ,function(){
                        jQuery(this).find(".cart-content").fadeOut();
                    }
                   );
});*/
/*Onclick cart show div*/
/*jQuery(document).ready(function(){
    jQuery('#cart_sidebar').live('click', function(event) {
         //jQuery('.cart-content').toggle('show');
		 jQuery('.cart-content').toggle('show');
    });

});
*//*Onclick cart show div*/

/* Seach */

/*jQuery(document).ready(function(){
    jQuery('#search').live('click', function(event) {
         //jQuery('.cart-content').toggle('show');
		document.getElementById('search_autocomplete').style.display='block';
				document.getElementById('search_autocomplete').style.zIndex='999';
    });

});*/

/* search*/
/* Header cart hover*/

/*if((window.location.href != 'http://www.prestofreshgrocery.com/checkout/onepage/') &&  (window.location.href != 'http://www.prestofreshgrocery.com/checkout/onepage/index') && (window.location.href != 'http://www.prestofreshgrocery.com/customer/account/login/') && (window.location.href != 'http://www.prestofreshgrocery.com/customer/account/create/')){

var myHeader = jQuery('#header-top');
myHeader.data( 'position', myHeader.position() );
jQuery(window).scroll(function(){
    var hPos = myHeader.data('position'), scroll = getScroll();
//alert(hPos);
    if ( hPos.top < scroll.top ){
        myHeader.addClass('fixed');
    }
    else {
        myHeader.removeClass('fixed');
    }
});

//===========
var myheadermiddle = jQuery('#header-middle');
myheadermiddle.data( 'position', myheadermiddle.position() );
jQuery(window).scroll(function(){
    var hPos = myheadermiddle.data('position'), scroll = getScroll();
//alert(hPos);
    if ( hPos.top < scroll.top ){
        myheadermiddle.addClass('fixedheader');


    }
    else {
        myheadermiddle.removeClass('fixedheader');
    }
});
//================
//===========
var myheadernav = jQuery('#header-nav');
myheadermiddle.data( 'position', myheadermiddle.position() );
myheadernav.data( 'position', myheadernav.position() );
jQuery(window).scroll(function(){
    var hPos = myheadermiddle.data('position'), scroll = getScroll();
//alert(hPos);
    if ( hPos.top < scroll.top ){
        myheadernav.addClass('fixedheadernav');


    }
    else {
        myheadernav.removeClass('fixedheadernav');
    }
});
//================

function getScroll () {
    var b = document.body;
    var e = document.documentElement;
    return {
        left: parseFloat( window.pageXOffset || b.scrollLeft || e.scrollLeft ),
        top: parseFloat( window.pageYOffset || b.scrollTop || e.scrollTop )
    };
}
	}
</script>
<script type="text/javascript">
//*** xoom - 06-09-2014 updated for static both search bar & cart ****//
jQuery(document).ready(function() {
	(function() {

		var topDistance = jQuery('.right-columns').first().position().top;
		var topDistance1 = jQuery('#header-middle').first().position().top;

		//alert('test' + topDistance);
		var inside = false;
		jQuery(window).scroll(function() {
		position = jQuery(window).scrollTop();
			//if(position > 0 )
			if(position > topDistance1 ) {
jQuery('.right-columns').attr('style', 'position: fixed; top: 0;right:0;z-index:2000;');
	inside = true;
	}
	else {
jQuery('.right-columns').attr('style', 'position: relative; top: auto;right:auto;');
inside = false;
			}
			// For Small screen stop scrolling start
			if ((screen.width <768) ){
			jQuery('.right-columns').attr('style', 'position: relative; top: auto;right:auto;');
inside = false;
			}

			// For Small screen stop scrolling end
		});

	})();
});
</script>
<script type="text/javascript">
jQuery("#Not Foundbtn").hover(
        function () {
           jQuery("#popupmsg").fadeIn();
        },
        function () {
            jQuery("#popupmsg").fadeOut();
        }
    );
</script>
<style>
#custommenu-mobile
{
   line-height:37px !important;
    margin-top:35px !important;
	margin-bottom:18px !important;
}
#menu-button a span
{
  margin-top:11px !important;
}
.block-cart-header
{
    min-width:168px !important;;
}
.odd
{
   background : none !important;
}

@media (min-width: 1100px) {
	.product-free-shipping-subscription-product  .span9
	{
	   width:1085px !important;
	}
}
.product-free-shipping-subscription-product .label
{
    font-size:12px important;
}
@media screen and (max-width: 767px)
{
	 .header-button .top-link-checkout
	 {
		display:none !important;
	 }
	 .header-buttons .fullwidth-ajaxlogin-login, .header-buttons .fullwidth-logout-link, .header-buttons .fullwidth-myaccount
	 {
		display:none !important;
	 }
	.header-buttons .header-checkout
	{
		display:block !important;
		float: left;
		margin-top: 10px;
		border-right: 0px;
		text-align: center;
	}
	.header-buttons .header-checkout > a {
		color: white;
		font-size: 16px;
	}
	.header-buttons .header-checkout > a:hover
	{
		/*background:#79A617;*/
	}
	.header-buttons .header-checkout ul {
		float: left;
		width: 100%;
		list-style-type: none;
	}

	.header-buttons .header-checkout li a {
		text-decoration: none;
		color: white;
		padding: 10px 5px;
		/*border-right: 1px solid #5a8710;*/
	}
	.header-buttons .header-checkout li {display: inline;}
}
.box {
           /* width: 20%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.2);*/
           /* padding: 35px;*/
            border: 2px solid #fff;
           /*  border-radius: 20px/50px;
            background-clip: padding-box;
            text-align: center;*/
          }

          .overlay {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;


            visibility: visible;
            opacity: 1;
          }
          .overlay:target {
            visibility: hidden;
            opacity: 0;
            display:none
          }
          .popup {
            margin: 70px auto;
            padding: 20px;
            background: #fff;
            border-radius: 5px;
             width: 50%;
    z-index: 999;

            position: relative;
            transition: all 5s ease-in-out;
             border: 1px solid #eee;
          }
          .popup h2 {
            margin-top: 0;
            color: #333;
            font-family: Tahoma, Arial, sans-serif;
          }
          .popup .close {
            position: absolute;
            top: 20px;
            right: 30px;
            transition: all 200ms;
            font-size: 30px;
            font-weight: bold;
            text-decoration: none;
            color: #333;
          }
          .popup .close:hover {
            color: orange;
          }
          .popup .content {
            max-height: 30%;
            overflow: auto;
          }

</style>




<!-- FOR THE POPUP FOR LOGGED IN USER-->
 <?php

 $currentUrl = Mage::helper('core/url')->getCurrentUrl();
 $url_key_pp = explode(':',$currentUrl);
 //print_r($url_key_pp);

 if (Mage::getSingleton('customer/session')->isLoggedIn()) {
 $customer = Mage::getSingleton('customer/session')->getCustomer();
  $customerData = Mage::getModel('customer/customer')->load($customer->getId())->getData();

  if($customerData['how_do_your_hear']=='' || $customerData['how_do_your_hear']==0)  {
?>

<!--<a class="button" href="#" onclick="showDiv()" >Message To Vendor</a>-->
 <div id="popup1" class="overlay" style="display:none;">

 <div class="popup" >
 <a class="ajaxlogin-window close" href="#" onclick="hideDiv()" id="pop_close"></a>
 <div class="content">

 <form action="<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB);?>" method="post" id="form-validate" enctype="multipart/form-data">
 <div class="fieldset">
 <?php echo $this->getBlockHtml('formkey')?>
        <div class="field">
		<div class="" style=" width: 89%;">
<span> Hi - Sorry to disturb you! In order to best serve you, we would like to ask you 1 question - we promise not to trouble you again! Thank you!</span>
</div> <br>
		<label for="how_do_your_hear" class="required" style="color: #000;display: inline-block;float: left;font-weight: 700;padding-bottom: 5px;position: relative;z-index: 0;margin-right: 24px;"><em>*</em> How did you hear about us?</label>
		<div class="input-box">
		<select name="how_do_your_hear" class="validate-select select" id="how_do_your_hear">
							   <option value="">Please Select One</option>
							   <option value="1">Brochure in Mail</option>
                                <option value="2">Facebook Advertisement/Post</option>
								<option value="3">Friends/Family</option>
								<option value="4">Saw Vehicle</option>
								<option value="5">Web Search (e.g. Google, Yahoo, etc)</option>
								<option value="6">Other</option>
								</select>
		 <div style="font-size: 12px; color: rgb(0, 0, 0); font-weight: 700;display:none;" class="field" id="other_opt">Please elaborate <input type="text" style="" id="other_specify" name="other_specify" value="" class="input-text"><div>
		 </div>
         </div>
		 </div></div>

		 <input id="customer_id" type="hidden" value="<?php echo $customer->getId();?>" name="customer_id">
	  <div class="buttons-set">
		<p class="required">* Required Fields</p>
		<button type="submit" title="Send Message" class="button" ><span><span>Submit</span></span></button>
	 </div>
	 </div>
  </form>
</div>
</div>
</div>
<script>
function showDiv() {
	document.getElementById('popup1').style.display = "block";
}
function hideDiv(){

	document.getElementById('popup1').style.display = "none";
}
 (function(jQuery){
    jQuery(window).load(function() {
      showDiv();
    });
})(jQuery);
jQuery('#how_do_your_hear').change(function() {
			if(jQuery("#how_do_your_hear").val() != 6){
				jQuery("#other_specify").hide();
				jQuery("#other_opt").hide();
				 jQuery("#other_specify").val("");
				 jQuery("#other_specify").removeClass('required-entry');
				}
			if(jQuery("#how_do_your_hear").val() == 6) {
				jQuery("#other_specify").show();
				jQuery("#other_opt").show();
				jQuery("#other_specify").addClass('required-entry');
				}
		});
var questionForm= new VarienForm('form-validate', true);
 jQuery('#form-validate').submit(function(e) {
 	e.preventDefault();
 	if(questionForm.validator && !questionForm.validator.validate()) {
        //do something here because it failed validation
        return;
    }
	jQuery.ajax({
		url: "<?php echo $url_key_pp[0].'://www.prestofreshgrocery.com/customer/account/question'; ?>",
		type: "POST",
		data: {"how_do_your_hear": jQuery("#how_do_your_hear").val(), "other_specify": jQuery("#other_specify").val()},
		success: function(data) {
			document.getElementById('popup1').style.display = "none";
			//alert(data);
			hideDiv();
			//jQuery('#results').html(data);
		}
	});
});
</script>
<?php }} ?>
<!-- END HERE THE POPUP FOR LOGGED IN USER- -->

